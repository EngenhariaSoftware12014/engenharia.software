<!DOCTYPE html>
<html lang="en-US-x-hixie" class="split chapter"><head><title>4.12.4 The canvas element — HTML Standard</title><script>
   var loadTimer = new Date();
   var current_revision = "r" + "$Revision: 8579 $".substr(11);
   current_revision = current_revision.substr(0, current_revision.length - 2);
   var last_known_revision = current_revision;
   function F( /* varargs... */) {
     var fragment = document.createDocumentFragment();
     for (var index = 0; index < arguments.length; index += 1) {
       if (arguments[index] instanceof Array) {
         fragment.appendChild(F.apply(this, arguments[index]));
       } else if (typeof arguments[index] == 'string') {
         fragment.appendChild(document.createTextNode(arguments[index]));
       } else {
         fragment.appendChild(arguments[index]);
       }
     }
     return fragment;
   }
   function E(name, /* optional */ attributes /*, varargs... */) {
     var element = document.createElement(name);
     var index = 1;
     if ((arguments.length > 1) && (typeof attributes != 'string') &&
         (!(attributes instanceof Node)) && (!(attributes instanceof Array))) {
       for (var attName in attributes) {
         if (typeof attributes[attName] == 'boolean') {
           if (attributes[attName])
             element.setAttribute(attName, '');
         } else if (typeof attributes[attName] == 'function') {
           element[attName] = attributes[attName];
         } else {
           element.setAttribute(attName, attributes[attName]);
         }
       }
       index = 2;
     }
     for (; index < arguments.length; index += 1) {
       if (arguments[index] instanceof Array) {
         element.appendChild(F.apply(this, arguments[index]));
       } else if (typeof arguments[index] == 'string') {
         element.appendChild(document.createTextNode(arguments[index]));
       } else {
         element.appendChild(arguments[index]);
       }
     }
     return element;
   }
   function getCookie(name) {
     var params = location.search.substr(1).split("&");
     for (var index = 0; index < params.length; index++) {
       if (params[index] == name)
         return "1";
       var data = params[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     var cookies = document.cookie.split("; ");
     for (var index = 0; index < cookies.length; index++) {
       var data = cookies[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     return null;
   }
   var currentAlert;
   var currentAlertTimeout;
   function showAlert(s, href) {
     if (!currentAlert) {
       currentAlert = document.createElement('div');
       currentAlert.id = 'alert';
       var x = document.createElement('button');
       x.textContent = '\u2573';
       x.onclick = closeAlert2;
       currentAlert.appendChild(x);
       currentAlert.appendChild(document.createElement('span'));
       currentAlert.onmousemove = function () {
         clearTimeout(currentAlertTimeout);
         currentAlert.className = '';
         currentAlertTimeout = setTimeout(closeAlert, 10000);
       }
       document.body.appendChild(currentAlert);
     } else {
       clearTimeout(currentAlertTimeout);
       currentAlert.className = '';
     }
     currentAlert.lastChild.textContent = '';
     currentAlert.lastChild.appendChild(F(s));
     if (href) {
       var link = document.createElement('a');
       link.href = href;
       link.textContent = href;
       currentAlert.lastChild.appendChild(F(' ', link));
     }
     currentAlertTimeout = setTimeout(closeAlert, 10000);
   }
   function closeAlert() {
     clearTimeout(currentAlertTimeout);
     if (currentAlert) {
       currentAlert.className = 'closed';
       currentAlertTimeout = setTimeout(closeAlert2, 3000);
     }
   }
   function closeAlert2() {
     clearTimeout(currentAlertTimeout);
     if (currentAlert) {
       currentAlert.parentNode.removeChild(currentAlert);
       currentAlert = null;
     }
   }
   window.addEventListener('keydown', function (event) {
     if (event.keyCode == 27) {
       if (currentAlert)
         closeAlert2();
     } else {
       closeAlert();
     }
   }, false);
   window.addEventListener('scroll', function (event) {
     closeAlert();
   }, false);
   function load(script) {
     var e = document.createElement('script');
     e.setAttribute('src', '//www.whatwg.org/specs/web-apps/current-work/' + script);
     document.body.appendChild(e);
   }
  </script><link rel="stylesheet" href="//www.whatwg.org/style/specification"><link rel="icon" href="//www.whatwg.org/images/icon"><style>
   .proposal { border: blue solid; padding: 1em; }
   .bad, .bad *:not(.XXX) { color: gray; border-color: gray; background: transparent; }
   #updatesStatus { display: none; z-index: 10; }
   #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
   div.head .logo { width: 11em; margin-bottom: 20em; }
   #configUI { position: absolute; z-index: 20; top: auto; right: 0; width: 11em; padding: 0 0.5em 0 0.5em; font-size: small; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 1em 0 0 1em; -moz-border-radius: 1em 0 0 1em; }
   #configUI p { margin: 0.75em 0; padding: 0.3em; }
   #configUI p label { display: block; }
   #configUI #updateUI, #configUI .loginUI { text-align: center; }
   #configUI input[type=button] { display: block; margin: auto; }
   #configUI :link, #configUI :visited { color: white; }
   #configUI :link:hover, #configUI :visited:hover { background: transparent; }
   #reviewer { position: fixed; bottom: 0; right: 0; padding: 0.15em 0.25em 0em 0.5em; white-space: nowrap; overflow: hidden; z-index: 30; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 1em 0 0 0; -moz-border-radius: 1em 0 0 0; max-width: 90%; }
   #reviewer input { max-width: 50%; }
   #reviewer * { font-size: small; }
   #reviewer.off > :not(:first-child) { display: none; }
   #alert { position: fixed; top: 20%; left: 20%; right: 20%; font-size: 2em; padding: 0.5em; z-index: 40; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 1em; -moz-border-radius: 1em; -webkit-transition: opacity 1s linear; }
   #alert.closed { opacity: 0; }
   #alert button { position: absolute; top: -1em; right: 2em; border-radius: 1em 1em 0 0; border: none; line-height: 0.9; color: white; background: rgb(64,64,64); font-size: 0.6em; font-weight: 900; cursor: pointer; }
   #alert :link, #alert :visited { color: white; }
   #alert :link:hover, #alert :visited:hover { background: transparent; }
   @media print { #configUI { display: none; } }
   .rfc2119 { font-variant: small-caps; text-shadow: 0 0 0.5em yellow; position: static; }
   .rfc2119::after { position: absolute; left: 0; width: 25px; text-align: center; color: yellow; text-shadow: 0.075em 0.075em 0.2em black; }
   .rfc2119.m\ust::after { content: '\2605'; }
   .rfc2119.s\hould::after { content: '\2606'; }
   [hidden] { display: none; }
  </style><style type="text/css">

   .fingerprint { float: right; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }
   .applies .yes { background: yellow; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   #base64-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 6em;
     column-count: 5;
     column-gap: 1em;
     -moz-column-width: 6em;
     -moz-column-count: 5;
     -moz-column-gap: 1em;
     -webkit-column-width: 6em;
     -webkit-column-count: 5;
     -webkit-column-gap: 1em;
   }
   #base64-table thead { display: none; }
   #base64-table * { border: none; }
   #base64-table tbody td:first-child:after { content: ':'; }
   #base64-table tbody td:last-child { text-align: right; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   @font-face {
     font-family: 'Essays1743';
     src: url('//www.whatwg.org/specs/web-apps/current-work/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('//www.whatwg.org/specs/web-apps/current-work/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('//www.whatwg.org/specs/web-apps/current-work/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('//www.whatwg.org/specs/web-apps/current-work/fonts/Essays1743-BoldItalic.ttf');
   }

  </style><link rel="stylesheet" href="data:text/css," title="Normal"><link rel="stylesheet alternate" href="data:text/css,.impl%20%7B%20background:%20pink;%20%7D" title="Highlight implementation-only prose"><link rel="stylesheet" href="status.css"><script>
   var startedInit = 0;
   function init() {
     startedInit = 1;
     if (location.search == '?slow-browser')
       return;
     load('reviewer.js');
     if (document.documentElement.className == "" || document.documentElement.className == "split index")
       load('toc.js');
     load('updater.js');
     load('dfn.js');
     load('status.js');
     if (getCookie('profile') == '1')
       document.getElementsByTagName('h2')[0].textContent += '; load: ' + (new Date() - loadTimer) + 'ms';
   }
   if (document.documentElement.className == "")
     setTimeout(function () {
       if (!startedInit)
         showAlert("Too slow? Try reading the multipage copy of the spec instead:", "http://whatwg.org/html");
     }, 6000);

   window.addEventListener('keypress', function (event) {
     if ((event.which == 114) && (event.metaKey)) {
       if (!confirm('Are you sure you want to reload this page?'))
         event.preventDefault();
     }
   }, false);

  </script>
  <script src="link-fixup.js"></script>
  <link href="scripting-1.html" title="4.12 Scripting" rel="prev">
  <link href="index.html#contents" title="Table of contents" rel="index">
  <link href="common-idioms.html" title="4.13 Common idioms without dedicated elements" rel="next">
  </head><body onload="fixBrokenLink(); init()"><header class="head" id="head"><style scoped>
    header#head > div {
      text-align: center;
    }
    header#head > div > div {
      display: inline-block;
    }
    header#head > div > div > a {
      display: inline-block;
      white-space: nowrap;
      font: 1.75em/1 Helvetica Neue, sans-serif, Droid Sans Fallback;
      text-decoration: none;
      width: 9em;
      padding: 0.75em 0.5em;
      margin: 0.5em;
      color: #F3F3F3;
      text-align: center;
      box-shadow: 0 0 5px black;
      transition: box-shadow 0.05s linear, color 0.05s linear;
    }
    header#head > div > div > a { background: #3C790A; }
    header#head > div > div > a.comms { background: #0B2F66; } /* #165FCC #43679D */
    header#head > div > div > a.feedback { background: #990300; } /* #FF3E3A #CD6B6A */
    header#head > div > div > a.changes { background: #28584C; } /* #54B29A #6A9A8E */
    header#head > div > div > a.misc { background: #945400; } /* #FFA32D #CB9D62 */
    header#head > div > div > a:hover {
      box-shadow: 0 0 25px black;
      color: #FFFFFF;
    }
    header#head > div > div > a > * > * {
      display: block;
      color: inherit;
      font: inherit;
    }
    header#head > div > div > a > * > strong {
      font-variant: small-caps;
      font-weight: bold;
      margin-bottom: 0.25em;
      text-decoration: underline;
    }
    header#head > div > div > a > * > code {
      font-size: 0.6em;
      font-weight: 100;
    }
    header#head > div ~ p.copyright { text-align: center; }
    header#head > div ~ p.copyright > span { display: inline-block; border: none; }
   </style><p><a href="//www.whatwg.org/" class="logo"><img width="101" src="/images/logo" alt="WHATWG" height="101"></a></p>
   </header><nav>
   <a href="scripting-1.html">← 4.12 Scripting</a> –
   <a href="index.html#contents">Table of contents</a> –
   <a href="common-idioms.html">4.13 Common idioms without dedicated elements →</a>
  <ol class="toc"><li><ol><li><ol><li><a href="the-canvas-element.html#the-canvas-element"><span class="secno">4.12.4 </span>The <code>canvas</code> element</a>
      <ol><li><a href="the-canvas-element.html#proxying-canvases-to-workers"><span class="secno">4.12.4.1 </span>Proxying canvases to workers</a></li><li><a href="the-canvas-element.html#2dcontext"><span class="secno">4.12.4.2 </span>The 2D rendering context</a>
        <ol><li><a href="the-canvas-element.html#implementation-notes"><span class="secno">4.12.4.2.1 </span>Implementation notes</a></li><li><a href="the-canvas-element.html#the-canvas-state"><span class="secno">4.12.4.2.2 </span>The canvas state</a></li><li><a href="the-canvas-element.html#drawingstyle-objects"><span class="secno">4.12.4.2.3 </span><code>DrawingStyle</code> objects</a></li><li><a href="the-canvas-element.html#line-styles"><span class="secno">4.12.4.2.4 </span>Line styles</a></li><li><a href="the-canvas-element.html#text-styles"><span class="secno">4.12.4.2.5 </span>Text styles</a></li><li><a href="the-canvas-element.html#building-paths"><span class="secno">4.12.4.2.6 </span>Building paths</a></li><li><a href="the-canvas-element.html#path2d-objects"><span class="secno">4.12.4.2.7 </span><code>Path2D</code> objects</a></li><li><a href="the-canvas-element.html#transformations"><span class="secno">4.12.4.2.8 </span>Transformations</a></li><li><a href="the-canvas-element.html#image-sources-for-2d-rendering-contexts"><span class="secno">4.12.4.2.9 </span>Image sources for 2D rendering contexts</a></li><li><a href="the-canvas-element.html#fill-and-stroke-styles"><span class="secno">4.12.4.2.10 </span>Fill and stroke styles</a></li><li><a href="the-canvas-element.html#drawing-rectangles-to-the-bitmap"><span class="secno">4.12.4.2.11 </span>Drawing rectangles to the bitmap</a></li><li><a href="the-canvas-element.html#drawing-text-to-the-bitmap"><span class="secno">4.12.4.2.12 </span>Drawing text to the bitmap</a></li><li><a href="the-canvas-element.html#drawing-paths-to-the-canvas"><span class="secno">4.12.4.2.13 </span>Drawing paths to the canvas</a></li><li><a href="the-canvas-element.html#drawing-images"><span class="secno">4.12.4.2.14 </span>Drawing images</a></li><li><a href="the-canvas-element.html#hit-regions"><span class="secno">4.12.4.2.15 </span>Hit regions</a></li><li><a href="the-canvas-element.html#pixel-manipulation"><span class="secno">4.12.4.2.16 </span>Pixel manipulation</a></li><li><a href="the-canvas-element.html#compositing"><span class="secno">4.12.4.2.17 </span>Compositing</a></li><li><a href="the-canvas-element.html#image-smoothing"><span class="secno">4.12.4.2.18 </span>Image smoothing</a></li><li><a href="the-canvas-element.html#shadows"><span class="secno">4.12.4.2.19 </span>Shadows</a></li><li><a href="the-canvas-element.html#drawing-model"><span class="secno">4.12.4.2.20 </span>Drawing model</a></li><li><a href="the-canvas-element.html#best-practices"><span class="secno">4.12.4.2.21 </span>Best practices</a></li><li><a href="the-canvas-element.html#examples"><span class="secno">4.12.4.2.22 </span>Examples</a></li></ol></li><li><a href="the-canvas-element.html#color-spaces-and-color-correction"><span class="secno">4.12.4.3 </span>Color spaces and color correction</a></li><li><a href="the-canvas-element.html#serializing-bitmaps-to-a-file"><span class="secno">4.12.4.4 </span>Serializing bitmaps to a file</a></li><li><a href="the-canvas-element.html#security-with-canvas-elements"><span class="secno">4.12.4.5 </span>Security with <code>canvas</code> elements</a></li></ol></li></ol></li></ol></li></ol></nav>

  <h4 id="the-canvas-element"><span class="secno">4.12.4 </span>The <dfn id="canvas"><code>canvas</code></dfn> element</h4>

  <dl class="element"><dt><a href="elements.html#element-dfn-categories" title="element-dfn-categories">Categories</a>:</dt>
   <dd><a href="elements.html#flow-content">Flow content</a>.</dd>
   <dd><a href="elements.html#phrasing-content">Phrasing content</a>.</dd>
   <dd><a href="elements.html#embedded-content-category">Embedded content</a>.</dd>
   <dd><a href="elements.html#palpable-content">Palpable content</a>.</dd>
   <dt><a href="elements.html#element-dfn-contexts" title="element-dfn-contexts">Contexts in which this element can be used</a>:</dt>
   <dd>Where <a href="elements.html#embedded-content-category">embedded content</a> is expected.</dd>
   <dt><a href="elements.html#element-dfn-content-model" title="element-dfn-content-model">Content model</a>:</dt>
   <dd><a href="elements.html#transparent">Transparent</a>, but with no <a href="elements.html#interactive-content">interactive content</a> descendants except for <code><a href="text-level-semantics.html#the-a-element">a</a></code> elements, <code><a href="edits.html#the-img-element">img</a></code> elements with <code title="attr-hyperlink-usemap"><a href="the-map-element.html#attr-hyperlink-usemap">usemap</a></code> attributes, <code><a href="the-button-element.html#the-button-element">button</a></code> elements, <code><a href="the-input-element.html#the-input-element">input</a></code> elements whose <code title="attr-input-type"><a href="the-input-element.html#attr-input-type">type</a></code> attribute are in the <a href="states-of-the-type-attribute.html#checkbox-state-(type=checkbox)" title="attr-input-type-checkbox">Checkbox</a> or <a href="states-of-the-type-attribute.html#radio-button-state-(type=radio)" title="attr-input-type-radio">Radio Button</a> states, <code><a href="the-input-element.html#the-input-element">input</a></code> elements that are <a href="forms.html#concept-button" title="concept-button">buttons</a>, <code><a href="the-button-element.html#the-select-element">select</a></code> elements with a <code title="attr-select-multiple"><a href="the-button-element.html#attr-select-multiple">multiple</a></code> attribute or a <a href="the-button-element.html#concept-select-size" title="concept-select-size">display size</a> greater than 1, <a href="tabular-data.html#sorting-interface-th-element" title="sorting interface th element">sorting interface <code>th</code> elements</a>, and elements that would not be <a href="elements.html#interactive-content">interactive content</a> except for having the <code title="attr-tabindex"><a href="editing.html#attr-tabindex">tabindex</a></code> attribute specified.</dd>
   <dt><a href="elements.html#element-dfn-tag-omission" title="element-dfn-tag-omission">Tag omission in text/html</a>:</dt>
   <dd>Neither tag is omissible.</dd>
   <dt><a href="elements.html#element-dfn-attributes" title="element-dfn-attributes">Content attributes</a>:</dt>
   <dd><a href="elements.html#global-attributes">Global attributes</a></dd>
   <dd><code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> — Horizontal dimension</dd>
   <dd><code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> — Vertical dimension</dd>
   <dt><a href="elements.html#element-dfn-dom" title="element-dfn-dom">DOM interface</a>:</dt><!--ADD-TOPIC:DOM APIs-->
   <dd>
    <pre class="idl">typedef (<a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a> or <a href="infrastructure.html#webglrenderingcontext">WebGLRenderingContext</a>) <dfn id="renderingcontext">RenderingContext</dfn>;

interface <dfn id="htmlcanvaselement">HTMLCanvasElement</dfn> : <a href="elements.html#htmlelement">HTMLElement</a> {
           attribute unsigned long <a href="#dom-canvas-width" title="dom-canvas-width">width</a>;
           attribute unsigned long <a href="#dom-canvas-height" title="dom-canvas-height">height</a>;

  <a href="#renderingcontext">RenderingContext</a>? <a href="#dom-canvas-getcontext" title="dom-canvas-getContext">getContext</a>(DOMString contextId, any... arguments);
  boolean <a href="#dom-canvas-probablysupportscontext" title="dom-canvas-probablySupportsContext">probablySupportsContext</a>(DOMString contextId, any... arguments);

  void <a href="#dom-canvas-setcontext" title="dom-canvas-setContext">setContext</a>(<a href="#renderingcontext">RenderingContext</a> context);
  <a href="#canvasproxy">CanvasProxy</a> <a href="#dom-canvas-transfercontroltoproxy" title="dom-canvas-transferControlToProxy">transferControlToProxy</a>();

  DOMString <a href="#dom-canvas-todataurl" title="dom-canvas-toDataURL">toDataURL</a>(optional DOMString type, any... arguments);
  void <a href="#dom-canvas-toblob" title="dom-canvas-toBlob">toBlob</a>(<a href="common-dom-interfaces.html#filecallback">FileCallback</a>? _callback, optional DOMString type, any... arguments);
};</pre>
   </dd>
  </dl><!--REMOVE-TOPIC:DOM APIs--><p>The <code><a href="#the-canvas-element">canvas</a></code> element provides scripts with a resolution-dependent bitmap canvas,
  which can be used for rendering graphs, game graphics, art, or other visual images on the fly.</p>

  <p>Authors should not use the <code><a href="#the-canvas-element">canvas</a></code> element in a document when a more suitable
  element is available. For example, it is inappropriate to use a <code><a href="#the-canvas-element">canvas</a></code> element to
  render a page heading: if the desired presentation of the heading is graphically intense, it
  should be marked up using appropriate elements (typically <code><a href="sections.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements">h1</a></code>) and then styled using
  CSS and supporting technologies such as Web Components.</p>

  <p>When authors use the <code><a href="#the-canvas-element">canvas</a></code> element, they must also provide content that, when
  presented to the user, conveys essentially the same function or purpose as the
  <code><a href="#the-canvas-element">canvas</a></code>' bitmap. This content may be placed as content of the <code><a href="#the-canvas-element">canvas</a></code>
  element. The contents of the <code><a href="#the-canvas-element">canvas</a></code> element, if any, are the element's <a href="elements.html#fallback-content">fallback
  content</a>.</p>

  <hr><p>In interactive visual media, if <a href="webappapis.html#concept-n-script" title="concept-n-script">scripting is enabled</a> for
  the <code><a href="#the-canvas-element">canvas</a></code> element, and if support for <code><a href="#the-canvas-element">canvas</a></code> elements has been enabled,
  the <code><a href="#the-canvas-element">canvas</a></code> element <a href="elements.html#represents">represents</a> <a href="elements.html#embedded-content-category">embedded content</a> consisting
  of a dynamically created image, the element's bitmap.</p>

  <p>In non-interactive, static, visual media, if the <code><a href="#the-canvas-element">canvas</a></code> element has been
  previously associated with a rendering context (e.g. if the page was viewed in an interactive
  visual medium and is now being printed, or if some script that ran during the page layout process
  painted on the element), then the <code><a href="#the-canvas-element">canvas</a></code> element <a href="elements.html#represents">represents</a>
  <a href="elements.html#embedded-content-category">embedded content</a> with the element's current bitmap and size. Otherwise, the element
  represents its <a href="elements.html#fallback-content">fallback content</a> instead.</p>

  <p>In non-visual media, and in visual media if <a href="webappapis.html#concept-n-noscript" title="concept-n-noscript">scripting is
  disabled</a> for the <code><a href="#the-canvas-element">canvas</a></code> element or if support for <code><a href="#the-canvas-element">canvas</a></code> elements
  has been disabled, the <code><a href="#the-canvas-element">canvas</a></code> element <a href="elements.html#represents">represents</a> its <a href="elements.html#fallback-content">fallback
  content</a> instead.</p>

  <!-- CANVAS-FOCUS-FALLBACK -->
  <p>When a <code><a href="#the-canvas-element">canvas</a></code> element <a href="elements.html#represents">represents</a> <a href="elements.html#embedded-content-category">embedded content</a>, the
  user can still focus descendants of the <code><a href="#the-canvas-element">canvas</a></code> element (in the <a href="elements.html#fallback-content">fallback
  content</a>). When an element is <a href="editing.html#focused">focused</a>, it is the target of keyboard interaction events (even
  though the element itself is not visible). This allows authors to make an interactive canvas
  keyboard-accessible: authors should have a one-to-one mapping of interactive regions to <i title="focusable area"><a href="editing.html#focusable-area">focusable
  areas</a></i> in the <a href="elements.html#fallback-content">fallback content</a>. (Focus has no effect on mouse interaction events.)
  <a href="references.html#refsDOMEVENTS">[DOMEVENTS]</a></p> <!-- user interaction spec integration point -->

  <p>An element whose nearest <code><a href="#the-canvas-element">canvas</a></code> element ancestor is <a href="rendering.html#being-rendered">being rendered</a>
  and <a href="elements.html#represents">represents</a> <a href="elements.html#embedded-content-category">embedded content</a> is an element that is <dfn id="being-used-as-relevant-canvas-fallback-content">being used as
  relevant canvas fallback content</dfn>.</p>

  <hr><p>The <code><a href="#the-canvas-element">canvas</a></code> element has two attributes to control the size of the element's bitmap:
  <dfn id="attr-canvas-width" title="attr-canvas-width"><code>width</code></dfn> and <dfn id="attr-canvas-height" title="attr-canvas-height"><code>height</code></dfn>. These attributes, when specified, must have
  values that are <a href="common-microsyntaxes.html#valid-non-negative-integer" title="valid non-negative integer">valid non-negative integers</a>. <span class="impl">The <a href="common-microsyntaxes.html#rules-for-parsing-non-negative-integers">rules for parsing non-negative integers</a> must be used to obtain their
  numeric values. If an attribute is missing, or if parsing its value returns an error, then the
  default value must be used instead.</span> The <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code>
  attribute defaults to 300, and the <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> attribute
  defaults to 150.</p>

  <p>The intrinsic dimensions of the <code><a href="#the-canvas-element">canvas</a></code> element when it <a href="elements.html#represents">represents</a>
  <a href="elements.html#embedded-content-category">embedded content</a> are equal to the dimensions of the element's bitmap.</p>

  <p>The user agent must use a square pixel density consisting of one pixel of image data per
  coordinate space unit for the bitmaps of a <code><a href="#the-canvas-element">canvas</a></code> and its rendering contexts.</p>

  <p class="note">A <code><a href="#the-canvas-element">canvas</a></code> element can be sized arbitrarily by a style sheet, its
  bitmap is then subject to the 'object-fit' CSS property. <a href="references.html#refsCSSIMAGES">[CSSIMAGES]</a></p>

  <div class="impl">

  <hr><!--ADD-TOPIC:Security--><p>The bitmaps of <code><a href="#the-canvas-element">canvas</a></code> elements, as well as some of the bitmaps of rendering
  contexts, such as those described in the section on the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>
  object below, have an <dfn id="concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</dfn> flag, which can
  be set to true or false. Initially, when the <code><a href="#the-canvas-element">canvas</a></code> element is created, its bitmap's
  <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag must be set to true.</p>
<!--REMOVE-TOPIC:Security-->

  <p>A <code><a href="#the-canvas-element">canvas</a></code> bitmap can also have a <a href="#hit-region-list">hit region list</a>, as described in the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> section below.</p>

  <p>A <code><a href="#the-canvas-element">canvas</a></code> element can have a rendering context bound to it. Initially, it does not
  have a bound rendering context. To keep track of whether it has a rendering context or not, and
  what kind of rendering context it is, a <code><a href="#the-canvas-element">canvas</a></code> also has a <dfn id="concept-canvas-context-mode" title="concept-canvas-context-mode">canvas context mode</dfn>, which is initially <dfn id="concept-canvas-none" title="concept-canvas-none">none</dfn> but can be changed to either <dfn id="concept-canvas-direct-2d" title="concept-canvas-direct-2d">direct-2d</dfn>, <dfn id="concept-canvas-direct-webgl" title="concept-canvas-direct-webgl">direct-webgl</dfn>, <dfn id="concept-canvas-indirect" title="concept-canvas-indirect">indirect</dfn>, or <dfn id="concept-canvas-proxied" title="concept-canvas-proxied">proxied</dfn> by algorithms defined in this specification.</p>

  <p>When its <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">canvas context mode</a> is <a href="#concept-canvas-none" title="concept-canvas-none">none</a>, a <code><a href="#the-canvas-element">canvas</a></code> element has no rendering context,
  and its bitmap must be fully transparent black with an intrinsic width equal to the numeric value
  of the element's <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> attribute and an intrinsic height
  equal to the numeric value of the element's <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code>
  attribute, those values being interpreted in CSS pixels, and being updated as the attributes are
  set, changed, or removed.</p>

  <p>When a <code><a href="#the-canvas-element">canvas</a></code> element represents <a href="elements.html#embedded-content-category">embedded content</a>, it <a href="infrastructure.html#provides-a-paint-source">provides
  a paint source</a> whose width is the element's intrinsic width, whose height is the element's
  intrinsic height, and whose appearance is the element's bitmap.</p>

  <p>Whenever the <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> and <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> content attributes are set, removed, changed, or
  redundantly set to the value they already have, if the <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">canvas context mode</a> is <a href="#concept-canvas-direct-2d" title="concept-canvas-direct-2d">direct-2d</a><!-- (and the rendering context's <span
  title="concept-canvas-context-bitmap-mode">context bitmap mode</span>, therefore, is <span
  title="concept-canvas-fixed">fixed</span>)-->, the user agent must <a href="#concept-canvas-set-bitmap-dimensions" title="concept-canvas-set-bitmap-dimensions">set bitmap dimensions</a> to the numeric values of
  the <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> and <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> content attributes.</p>

  <p>The <dfn id="dom-canvas-width" title="dom-canvas-width"><code>width</code></dfn> and <dfn id="dom-canvas-height" title="dom-canvas-height"><code>height</code></dfn> IDL attributes must <a href="common-dom-interfaces.html#reflect">reflect</a> the
  respective content attributes of the same name, with the same defaults.</p>

  </div>

  <hr><!--ADD-TOPIC:DOM APIs--><dl class="domintro"><dt><var title="">context</var> = <var title="">canvas</var> . <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext</a></code>(<var title="">contextId</var> [, ... ] )</dt>

   <dd>

    <p>Returns an object that exposes an API for drawing on the canvas. The first argument specifies
    the desired API, either "<code title="canvas-context-2d"><a href="#canvas-context-2d">2d</a></code>" or "<code title="canvas-context-webgl"><a href="#canvas-context-webgl">webgl</a></code>". Subsequent arguments are handled by that API.</p>

    <p>This specification defines the "<code title="canvas-context-2d"><a href="#canvas-context-2d">2d</a></code>" context below.
    There is also a specification that defines a "<code title="canvas-context-webgl"><a href="#canvas-context-webgl">webgl</a></code>"
    context. <a href="references.html#refsWEBGL">[WEBGL]</a></p>

    <p>Returns null if the given context ID is not supported, if the canvas has already been
    initialized with the other context type (e.g. trying to get a "<code title="canvas-context-2d"><a href="#canvas-context-2d">2d</a></code>" context after getting a "<code title="canvas-context-webgl"><a href="#canvas-context-webgl">webgl</a></code>" context).</p>

    <p>Throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception if the <code title="dom-canvas-setContext"><a href="#dom-canvas-setcontext">setContext()</a></code> or <code title="dom-canvas-transferControlToProxy"><a href="#dom-canvas-transfercontroltoproxy">transferControlToProxy()</a></code> methods have been
    used.</p>

   </dd>

   <dt><var title="">supported</var> = <var title="">canvas</var> . <code title="dom-canvas-probablySupportsContext"><a href="#dom-canvas-probablysupportscontext">probablySupportsContext</a></code>(<var title="">contextId</var> [, ... ] )</dt>

   <dd>

    <p>Returns false if calling <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> with the
    same arguments would definitely return null, and true otherwise.</p>

    <p>This return value is not a guarantee that <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> will or will not return an object, as
    conditions (e.g. availability of system resources) can vary over time.</p>

    <p>Throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception if the <code title="dom-canvas-setContext"><a href="#dom-canvas-setcontext">setContext()</a></code> or <code title="dom-canvas-transferControlToProxy"><a href="#dom-canvas-transfercontroltoproxy">transferControlToProxy()</a></code> methods have been
    used.</p>

   </dd>

   <dt><var title="">canvas</var> . <code title="dom-canvas-setContext"><a href="#dom-canvas-setcontext">setContext</a></code>(<var title="">context</var>)</dt>

   <dd>

    <p>Sets the <code><a href="#the-canvas-element">canvas</a></code>' rendering context to the given object.</p>

    <p>Throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception if the <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> or <code title="dom-canvas-transferControlToProxy"><a href="#dom-canvas-transfercontroltoproxy">transferControlToProxy()</a></code> methods have been
    used.</p>

   </dd>

  </dl><div class="impl">

  <p>There are two ways for a <code><a href="#the-canvas-element">canvas</a></code> element to acquire a rendering context: the
  <code><a href="#the-canvas-element">canvas</a></code> element can provide one via the <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> method, and one can be assigned to it via the
  <code title="dom-canvas-setContext"><a href="#dom-canvas-setcontext">setContext()</a></code> method. In addition, the whole issue of a
  rendering context can be taken out of the <code><a href="#the-canvas-element">canvas</a></code> element's hands and passed to a
  <code><a href="#canvasproxy">CanvasProxy</a></code> object, which itself can then be assigned a rendering context using its
  <code title="dom-CanvasProxy-setContext"><a href="#dom-canvasproxy-setcontext">setContext()</a></code> method.</p>

  <p>These three methods are mutually exclusive; calling any of the three makes the other two start
  throwing <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exceptions when called.</p>

  <p>Each rendering context has a <dfn id="concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap
  mode</dfn>, which is one of <dfn id="concept-canvas-fixed" title="concept-canvas-fixed">fixed</dfn>, <dfn id="concept-canvas-unbound" title="concept-canvas-unbound">unbound</dfn>, or <dfn id="concept-canvas-bound" title="concept-canvas-bound">bound</dfn>.
  Initially, rendering contexts must be in the <a href="#concept-canvas-bound" title="concept-canvas-bound">unbound</a>
  mode.</p>

  <hr><p>The <dfn id="dom-canvas-getcontext" title="dom-canvas-getContext"><code>getContext(<var title="">contextId</var>, <var title="">arguments...</var>)</code></dfn> method of the <code><a href="#the-canvas-element">canvas</a></code> element, when invoked,
  must run the steps in the cell of the following table whose column header describes the
  <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">canvas context mode</a>
  and whose row header describes the method's first argument.</p>

  <table><thead><tr><td>
     </td><th><a href="#concept-canvas-none" title="concept-canvas-none">none</a>
     </th><th><a href="#concept-canvas-direct-2d" title="concept-canvas-direct-2d">direct-2d</a>
     </th><th><a href="#concept-canvas-direct-webgl" title="concept-canvas-direct-webgl">direct-webgl</a>
     </th><th><a href="#concept-canvas-indirect" title="concept-canvas-indirect">indirect</a>
     </th><th><a href="#concept-canvas-proxied" title="concept-canvas-proxied">proxied</a>
   </th></tr></thead><tbody><tr><th>"<dfn id="canvas-context-2d" title="canvas-context-2d"><code>2d</code></dfn>"
     </th><td>
      Set the <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">context
      mode</a> to <a href="#concept-canvas-direct-2d" title="concept-canvas-direct-2d">direct-2d</a>; follow the <a href="#2d-context-creation-algorithm">2D
      context creation algorithm</a> defined in the section below, passing it the
      <code><a href="#the-canvas-element">canvas</a></code> element, to obtain a <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object; set
      that object's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> to
      <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, and return the
      <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object
     </td><td>
      Return the same object as was return the last time the method was invoked with this same
      argument.
     </td><td>
      Return null.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.

    </td></tr><tr><th>"<dfn id="canvas-context-webgl" title="canvas-context-webgl"><code>webgl</code></dfn>", if the user agent supports the WebGL feature in its current configuration
     </th><td>
      Follow the instructions given in the WebGL specification's <i>Context Creation</i> section to
      obtain either a <code><a href="infrastructure.html#webglrenderingcontext">WebGLRenderingContext</a></code> or null; if the returned value is null,
      then return null and abort these steps, otherwise, set the <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">context mode</a> to <a href="#concept-canvas-direct-webgl" title="concept-canvas-direct-webgl">direct-webgl</a>, set the new
      <code><a href="infrastructure.html#webglrenderingcontext">WebGLRenderingContext</a></code> object's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> to <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, and return the <code><a href="infrastructure.html#webglrenderingcontext">WebGLRenderingContext</a></code>
      object‡ <a href="references.html#refsWEBGL">[WEBGL]</a>
     </td><td>
      Return null.
     </td><td>
      Return the same object as was return the last time the method was invoked with this same
      argument.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.

    </td></tr><tr><th>A vendor-specific extension*
     </th><td>
      Behave as defined for the extension.
     </td><td>
      Behave as defined for the extension.
     </td><td>
      Behave as defined for the extension.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.

    </td></tr><tr><th>An unsupported value†
     </th><td>
      Return null.
     </td><td>
      Return null.
     </td><td>
      Return null.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.
     </td><td>
      Throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.

  </td></tr></tbody></table><p class="tablenote"><small>* Vendors may define experimental contexts using the syntax <code><var title="">vendorname</var>-<var title="">context</var></code>, for example,
  <code>moz-3d</code>.</small></p>

  <p class="tablenote"><small>† For example, the "<code title="canvas-context-webgl"><a href="#canvas-context-webgl">webgl</a></code>" value in the case of a user agent having exhausted the
  graphics hardware's abilities and having no software fallback implementation.</small></p>

  <p class="tablenote"><small>‡ The second (and subsequent) argument(s) to the method, if
  any, are ignored in all cases except this one. See the WebGL specification for
  details.</small></p>

  <hr><p>The <dfn id="dom-canvas-probablysupportscontext" title="dom-canvas-probablySupportsContext"><code>probablySupportsContext(<var title="">contextId</var>,
  <var title="">arguments...</var>)</code></dfn> method of the <code><a href="#the-canvas-element">canvas</a></code> element, when
  invoked, must return false if calling <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> on
  the same object and with the same arguments would definitely return null at this time, and true
  otherwise.</p>

  <hr><p>The <dfn id="dom-canvas-setcontext" title="dom-canvas-setContext"><code>setContext(<var title="">context</var>)</code></dfn> method of the <code><a href="#the-canvas-element">canvas</a></code> element, when invoked, must
  run the following steps:</p>

  <ol><li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">canvas
   context mode</a> is neither <a href="#concept-canvas-none" title="concept-canvas-none">none</a> nor <a href="#concept-canvas-indirect" title="concept-canvas-indirect">indirect</a>, throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code>
   exception and abort these steps.</p></li>

   <li><p>If <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
   bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, then throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</p></li>

   <li><p>If <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
   bitmap mode</a> is <a href="#concept-canvas-bound" title="concept-canvas-bound">bound</a>, then run <var title="">context</var>'s <a href="#concept-canvas-unbinding-steps" title="concept-canvas-unbinding-steps">unbinding steps</a> and
   set its <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
   bitmap mode</a> to <a href="#concept-canvas-unbound" title="concept-canvas-unbound">unbound</a>.</p></li>

   <li><p>Run <var title="">context</var>'s <a href="#concept-canvas-binding-steps" title="concept-canvas-binding-steps">binding
   steps</a> to bind it to this <code><a href="#the-canvas-element">canvas</a></code> element.</p></li>

   <li><p>Set the <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">context
   mode</a> to <a href="#concept-canvas-indirect" title="concept-canvas-indirect">indirect</a> and the <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap
   mode</a> to <a href="#concept-canvas-bound" title="concept-canvas-bound">bound</a>.</p></li>

  </ol><hr></div>

  <dl class="domintro"><dt><var title="">url</var> = <var title="">canvas</var> . <code title="dom-canvas-toDataURL"><a href="#dom-canvas-todataurl">toDataURL</a></code>( [ <var title="">type</var>, ... ] )</dt>

   <dd>

    <p>Returns a <a href="infrastructure.html#data-protocol" title="data protocol"><code title="">data:</code> URL</a> for the image in
    the canvas.</p>

    <p>The first argument, if provided, controls the type of the image to be returned (e.g. PNG or
    JPEG). The default is <code title="">image/png</code>; that type is also used if the given type
    isn't supported. The other arguments are specific to the type, and control the way that the
    image is generated, as given <a href="#canvas-serialization-arguments">in the table
    below</a>.</p>

    <p>When trying to use types other than "<code>image/png</code>", authors can check if the image
    was really returned in the requested format by checking to see if the returned string starts
    with one of the exact strings "<code title="">data:image/png,</code>" or "<code title="">data:image/png;</code>". If it does, the image is PNG, and thus the requested type was
    not supported. (The one exception to this is if the canvas has either no height or no width, in
    which case the result might simply be "<code title="">data:,</code>".)</p>

   </dd>

   <dt><var title="">canvas</var> . <code title="dom-canvas-toBlob"><a href="#dom-canvas-toblob">toBlob</a></code>(<var title="">callback</var> [, <var title="">type</var>, ... ] )</dt>

   <dd>

    <p>Creates a <code><a href="infrastructure.html#blob">Blob</a></code> object representing a file containing the image in the canvas,
    and invokes a callback with a handle to that object.</p>

    <p>The second argument, if provided, controls the type of the image to be returned (e.g. PNG or
    JPEG). The default is <code title="">image/png</code>; that type is also used if the given type
    isn't supported. The other arguments are specific to the type, and control the way that the
    image is generated, as given <a href="#canvas-serialization-arguments">in the table
    below</a>.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-canvas-todataurl" title="dom-canvas-toDataURL"><code>toDataURL()</code></dfn> method must run the
  following steps:</p>

  <ol><!--ADD-TOPIC:Security--><li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element's bitmap's <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag is set to false, throw a
   <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>
<!--REMOVE-TOPIC:Security-->

   </li><li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element's bitmap has no pixels (i.e. either its horizontal
   dimension or its vertical dimension is zero) then return the string "<code title="">data:,</code>" and abort these steps. (This is the shortest <a href="infrastructure.html#data-protocol" title="data
   protocol"><code title="">data:</code> URL</a>; it represents the empty string in a <code title="">text/plain</code> resource.)</p></li>

   <li><p>Let <var title="">file</var> be <a href="#a-serialization-of-the-bitmap-as-a-file" title="a serialization of the bitmap as a file">a
   serialization of the <code>canvas</code> element's bitmap as a file</a>, using the method's
   arguments (if any) as the <var title="">arguments</var>.</p></li>

   <li><p>Return a <a href="infrastructure.html#data-protocol" title="data protocol"><code title="">data:</code> URL</a> representing
   <var title="">file</var>. <a href="references.html#refsRFC2397">[RFC2397]</a></p>

   <!-- should we explicitly require the URL to be base64-encoded and not have any parameters, to
   ensure the same exact URL is generated in each browser? -->

  </li></ol><p>The <dfn id="dom-canvas-toblob" title="dom-canvas-toBlob"><code>toBlob()</code></dfn> method must run the following
  steps:</p>

  <ol><!--ADD-TOPIC:Security--><li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element's bitmap's <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag is set to false, throw a
   <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>
<!--REMOVE-TOPIC:Security-->

   </li><li><p>Let <var title="">callback</var> be the first argument.</p></li>

   <li><p>Let <var title="">arguments</var> be the second and subsequent arguments to the method, if
   any.</p></li>

   <li>

    <p>If the <code><a href="#the-canvas-element">canvas</a></code> element's bitmap has no pixels (i.e. either its horizontal
    dimension or its vertical dimension is zero) then let <var title="">result</var> be null.</p>

    <p>Otherwise, let <var title="">result</var> be a <code><a href="infrastructure.html#blob">Blob</a></code> object representing <a href="#a-serialization-of-the-bitmap-as-a-file" title="a serialization of the bitmap as a file">a serialization of the <code>canvas</code>
    element's bitmap as a file</a>, using <var title="">arguments</var>. <a href="references.html#refsFILEAPI">[FILEAPI]</a> </p>

   </li>

   <li><p>Return, but continue running these steps asynchronously.</p></li>

   <li><p>If <var title="">callback</var> is null, abort these steps.</p></li>

   <li><p><a href="webappapis.html#queue-a-task">Queue a task</a> to invoke the <code><a href="common-dom-interfaces.html#filecallback">FileCallback</a></code> <var title="">callback</var> with <var title="">result</var> as its argument. The <a href="webappapis.html#task-source">task
   source</a> for this task is the <dfn id="canvas-blob-serialization-task-source">canvas blob serialization task source</dfn>.</p></li>

  </ol></div>
  <!--REMOVE-TOPIC:DOM APIs-->


  <!--ADD-TOPIC:Workers-->
  <h5 id="proxying-canvases-to-workers"><span class="secno">4.12.4.1 </span>Proxying canvases to workers</h5>

  <p>Since DOM nodes cannot be accessed across worker boundaries, a proxy object is needed to enable
  workers to render to <code><a href="#the-canvas-element">canvas</a></code> elements in <code><a href="dom.html#document">Document</a></code>s.</p>

  <pre class="idl">[Exposed=Window,Worker]
interface <dfn id="canvasproxy">CanvasProxy</dfn> {
  void <a href="#dom-canvasproxy-setcontext" title="dom-CanvasProxy-setContext">setContext</a>(<a href="#renderingcontext">RenderingContext</a> context);
};
// <a href="#canvasproxy">CanvasProxy</a> implements <a href="common-dom-interfaces.html#transferable">Transferable</a>;</pre>

  <dl class="domintro"><dt><var title="">canvasProxy</var> = <var title="">canvas</var> . <code title="dom-canvas-transferControlToProxy"><a href="#dom-canvas-transfercontroltoproxy">transferControlToProxy</a></code>()</dt>

   <dd>

    <p>Returns a <code><a href="#canvasproxy">CanvasProxy</a></code> object that can be used to transfer control for this
    canvas over to another document (e.g. an <code><a href="the-iframe-element.html#the-iframe-element">iframe</a></code> from another <a href="origin-0.html#origin">origin</a>)
    or to a worker.</p>

    <p>Throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception if the <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> or <code title="dom-canvas-setContext"><a href="#dom-canvas-setcontext">setContext()</a></code> methods have been used.</p>

   </dd>

   <dt><var title="">canvasProxy</var> . <code title="dom-CanvasProxy-setContext"><a href="#dom-canvasproxy-setcontext">setContext</a></code>(<var title="">context</var>)</dt>

   <dd>

    <p>Sets the <code><a href="#canvasproxy">CanvasProxy</a></code> object's <code><a href="#the-canvas-element">canvas</a></code> element's rendering context to
    the given object.</p>

    <p>Throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception if the <code><a href="#canvasproxy">CanvasProxy</a></code> has been
    <a href="common-dom-interfaces.html#transfer-a-transferable-object" title="transfer a Transferable object">transfered</a>.</p>

   </dd>

  </dl><hr><p>The <dfn id="dom-canvas-transfercontroltoproxy" title="dom-canvas-transferControlToProxy"><code>transferControlToProxy()</code></dfn>
  method of the <code><a href="#the-canvas-element">canvas</a></code> element, when invoked, must run the following steps:</p>

  <ol><li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">canvas
   context mode</a> is not <a href="#concept-canvas-none" title="concept-canvas-none">none</a>, throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</p></li>

   <li><p>Set the <code><a href="#the-canvas-element">canvas</a></code> element's <a href="#concept-canvas-context-mode" title="concept-canvas-context-mode">context
   mode</a> to <a href="#concept-canvas-proxied" title="concept-canvas-proxied">proxied</a>.</p></li>

   <li><p>Return a <code><a href="#canvasproxy">CanvasProxy</a></code> object bound to this <code><a href="#the-canvas-element">canvas</a></code>
   element.</p></li>

  </ol><p>A <code><a href="#canvasproxy">CanvasProxy</a></code> object can be <a href="common-dom-interfaces.html#concept-transferable-neutered" title="concept-transferable-neutered">neutered</a> (like any <code><a href="common-dom-interfaces.html#transferable">Transferable</a></code> object),
  meaning it can no longer be <a href="common-dom-interfaces.html#transfer-a-transferable-object" title="transfer a Transferable object">transferred</a>, and
  can be <dfn id="concept-canvasproxy-disabled" title="concept-CanvasProxy-disabled">disabled</dfn>, meaning it can no longer be bound
  to rendering contexts. When first created, a <code><a href="#canvasproxy">CanvasProxy</a></code> object must be neither.</p>

  <p>A <code><a href="#canvasproxy">CanvasProxy</a></code> is created with a link to a <code><a href="#the-canvas-element">canvas</a></code> element. A
  <code><a href="#canvasproxy">CanvasProxy</a></code> object that has not been <a href="#concept-canvasproxy-disabled" title="concept-CanvasProxy-disabled">disabled</a> must have a strong reference to its canvas
  element.</p>

  <p>The <dfn id="dom-canvasproxy-setcontext" title="dom-CanvasProxy-setContext"><code>setContext(<var title="">context</var>)</code></dfn> method of <code><a href="#canvasproxy">CanvasProxy</a></code> objects, when invoked,
  must run the following steps:</p>

  <ol><li><p>If the <code><a href="#canvasproxy">CanvasProxy</a></code> object has been <a href="#concept-canvasproxy-disabled" title="concept-CanvasProxy-disabled">disabled</a>, throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code>
   exception and abort these steps.</p></li>

   <li><p>If the <code><a href="#canvasproxy">CanvasProxy</a></code> object has not been <a href="common-dom-interfaces.html#concept-transferable-neutered" title="concept-transferable-neutered">neutered</a>, then <a href="common-dom-interfaces.html#concept-transferable-neutered" title="concept-transferable-neutered">neuter</a> it.</p></li>

   <li><p>If <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
   bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, then throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</p></li>

   <li><p>If <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
   bitmap mode</a> is <a href="#concept-canvas-bound" title="concept-canvas-bound">bound</a>, then run <var title="">context</var>'s <a href="#concept-canvas-unbinding-steps" title="concept-canvas-unbinding-steps">unbinding steps</a> and
   set its <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
   bitmap mode</a> to <a href="#concept-canvas-unbound" title="concept-canvas-unbound">unbound</a>.</p></li>

   <li><p>Run <var title="">context</var>'s <a href="#concept-canvas-binding-steps" title="concept-canvas-binding-steps">binding
   steps</a> to bind it to this <code><a href="#canvasproxy">CanvasProxy</a></code> object's <code><a href="#the-canvas-element">canvas</a></code>
   element.</p></li>

   <li><p>Set the <var title="">context</var>'s <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> to <a href="#concept-canvas-bound" title="concept-canvas-bound">bound</a>.</p></li>

  </ol><p id="transferCanvasProxy">To <a href="common-dom-interfaces.html#transfer-a-transferable-object" title="transfer a Transferable object">transfer</a> a
  <code><a href="#canvasproxy">CanvasProxy</a></code> object <var title="">old</var> to a new owner <var title="">owner</var>,
  a user agent must create a new <code><a href="#canvasproxy">CanvasProxy</a></code> object linked to the same
  <code><a href="#the-canvas-element">canvas</a></code> element as <var title="">old</var>, thus obtaining <var title="">new</var>,
  must <a href="common-dom-interfaces.html#concept-transferable-neutered" title="concept-Transferable-neutered">neuter</a> and <a href="#concept-canvasproxy-disabled" title="concept-CanvasProxy-disabled">disable</a> the <var title="">old</var> object, and must
  finally return <var title="">new</var>.</p>

  <div class="example">

   <p>Here is a clock implemented on a worker. First, the main page:</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;title&gt;Clock&lt;/title&gt;
&lt;canvas&gt;&lt;/canvas&gt; <!-- defaults to 300x150 -->
&lt;script&gt;
  var canvas = document.getElementsByTagName('canvas')[0];
  var proxy = canvas.transferControlToProxy();
  var worker = new Worker('clock.js');
  worker.postMessage(proxy, [proxy]);
&lt;/script&gt;</pre>

   <p>Second, the worker:</p>

   <pre>onmessage = function (event) {
  var context = new CanvasRenderingContext2D();
  event.data.setContext(context); // event.data is the CanvasProxy object
  setInterval(function () {
    context.clearRect(0, 0, context.width, context.height);
    context.fillText(new Date(), 0, 100);
    context.commit();
  }, 1000);
};</pre>

  </div>

  <!--REMOVE-TOPIC:Workers-->


  <h5 id="2dcontext"><span class="secno">4.12.4.2 </span>The 2D rendering context</h5>

  <!-- v2: we're on v5. suggestions for subsequent versions are marked v6, v7, v8. -->

  <pre class="idl">typedef (<a href="edits.html#htmlimageelement">HTMLImageElement</a> or
         <a href="the-video-element.html#htmlvideoelement">HTMLVideoElement</a> or
         <a href="#htmlcanvaselement">HTMLCanvasElement</a> or
         <a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a> or
         <a href="timers.html#imagebitmap">ImageBitmap</a>) <dfn id="canvasimagesource">CanvasImageSource</dfn>;

enum <dfn id="canvasfillrule">CanvasFillRule</dfn> { "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>", "<a href="#dom-context-2d-fillrule-evenodd" title="dom-context-2d-fillRule-evenodd">evenodd</a>" };

[<a href="#dom-context-2d" title="dom-context-2d">Constructor</a>(optional unsigned long width, unsigned long height), Exposed=Window,Worker]
interface <dfn id="canvasrenderingcontext2d">CanvasRenderingContext2D</dfn> {

  // back-reference to the canvas
  readonly attribute <a href="#htmlcanvaselement">HTMLCanvasElement</a> <a href="#dom-context-2d-canvas" title="dom-context-2d-canvas">canvas</a>;

  // canvas dimensions
           attribute unsigned long <a href="#dom-context-2d-width" title="dom-context-2d-width">width</a>;
           attribute unsigned long <a href="#dom-context-2d-height" title="dom-context-2d-height">height</a>;

  // for contexts that aren't directly <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a> to a specific canvas
  void <a href="#dom-context-2d-commit" title="dom-context-2d-commit">commit</a>(); // push the image to the <a href="#output-bitmap">output bitmap</a>

  // state
  void <a href="#dom-context-2d-save" title="dom-context-2d-save">save</a>(); // push state on state stack
  void <a href="#dom-context-2d-restore" title="dom-context-2d-restore">restore</a>(); // pop state stack and restore state
<!--
  // v7 we've also received requests for:
          attribute boolean <span title="dom-context-2d-forceHighQuality">forceHighQuality</span> // (default false)
  // when enabled, it would prevent the UA from falling back on lower-quality but faster rendering routines
  // useful e.g. for when an image manipulation app uses <canvas> both for UI previews and the actual work

-->
  // transformations (default transform is the identity matrix)
           attribute <a href="infrastructure.html#svgmatrix">SVGMatrix</a> <a href="#dom-context-2d-currenttransform" title="dom-context-2d-currentTransform">currentTransform</a>;
  void <a href="#dom-context-2d-scale" title="dom-context-2d-scale">scale</a>(unrestricted double x, unrestricted double y);
  void <a href="#dom-context-2d-rotate" title="dom-context-2d-rotate">rotate</a>(unrestricted double angle);
  void <a href="#dom-context-2d-translate" title="dom-context-2d-translate">translate</a>(unrestricted double x, unrestricted double y);
  void <a href="#dom-context-2d-transform" title="dom-context-2d-transform">transform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
  void <a href="#dom-context-2d-settransform" title="dom-context-2d-setTransform">setTransform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
  void <a href="#dom-context-2d-resettransform" title="dom-context-2d-resetTransform">resetTransform</a>();
<!--
  // v7 we've also received requests (though not many so far) for:
  void skew(...);                             // is this common enough that one can't just use setTransform()?
  void reflect(...);  and  void mirror(...);  // aren't negative values in scale() sufficient for these?

-->
  // compositing
           attribute unrestricted double <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">globalAlpha</a>; // (default 1.0)
           attribute DOMString <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">globalCompositeOperation</a>; // (default source-over)

  // image smoothing
           attribute boolean <a href="#dom-context-2d-imagesmoothingenabled" title="dom-context-2d-imageSmoothingEnabled">imageSmoothingEnabled</a>; // (default true)
<!--
  // v7 we've also received requests for:
  - turning off antialiasing to avoid seams when patterns are painted next to each other
    - might be better to overdraw?
    - might be better to just draw at a higher res then downsample, like for 3d?
  - nested layers
    - the ability to composite an entire set of drawing operations with one shadow all at once
      http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2008-August/015567.html

-->
  // colors and styles (see also the <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> interface)
           attribute (DOMString or CanvasGradient or CanvasPattern) <a href="#dom-context-2d-strokestyle" title="dom-context-2d-strokeStyle">strokeStyle</a>; // (default black)
           attribute (DOMString or CanvasGradient or CanvasPattern) <a href="#dom-context-2d-fillstyle" title="dom-context-2d-fillStyle">fillStyle</a>; // (default black)
  <a href="#canvasgradient">CanvasGradient</a> <a href="#dom-context-2d-createlineargradient" title="dom-context-2d-createLinearGradient">createLinearGradient</a>(double x0, double y0, double x1, double y1);
  <a href="#canvasgradient">CanvasGradient</a> <a href="#dom-context-2d-createradialgradient" title="dom-context-2d-createRadialGradient">createRadialGradient</a>(double x0, double y0, double r0, double x1, double y1, double r1);
  <a href="#canvaspattern">CanvasPattern</a> <a href="#dom-context-2d-createpattern" title="dom-context-2d-createPattern">createPattern</a>(<a href="#canvasimagesource">CanvasImageSource</a> image, [TreatNullAs=EmptyString] DOMString repetition);
<!--
  // v8 we received one request from Ralf Richard G&oml;bel for a new kind of pattern: a hatch.
  // basically it would be a series of dash styles, angles, line widths, and offsets
-->
  // shadows
           attribute unrestricted double <a href="#dom-context-2d-shadowoffsetx" title="dom-context-2d-shadowOffsetX">shadowOffsetX</a>; // (default 0)
           attribute unrestricted double <a href="#dom-context-2d-shadowoffsety" title="dom-context-2d-shadowOffsetY">shadowOffsetY</a>; // (default 0)
           attribute unrestricted double <a href="#dom-context-2d-shadowblur" title="dom-context-2d-shadowBlur">shadowBlur</a>; // (default 0)
           attribute DOMString <a href="#dom-context-2d-shadowcolor" title="dom-context-2d-shadowColor">shadowColor</a>; // (default transparent black)

  // rects
  void <a href="#dom-context-2d-clearrect" title="dom-context-2d-clearRect">clearRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href="#dom-context-2d-fillrect" title="dom-context-2d-fillRect">fillRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href="#dom-context-2d-strokerect" title="dom-context-2d-strokeRect">strokeRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);

  // path API (see also <a href="#canvaspathmethods">CanvasPathMethods</a>)
  void <a href="#dom-context-2d-beginpath" title="dom-context-2d-beginPath">beginPath</a>();
  void <a href="#dom-context-2d-fill" title="dom-context-2d-fill">fill</a>(optional <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>");
  void <a href="#dom-context-2d-fill" title="dom-context-2d-fill">fill</a>(<a href="#path2d">Path2D</a> path, optional <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>");
  void <a href="#dom-context-2d-stroke" title="dom-context-2d-stroke">stroke</a>();
  void <a href="#dom-context-2d-stroke" title="dom-context-2d-stroke">stroke</a>(<a href="#path2d">Path2D</a> path);
  void <a href="#dom-context-2d-drawsystemfocusring" title="dom-context-2d-drawSystemFocusRing">drawSystemFocusRing</a>(<a href="infrastructure.html#element">Element</a> element);
  void <a href="#dom-context-2d-drawsystemfocusring" title="dom-context-2d-drawSystemFocusRing">drawSystemFocusRing</a>(<a href="#path2d">Path2D</a> path, <a href="infrastructure.html#element">Element</a> element);
  boolean <a href="#dom-context-2d-drawcustomfocusring" title="dom-context-2d-drawCustomFocusRing">drawCustomFocusRing</a>(<a href="infrastructure.html#element">Element</a> element);
  boolean <a href="#dom-context-2d-drawcustomfocusring" title="dom-context-2d-drawCustomFocusRing">drawCustomFocusRing</a>(<a href="#path2d">Path2D</a> path, <a href="infrastructure.html#element">Element</a> element);
  void <a href="#dom-context-2d-scrollpathintoview" title="dom-context-2d-scrollPathIntoView">scrollPathIntoView</a>();
  void <a href="#dom-context-2d-scrollpathintoview" title="dom-context-2d-scrollPathIntoView">scrollPathIntoView</a>(<a href="#path2d">Path2D</a> path);
  void <a href="#dom-context-2d-clip" title="dom-context-2d-clip">clip</a>(optional <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>");
  void <a href="#dom-context-2d-clip" title="dom-context-2d-clip">clip</a>(<a href="#path2d">Path2D</a> path, optional <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>");
  void <a href="#dom-context-2d-resetclip" title="dom-context-2d-resetClip">resetClip</a>();
  boolean <a href="#dom-context-2d-ispointinpath" title="dom-context-2d-isPointInPath">isPointInPath</a>(unrestricted double x, unrestricted double y, optional <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>");
  boolean <a href="#dom-context-2d-ispointinpath" title="dom-context-2d-isPointInPath">isPointInPath</a>(<a href="#path2d">Path2D</a> path, unrestricted double x, unrestricted double y, optional <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>");
  boolean <a href="#dom-context-2d-ispointinstroke" title="dom-context-2d-isPointInStroke">isPointInStroke</a>(unrestricted double x, unrestricted double y);
  boolean <a href="#dom-context-2d-ispointinstroke" title="dom-context-2d-isPointInStroke">isPointInStroke</a>(<a href="#path2d">Path2D</a> path, unrestricted double x, unrestricted double y);

  // text (see also the <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> interface)
  void <a href="#dom-context-2d-filltext" title="dom-context-2d-fillText">fillText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href="#dom-context-2d-stroketext" title="dom-context-2d-strokeText">strokeText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);<!-- v6DVT
  void <span title="dom-context-2d-fillVerticalText">fillVerticalText</span>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxHeight);
  void <span title="dom-context-2d-strokeVerticalText">strokeVerticalText</span>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxHeight); -->
  <a href="#textmetrics">TextMetrics</a> <a href="#dom-context-2d-measuretext" title="dom-context-2d-measureText">measureText</a>(DOMString text);

  // drawing images
  void <a href="#dom-context-2d-drawimage" title="dom-context-2d-drawImage">drawImage</a>(<a href="#canvasimagesource">CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy);
  void <a href="#dom-context-2d-drawimage" title="dom-context-2d-drawImage">drawImage</a>(<a href="#canvasimagesource">CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);
  void <a href="#dom-context-2d-drawimage" title="dom-context-2d-drawImage">drawImage</a>(<a href="#canvasimagesource">CanvasImageSource</a> image, unrestricted double sx, unrestricted double sy, unrestricted double sw, unrestricted double sh, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);

  // hit regions
  void <a href="#dom-context-2d-addhitregion" title="dom-context-2d-addHitRegion">addHitRegion</a>(optional <a href="#hitregionoptions">HitRegionOptions</a> options);
  void <a href="#dom-context-2d-removehitregion" title="dom-context-2d-removeHitRegion">removeHitRegion</a>(DOMString id);

  // pixel manipulation
  <a href="#imagedata">ImageData</a> <a href="#dom-context-2d-createimagedata" title="dom-context-2d-createImageData">createImageData</a>(double sw, double sh);
  <a href="#imagedata">ImageData</a> <a href="#dom-context-2d-createimagedata" title="dom-context-2d-createImageData">createImageData</a>(<a href="#imagedata">ImageData</a> imagedata);
  <a href="#imagedata">ImageData</a> <a href="#dom-context-2d-getimagedata" title="dom-context-2d-getImageData">getImageData</a>(double sx, double sy, double sw, double sh);
  void <a href="#dom-context-2d-putimagedata" title="dom-context-2d-putImageData">putImageData</a>(<a href="#imagedata">ImageData</a> imagedata, double dx, double dy);
  void <a href="#dom-context-2d-putimagedata" title="dom-context-2d-putImageData">putImageData</a>(<a href="#imagedata">ImageData</a> imagedata, double dx, double dy, double dirtyX, double dirtyY, double dirtyWidth, double dirtyHeight);
};
<a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a> implements <a href="#canvasdrawingstyles">CanvasDrawingStyles</a>;
<a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a> implements <a href="#canvaspathmethods">CanvasPathMethods</a>;

[NoInterfaceObject, Exposed=Window,Worker]
interface <dfn id="canvasdrawingstyles">CanvasDrawingStyles</dfn> {
  // line caps/joins
           attribute unrestricted double <a href="#dom-context-2d-linewidth" title="dom-context-2d-lineWidth">lineWidth</a>; // (default 1)
           attribute DOMString <a href="#dom-context-2d-linecap" title="dom-context-2d-lineCap">lineCap</a>; // "butt", "round", "square" (default "butt")
           attribute DOMString <a href="#dom-context-2d-linejoin" title="dom-context-2d-lineJoin">lineJoin</a>; // "round", "bevel", "miter" (default "miter")
           attribute unrestricted double <a href="#dom-context-2d-miterlimit" title="dom-context-2d-miterLimit">miterLimit</a>; // (default 10)

  // dashed lines
  void <a href="#dom-context-2d-setlinedash" title="dom-context-2d-setLineDash">setLineDash</a>(sequence&lt;unrestricted double&gt; segments); // default empty
  sequence&lt;unrestricted double&gt; <a href="#dom-context-2d-getlinedash" title="dom-context-2d-getLineDash">getLineDash</a>();
           attribute unrestricted double <a href="#dom-context-2d-linedashoffset" title="dom-context-2d-lineDashOffset">lineDashOffset</a>;

  // text
           attribute DOMString <a href="#dom-context-2d-font" title="dom-context-2d-font">font</a>; // (default 10px sans-serif)
           attribute DOMString <a href="#dom-context-2d-textalign" title="dom-context-2d-textAlign">textAlign</a>; // "start", "end", "left", "right", "center" (default: "start")
           attribute DOMString <a href="#dom-context-2d-textbaseline" title="dom-context-2d-textBaseline">textBaseline</a>; // "top", "hanging", "middle", "alphabetic", "ideographic", "bottom" (default: "alphabetic")
           attribute DOMString <a href="#dom-context-2d-direction" title="dom-context-2d-direction">direction</a>; // "ltr", "rtl"<!--, "auto"-->, "inherit" (default: "inherit")
};

[NoInterfaceObject, Exposed=Window,Worker]
interface <dfn id="canvaspathmethods">CanvasPathMethods</dfn> {
  // shared path API methods
  void <a href="#dom-context-2d-closepath" title="dom-context-2d-closePath">closePath</a>();
  void <a href="#dom-context-2d-moveto" title="dom-context-2d-moveTo">moveTo</a>(unrestricted double x, unrestricted double y);
  void <a href="#dom-context-2d-lineto" title="dom-context-2d-lineTo">lineTo</a>(unrestricted double x, unrestricted double y);
  void <a href="#dom-context-2d-quadraticcurveto" title="dom-context-2d-quadraticCurveTo">quadraticCurveTo</a>(unrestricted double cpx, unrestricted double cpy, unrestricted double x, unrestricted double y);
  void <a href="#dom-context-2d-beziercurveto" title="dom-context-2d-bezierCurveTo">bezierCurveTo</a>(unrestricted double cp1x, unrestricted double cp1y, unrestricted double cp2x, unrestricted double cp2y, unrestricted double x, unrestricted double y);
  void <a href="#dom-context-2d-arcto" title="dom-context-2d-arcTo">arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radius); <!-- see ARC-ORDER note below -->
  void <a href="#dom-context-2d-arcto" title="dom-context-2d-arcTo">arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radiusX, unrestricted double radiusY, unrestricted double rotation); <!-- see ARC-ORDER note below -->
  void <a href="#dom-context-2d-rect" title="dom-context-2d-rect">rect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href="#dom-context-2d-arc" title="dom-context-2d-arc">arc</a>(unrestricted double x, unrestricted double y, unrestricted double radius, unrestricted double startAngle, unrestricted double endAngle, optional boolean anticlockwise = false); <!-- see ARC-ORDER note below -->
  void <a href="#dom-context-2d-ellipse" title="dom-context-2d-ellipse">ellipse</a>(unrestricted double x, unrestricted double y, unrestricted double radiusX, unrestricted double radiusY, unrestricted double rotation, unrestricted double startAngle, unrestricted double endAngle, optional boolean anticlockwise = false); <!-- see ARC-ORDER note below -->
};

[Exposed=Window,Worker]
interface <dfn id="canvasgradient">CanvasGradient</dfn> {
  // opaque object
  void <a href="#dom-canvasgradient-addcolorstop" title="dom-canvasgradient-addColorStop">addColorStop</a>(double offset, DOMString color);
};

[Exposed=Window,Worker]
interface <dfn id="canvaspattern">CanvasPattern</dfn> {
  // opaque object
  void <a href="#dom-canvaspattern-settransform" title="dom-canvaspattern-setTransform">setTransform</a>(<a href="infrastructure.html#svgmatrix">SVGMatrix</a> transform);
};

[Exposed=Window,Worker]
interface <dfn id="textmetrics">TextMetrics</dfn> {
  // x-direction
  readonly attribute double <a href="#dom-textmetrics-width" title="dom-textmetrics-width">width</a>; // advance width
  readonly attribute double <a href="#dom-textmetrics-actualboundingboxleft" title="dom-textmetrics-actualBoundingBoxLeft">actualBoundingBoxLeft</a>;
  readonly attribute double <a href="#dom-textmetrics-actualboundingboxright" title="dom-textmetrics-actualBoundingBoxRight">actualBoundingBoxRight</a>;

  // y-direction
  readonly attribute double <a href="#dom-textmetrics-fontboundingboxascent" title="dom-textmetrics-fontBoundingBoxAscent">fontBoundingBoxAscent</a>;
  readonly attribute double <a href="#dom-textmetrics-fontboundingboxdescent" title="dom-textmetrics-fontBoundingBoxDescent">fontBoundingBoxDescent</a>;
  readonly attribute double <a href="#dom-textmetrics-actualboundingboxascent" title="dom-textmetrics-actualBoundingBoxAscent">actualBoundingBoxAscent</a>;
  readonly attribute double <a href="#dom-textmetrics-actualboundingboxdescent" title="dom-textmetrics-actualBoundingBoxDescent">actualBoundingBoxDescent</a>;
  readonly attribute double <a href="#dom-textmetrics-emheightascent" title="dom-textmetrics-emHeightAscent">emHeightAscent</a>;
  readonly attribute double <a href="#dom-textmetrics-emheightdescent" title="dom-textmetrics-emHeightDescent">emHeightDescent</a>;
  readonly attribute double <a href="#dom-textmetrics-hangingbaseline" title="dom-textmetrics-hangingBaseline">hangingBaseline</a>;
  readonly attribute double <a href="#dom-textmetrics-alphabeticbaseline" title="dom-textmetrics-alphabeticBaseline">alphabeticBaseline</a>;
  readonly attribute double <a href="#dom-textmetrics-ideographicbaseline" title="dom-textmetrics-ideographicBaseline">ideographicBaseline</a>;
};

dictionary <dfn id="hitregionoptions">HitRegionOptions</dfn> {
  <a href="#path2d">Path2D</a>? <a href="#dom-hitregionoptions-path" title="dom-HitRegionOptions-path">path</a> = null;
  <a href="#canvasfillrule">CanvasFillRule</a> <a href="#dom-hitregionoptions-fillrule" title="dom-HitRegionOptions-fillRule">fillRule</a> = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>";
<!--  <span>SVGMatrix</span>? <span title="dom-HitRegionOptions-transform">transform</span> = null;
-->  DOMString <a href="#dom-hitregionoptions-id" title="dom-HitRegionOptions-id">id</a> = ""; <!-- "" is converted to null internally by addHitRegion() -->
  DOMString? <a href="#dom-hitregionoptions-parentid" title="dom-HitRegionOptions-parentID">parentID</a> = null;
  DOMString <a href="#dom-hitregionoptions-cursor" title="dom-HitRegionOptions-cursor">cursor</a> = "inherit";
  // for control-backed regions:
  <a href="infrastructure.html#element">Element</a>? <a href="#dom-hitregionoptions-control" title="dom-HitRegionOptions-control">control</a> = null;
  // for unbacked regions:
  DOMString? <a href="#dom-hitregionoptions-label" title="dom-HitRegionOptions-label">label</a> = null;
  DOMString? <a href="#dom-hitregionoptions-role" title="dom-HitRegionOptions-role">role</a> = null;
};

[<a href="#dom-imagedata" title="dom-imagedata">Constructor</a>(unsigned long sw, unsigned long sh),
 <a href="#dom-imagedata" title="dom-imagedata">Constructor</a>(<a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a> data, unsigned long sw, optional unsigned long sh),
 Exposed=Window,Worker]
interface <dfn id="imagedata">ImageData</dfn> {
  readonly attribute unsigned long <a href="#dom-imagedata-width" title="dom-imagedata-width">width</a>;
  readonly attribute unsigned long <a href="#dom-imagedata-height" title="dom-imagedata-height">height</a>;
  readonly attribute <a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a> <a href="#dom-imagedata-data" title="dom-imagedata-data">data</a>;
};

[<a href="#dom-drawingstyle" title="dom-DrawingStyle">Constructor</a>(optional <a href="infrastructure.html#element">Element</a> scope), Exposed=Window,Worker]
interface <dfn id="drawingstyle">DrawingStyle</dfn> { };
<a href="#drawingstyle">DrawingStyle</a> implements <a href="#canvasdrawingstyles">CanvasDrawingStyles</a>;

[<a href="#dom-path2d" title="dom-Path2D">Constructor</a>,
 <a href="#dom-path2d-copy" title="dom-Path2D-copy">Constructor</a>(<a href="#path2d">Path2D</a> path),
 <a href="#dom-path2d-merge" title="dom-Path2D-merge">Constructor</a>(<a href="#path2d">Path2D</a>[] paths, <a href="#canvasfillrule">CanvasFillRule</a> fillRule = "<a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">nonzero</a>"),
 <a href="#dom-path2d-withdata" title="dom-Path2D-withdata">Constructor</a>(DOMString d), Exposed=Window,Worker]
interface <dfn id="path2d">Path2D</dfn> {
  void <a href="#dom-path2d-addpath" title="dom-Path2D-addPath">addPath</a>(<a href="#path2d">Path2D</a> path, optional <a href="infrastructure.html#svgmatrix">SVGMatrix</a>? transformation = null);
  void <a href="#dom-path2d-addpathbystrokingpath" title="dom-Path2D-addPathByStrokingPath">addPathByStrokingPath</a>(<a href="#path2d">Path2D</a> path, <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> styles, optional <a href="infrastructure.html#svgmatrix">SVGMatrix</a>? transformation = null);
  void <a href="#dom-path2d-addtext" title="dom-Path2D-addText">addText</a>(DOMString text, <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> styles, <a href="infrastructure.html#svgmatrix">SVGMatrix</a>? transformation, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href="#dom-path2d-addpathbystrokingtext" title="dom-Path2D-addPathByStrokingText">addPathByStrokingText</a>(DOMString text, <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> styles, <a href="infrastructure.html#svgmatrix">SVGMatrix</a>? transformation, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href="#dom-path2d-addtext" title="dom-Path2D-addText">addText</a>(DOMString text, <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> styles, <a href="infrastructure.html#svgmatrix">SVGMatrix</a>? transformation, <a href="#path2d">Path2D</a> path, optional unrestricted double maxWidth);
  void <a href="#dom-path2d-addpathbystrokingtext" title="dom-Path2D-addPathByStrokingText">addPathByStrokingText</a>(DOMString text, <a href="#canvasdrawingstyles">CanvasDrawingStyles</a> styles, <a href="infrastructure.html#svgmatrix">SVGMatrix</a>? transformation, <a href="#path2d">Path2D</a> path, optional unrestricted double maxWidth);
};
<a href="#path2d">Path2D</a> implements <a href="#canvaspathmethods">CanvasPathMethods</a>;</pre>

 <!-- ARC-ORDER note (see above):
      some demos rely on the precise order of the arc() and arcTo()
      methods, see https://bugzilla.mozilla.org/show_bug.cgi?id=623437
      for an example, and its duplicates for more -->

  <dl class="domintro"><dt><var title="">context</var> = <var title="">canvas</var> . <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext</a></code>('2d')</dt>

   <dd>

    <p>Returns a <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object that is permanently bound to a
    particular <code><a href="#the-canvas-element">canvas</a></code> element.</p>

   </dd>

   <dt><var title="">context</var> = new <code title="dom-context-2d"><a href="#dom-context-2d">CanvasRenderingContext2D</a></code>( [ <var title="">width</var>, <var title="">height</var> ] )</dt>

   <dd>

    <p>Returns an unbound <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object with an implied bitmap with
    the given dimensions in CSS pixels (300x150, if the arguments are omitted).</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-canvas"><a href="#dom-context-2d-canvas">canvas</a></code></dt>

   <dd>

    <p>Returns the <code><a href="#the-canvas-element">canvas</a></code> element, if the rendering context was obtained using the
    <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> method.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-width"><a href="#dom-context-2d-width">width</a></code></dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-height"><a href="#dom-context-2d-height">height</a></code></dt>

   <dd>

    <p>Return the dimensions of the bitmap, in CSS pixels.</p>

    <p>Can be set, to update the bitmap's dimensions. If the rendering context is bound to a canvas,
    this will also update the canvas' intrinsic dimensions.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-commit"><a href="#dom-context-2d-commit">commit</a></code>()</dt>

   <dd>

    <p>If the rendering context is bound to a <code><a href="#the-canvas-element">canvas</a></code>, display the current frame.</p>

   </dd>

  </dl><div class="impl">

  <p>A <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object can be obtained in two ways: the <code title="dom-canvas-getContext"><a href="#dom-canvas-getcontext">getContext()</a></code> method on a <code><a href="#the-canvas-element">canvas</a></code> element (which
  invokes the <a href="#2d-context-creation-algorithm">2D context creation algorithm</a>), and the <code title="dom-context-2d"><a href="#dom-context-2d">CanvasRenderingContext2D()</a></code> constructor.</p>

  <p>A <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object has a <dfn id="scratch-bitmap">scratch bitmap</dfn> and can be bound
  to an <dfn id="output-bitmap">output bitmap</dfn>. These are initialized when the object is created, and can be
  subsequently adjusted when the rendering context is <a href="#concept-canvas-binding-steps" title="concept-canvas-binding-steps">bound</a> or <a href="#concept-canvas-unbinding-steps" title="concept-canvas-unbinding-steps">unbound</a>. In some cases, these bitmaps are the same
  underlying bitmap. In general, the <a href="#scratch-bitmap">scratch bitmap</a> is what scripts interact with, and
  the <a href="#output-bitmap">output bitmap</a> is what is being displayed. These bitmaps always have the same
  dimensions.</p>

<!--ADD-TOPIC:Security-->
  <p>Each such bitmap has an <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag,
  which can be set to true or false. Initially, when one of these bitmaps is created, its <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag must be set to true.</p>
<!--REMOVE-TOPIC:Security-->

  <p>These bitmaps also have a <a href="#hit-region-list">hit region list</a>, which is described in a later section.
  Initially, this list is empty. <a href="#scratch-bitmap" title="scratch bitmap">Scratch bitmaps</a> also have a
  <dfn id="list-of-pending-interface-actions">list of pending interface actions</dfn>, which can contain instructions to draw the user's
  attention to a location on the bitmap, and instructions to scroll to a location on the bitmap.
  Initially, this list is also empty.</p>

  <p>The <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> 2D rendering context represents a flat linear
  Cartesian surface whose origin (0,0) is at the top left corner, with the coordinate space having
  <var title="">x</var> values increasing when going right, and <var title="">y</var> values
  increasing when going down. The <var title="">x</var>-coordinate of the right-most edge is equal to
  the width of the rendering context's <a href="#scratch-bitmap">scratch bitmap</a> in CSS pixels; similarly, the
  <var title="">y</var>-coordinate of the bottom-most edge is equal to the height of the rendering
  context's <a href="#scratch-bitmap">scratch bitmap</a> in CSS pixels.</p>

  <p>The size of the coordinate space does not necessarily represent the size of the actual bitmaps
  that the user agent will use internally or during rendering. On high-definition displays, for
  instance, the user agent may internally use bitmaps with two device pixels per unit in the
  coordinate space, so that the rendering remains at high quality throughout. Anti-aliasing can
  similarly be implemented using over-sampling with bitmaps of a higher resolution than the final
  image on the display.</p>

  <hr><p>The <dfn id="2d-context-creation-algorithm">2D context creation algorithm</dfn>, which is passed a <var title="">target</var> (a
  <code><a href="#the-canvas-element">canvas</a></code> element), consists of running the following steps:</p>

  <ol><li><p>Create a new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object.</p></li>

   <li><p>Initialize its <code title="dom-context-2d-canvas"><a href="#dom-context-2d-canvas">canvas</a></code> attribute to point to
   <var title="">target</var>.</p></li>

   <li><p>Let the new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#output-bitmap">output bitmap</a> and
   <a href="#scratch-bitmap">scratch bitmap</a> both be the same bitmap as <var title="">target</var>'s bitmap (so
   that they are shared).</p></li>

   <li><p><a href="#concept-canvas-set-bitmap-dimensions" title="concept-canvas-set-bitmap-dimensions">Set bitmap dimensions</a> to the
   numeric values of <var title="">target</var>'s <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> and
   <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> content attributes.</p></li>

   <li><p>Return the new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object.</p></li>

  </ol><hr><p>The <dfn id="dom-context-2d" title="dom-context-2d"><code>CanvasRenderingContext2D()</code></dfn> constructor, when
  invoked, must run the following steps:</p>

  <ol><li><p>Create a new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object.</p></li>

   <li><p>Initialize its <code title="dom-context-2d-canvas"><a href="#dom-context-2d-canvas">canvas</a></code> attribute to
   null.</p></li>

   <li><p>Let the new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#scratch-bitmap">scratch bitmap</a> be
   a new bitmap.</p></li>

   <li><p>If the constructor was called with arguments, let <var title="">width</var> and <var title="">height</var> be the first and second arguments, respectively. Otherwise, let <var title="">width</var> and <var title="">height</var> be 300 and 150, respectively.</p></li>

   <li><p><a href="#concept-canvas-set-bitmap-dimensions" title="concept-canvas-set-bitmap-dimensions">Set bitmap dimensions</a> to <var title="">width</var> and <var title="">height</var>.</p></li>

   <li><p>Let the new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object have no <a href="#output-bitmap">output
   bitmap</a>.</p></li>

<!--
   <li><p><span>Start autocommitting the scratch bitmap</span> for the new
   <code>CanvasRenderingContext2D</code> object.</p></li>
-->

   <li><p>Return the new <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object.</p></li>

  </ol><hr><p>When the user agent is required to <dfn id="commit-the-scratch-bitmap">commit the scratch bitmap</dfn> for a rendering
  context, it must run the following steps:

  </p><ol><li><p>Let <var title="">bitmap copy</var> be a copy of the rendering context's <a href="#scratch-bitmap">scratch
   bitmap</a>.</p></li>

<!--ADD-TOPIC:Security-->
   <li><p>Let <var title="">origin-clean flag copy</var> be a copy of the rendering context's
   <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a>
   flag.</p></li>
<!--REMOVE-TOPIC:Security-->

   <li><p>Let <var title="">hit region list copy</var> be a copy of the rendering context's
   <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#hit-region-list">hit region list</a>.</p></li>

   <li><p>Let <var title="">list of pending interface actions copy</var> be a copy of the rendering
   context's <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#list-of-pending-interface-actions">list of pending interface actions</a>.</p></li>

   <li><p>Empty the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#list-of-pending-interface-actions">list of pending interface actions</a>.</p></li>

   <li><p>If the rendering context has no <a href="#output-bitmap">output bitmap</a>, abort these steps.</p></li>

   <li><p>Let <var title="">output bitmap</var> be the rendering context's <a href="#output-bitmap">output
   bitmap</a>.</p></li>

   <li><p>Let <var title="">canvas</var> be the <code><a href="#the-canvas-element">canvas</a></code> element to which the rendering
   context was most recently <a href="#concept-canvas-binding-steps" title="concept-canvas-binding-steps">bound</a>.</p></li>

   <li>

    <p><a href="webappapis.html#queue-a-task">Queue a task</a> associated with <var title="">canvas</var>' <code><a href="dom.html#document">Document</a></code>
    to perform the following substeps:</p>

    <ol><li><p>Overwrite <var title="">output bitmap</var> with <var title="">bitmap
     copy</var>.</p></li>

<!--ADD-TOPIC:Security-->
     <li><p>Overwrite <var title="">output bitmap</var>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag with <var title="">origin-clean
     flag copy</var>.</p></li>
<!--REMOVE-TOPIC:Security-->

     <li><p>Overwrite <var title="">output bitmap</var>'s <a href="#hit-region-list">hit region list</a> with <var title="">hit region list copy</var>.</p></li>

     <li><p>Follow the directions in the <var title="">list of pending interface actions
     copy</var>.</p></li>

    </ol></li>

  </ol><p>The algorithm above must use the <dfn id="canvas-updating-task-source">canvas updating task source</dfn> (which is just used by
  this algorithm).</p>

<!--(right now we're requiring commit())
  <p>When a user agent is to <dfn>start autocommitting the scratch bitmap</dfn> for a rendering
  context, it must asynchronously start running the following algorithm. This algorithm interacts
  closely with the <span>event loop</span> mechanism; in particular, it has a <span>synchronous
  section</span> (which is triggered as part of the <span>event loop</span> algorithm). The steps in
  that section are marked with &#x231B;.</p>

  <ol>

   <li><p><i>Top</i>: <span>Await a stable state</span>. The <span>synchronous section</span>
   consists of the following steps. (The steps in the <span>synchronous section</span> are marked
   with &#x231B;.)</p></li>

   <li><p>&#x231B; <span>Commit the scratch bitmap</span> for the rendering context.</p></li>

   <li><p>End the <span>synchronous section</span>, continuing the remaining steps
   asynchronously.</p></li>

   <li><p>Return to the step labeled <i>top</i>.</p></li>

  </ol>
-->

  <p>The <dfn id="dom-context-2d-commit" title="dom-context-2d-commit"><code>commit()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the rendering context's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap
   mode</a> is <a href="#concept-canvas-bound" title="concept-canvas-bound">fixed</a>, throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</p></li>

   <li><p><a href="#commit-the-scratch-bitmap">Commit the scratch bitmap</a> for the rendering context.</p></li>

  </ol><p class="note">The <a href="#scratch-bitmap">scratch bitmap</a> is only <a href="#commit-the-scratch-bitmap" title="commit the scratch
  bitmap">committed</a> when the <code title="dom-context-2d-commit"><a href="#dom-context-2d-commit">commit()</a></code> method is
  called. (This doesn't matter for <code><a href="#the-canvas-element">canvas</a></code> elements in <a href="#concept-canvas-direct-2d" title="concept-canvas-direct-2d">direct-2d</a> mode, since there the <a href="#scratch-bitmap">scratch
  bitmap</a> is also the <code><a href="#the-canvas-element">canvas</a></code> element's bitmap so every drawing operation is
  immediately drawn.)</p>

  <hr><p>When the user agent is to <dfn id="concept-canvas-set-bitmap-dimensions" title="concept-canvas-set-bitmap-dimensions">set bitmap
  dimensions</dfn> to <var title="">width</var> and <var title="">height</var>, it must run the
  following steps:</p>

  <ol><li><p><a href="#reset-the-rendering-context-to-its-default-state">Reset the rendering context to its default state</a>.</p></li>

   <li><p>Clear the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#hit-region-list">hit region list</a> and its <a href="#list-of-pending-interface-actions">list of
   pending interface actions</a>.</p></li>

   <li><p>Resize the <a href="#scratch-bitmap">scratch bitmap</a> to the new <var title="">width</var> and <var title="">height</var> and clear it to fully transparent black.</p></li>

   <li><p>If the rendering context has an <a href="#output-bitmap">output bitmap</a>, and the <a href="#scratch-bitmap">scratch
   bitmap</a> is a different bitmap than the <a href="#output-bitmap">output bitmap</a>, then resize the
   <a href="#output-bitmap">output bitmap</a> to the new <var title="">width</var> and <var title="">height</var>
   and clear it to fully transparent black.</p></li>

   <li>

    <p>If the rendering context's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap
    mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, then run these substeps:</p>

    <ol><li><p>Let <var title="">canvas</var> be the <code><a href="#the-canvas-element">canvas</a></code> element to which the rendering
     context's <code title="dom-context-2d-canvas"><a href="#dom-context-2d-canvas">canvas</a></code> attribute was initialized.</p></li>

     <li><p>If the rendering context's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
     bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a> and the numeric value of
     the <var title="">canvas</var>' <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> content attribute
     differs from <var title="">width</var>, then set <var title="">canvas</var>' <code title="attr-canvas-width"><a href="#attr-canvas-width">width</a></code> content attribute to the shortest possible string
     representing <var title="">width</var> as a <a href="common-microsyntaxes.html#valid-non-negative-integer">valid non-negative integer</a>.</p></li>

     <li><p>If the rendering context's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context
     bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a> and the numeric value of
     the <var title="">canvas</var>' <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> content attribute
     differs from <var title="">height</var>, then set <var title="">canvas</var>' <code title="attr-canvas-height"><a href="#attr-canvas-height">height</a></code> content attribute to the shortest possible string
     representing <var title="">height</var> as a <a href="common-microsyntaxes.html#valid-non-negative-integer">valid non-negative integer</a>.</p></li>

    </ol></li>

  </ol><div class="example">
   <p>Only one square appears to be drawn in the following example:</p>
   <pre>// canvas is a reference to a &lt;canvas&gt; element
var context = canvas.getContext('2d');
context.fillRect(0,0,50,50);
canvas.setAttribute('width', '300'); // clears the canvas
context.fillRect(0,100,50,50);
canvas.width = canvas.width; // clears the canvas
context.fillRect(100,0,50,50); // only this square remains</pre>
  </div>

  <hr><p>When the user agent is to run the <dfn id="concept-canvas-unbinding-steps" title="concept-canvas-unbinding-steps">unbinding
  steps</dfn> for a rendering context, it must run the following steps:</p>

  <ol><li><p><a href="#reset-the-rendering-context-to-its-default-state">Reset the rendering context to its default state</a>.</p></li>

   <li><p>Clear the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#hit-region-list">hit region list</a> and its <a href="#list-of-pending-interface-actions">list of
   pending interface actions</a>.</p></li>

   <li><p>Clear the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#scratch-bitmap">scratch bitmap</a> to a
   transparent black.</p></li>

<!--ADD-TOPIC:Security-->
   <li><p>Set the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag to true.</p></li>
<!--REMOVE-TOPIC:Security-->

   <li><p>Let the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object have no <a href="#output-bitmap">output
   bitmap</a>.</p></li>

  </ol><p>When the user agent is to run the <dfn id="concept-canvas-binding-steps" title="concept-canvas-binding-steps">binding steps</dfn>
  to bind the rendering context to the <code><a href="#the-canvas-element">canvas</a></code> element <var title="">target</var>, it
  must run the following steps:</p>

  <ol><li><p><a href="#reset-the-rendering-context-to-its-default-state">Reset the rendering context to its default state</a>.</p></li>

   <li><p>Clear the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#hit-region-list">hit region list</a> and its <a href="#list-of-pending-interface-actions">list of
   pending interface actions</a>.</p></li>

   <li><p>Resize the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#scratch-bitmap">scratch bitmap</a> to
   the dimensions of <var title="">target</var>'s bitmap and clear it to fully transparent
   black.</p></li>

<!--ADD-TOPIC:Security-->
   <li><p>Set the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag to true.</p></li>
<!--REMOVE-TOPIC:Security-->

   <li><p>Let the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#output-bitmap">output bitmap</a> be <var title="">target</var>'s bitmap.</p></li>

  </ol><hr><p>The <dfn id="dom-context-2d-canvas" title="dom-context-2d-canvas"><code>canvas</code></dfn> attribute must return the
  value it was initialized to when the object was created.</p>

  <p>The <dfn id="dom-context-2d-width" title="dom-context-2d-width"><code>width</code></dfn> attribute, on getting, must
  return the width of the rendering context's <a href="#scratch-bitmap">scratch bitmap</a>, in CSS pixels. On
  setting, it must <a href="#concept-canvas-set-bitmap-dimensions" title="concept-canvas-set-bitmap-dimensions">set bitmap dimensions</a>
  to the new value and the current height of the rendering context's <a href="#scratch-bitmap">scratch bitmap</a> in
  CSS pixels, respectively.</p>

  <p>The <dfn id="dom-context-2d-height" title="dom-context-2d-height"><code>height</code></dfn> attribute, on getting, must
  return the height of the rendering context's <a href="#scratch-bitmap">scratch bitmap</a>, in CSS pixels. On
  setting, it must <a href="#concept-canvas-set-bitmap-dimensions" title="concept-canvas-set-bitmap-dimensions">set bitmap dimensions</a>
  to the current width of the rendering context's <a href="#scratch-bitmap">scratch bitmap</a> in CSS pixels and the
  new value, respectively.</p>

  <hr><p>Except where otherwise specified, for the 2D context interface, <strong>any method call with a
  numeric argument whose value is infinite or a NaN value must be ignored</strong>.</p>

  <!--
   Philip Taylor wrote:
   > My experience with some 3d canvas code is that infinities come up in
   > naturally harmless places, e.g. having a function that scales by x then
   > translates by 1/x and wanting it to work when x=0 (which ought to draw
   > nothing, since anything it draws is zero pixels wide), and it's a bit
   > annoying to track down and fix those issues, so I'd probably like it if
   > they were harmless in canvas methods. Opera appears to silently not draw
   > anything if the transformation matrix is not finite, but Firefox throws
   > exceptions when passing in non-finite arguments.
  -->

  <p>Whenever the CSS value <code title="">currentColor</code> is used as a color in the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> API, the "computed value of the 'color' property" for the
  purposes of determining the computed value of the <code title="">currentColor</code> keyword is
  the value described by the appropriate entry in the following list:</p>

  <dl><dt>If the rendering context's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap
   mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a> and the <code><a href="#the-canvas-element">canvas</a></code>
   element is <a href="rendering.html#being-rendered">being rendered</a></dt>

   <dd><p>The "computed value of the 'color' property" for the purposes of determining the computed
   value of the <code title="">currentColor</code> keyword is the computed value of the 'color'
   property on the <code><a href="#the-canvas-element">canvas</a></code> element at the time that the color is specified (e.g. when
   the appropriate attribute is set, or when the method is called; not when the color is rendered or
   otherwise used). <a href="references.html#refsCSSCOLOR">[CSSCOLOR]</a></p></dd>

   <dt>In all other cases</dt>

   <dd><p>The "computed value of the 'color' property" for the purposes of determining the computed
   value of the <code title="">currentColor</code> keyword is fully opaque black. <a href="references.html#refsCSSCOLOR">[CSSCOLOR]</a></p></dd>

  </dl><p>In the case of <code title="dom-canvasgradient-addColorStop"><a href="#dom-canvasgradient-addcolorstop">addColorStop()</a></code> on
  <code><a href="#canvasgradient">CanvasGradient</a></code>, the "computed value of the 'color' property" for the purposes of
  determining the computed value of the <code title="">currentColor</code> keyword is always fully
  opaque black (there is no associated element). <a href="references.html#refsCSSCOLOR">[CSSCOLOR]</a></p>

  <p class="note">This is because <code><a href="#canvasgradient">CanvasGradient</a></code> objects are
  <code><a href="#the-canvas-element">canvas</a></code>-neutral — a <code><a href="#canvasgradient">CanvasGradient</a></code> object created by one
  <code><a href="#the-canvas-element">canvas</a></code> can be used by another, and there is therefore no way to know which is the
  "element in question" at the time that the color is specified.</p>

  <p class="note">Similar concerns exist with font-related properties; the rules for those are
  described in detail in the relevant section below.</p>

  </div>

  <hr><p>The <code><a href="#canvasfillrule">CanvasFillRule</a></code> enumeration is used to select the <dfn id="fill-rule">fill rule</dfn>
  algorithm by which to determine if a point is inside or outside a path.</p>

  <p>The value "<dfn id="dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero"><code>nonzero</code></dfn>" value
  indicates the non-zero winding rule, wherein

     a point is considered to be outside a shape if the number of times a half-infinite straight
     line drawn from that point crosses the shape's path going in one direction is equal to the
     number of times it crosses the path going in the other direction.

  </p>


  <p>The "<dfn id="dom-context-2d-fillrule-evenodd" title="dom-context-2d-fillRule-evenodd"><code>evenodd</code></dfn>" value indicates
  the even-odd rule, wherein

     a point is considered to be outside a shape if the number of times a half-infinite straight
     line drawn from that point crosses the shape's path is even.

  </p>

  <p>If a point is not outside a shape, it is inside the shape.</p>


  <h6 id="implementation-notes"><span class="secno">4.12.4.2.1 </span>Implementation notes</h6>

  <p><i>This section is non-normative.</i></p>

  <p>Although the way the specification is written it might sound like an implementation needs to
  track up to four bitmaps per canvas or rendering context — one <a href="#scratch-bitmap">scratch bitmap</a>,
  one <a href="#output-bitmap">output bitmap</a> for the rendering context, one bitmap for the <code><a href="#the-canvas-element">canvas</a></code>,
  and one bitmap for the actually currently rendered image — user agents can in fact generally
  optimise this to only one or two.</p>

  <p>The <a href="#scratch-bitmap">scratch bitmap</a>, when it isn't the same bitmap as the <a href="#output-bitmap">output
  bitmap</a>, is only directly observable if it is read, and therefore implementations can,
  instead of updating this bitmap, merely remember the sequence of drawing operations that have been
  applied to it until such time as the bitmap's actual data is needed (for example because of a call
  to <code title="dom-context-2d-commit"><a href="#dom-context-2d-commit">commit()</a></code>, <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage()</a></code>, or the <code title="dom-createImageBitmap"><a href="timers.html#dom-createimagebitmap">createImageBitmap()</a></code>
  factory method). In many cases, this will be more memory efficient.</p>

  <p>The bitmap of a <code><a href="#the-canvas-element">canvas</a></code> element is the one bitmap that's pretty much always going
  to be needed in practice. The <a href="#output-bitmap">output bitmap</a> of a rendering context, when it has one,
  is always just an alias to a <code><a href="#the-canvas-element">canvas</a></code> element's bitmap.</p>

  <p>Additional bitmaps are sometimes needed, e.g. to enable fast drawing when the canvas is being
  painted at a different size than its intrinsic size, or to enable double buffering so that the
  rendering commands from the <a href="#scratch-bitmap">scratch bitmap</a> can be applied without the rendering being
  updated midway.</p>




  <h6 id="the-canvas-state"><span class="secno">4.12.4.2.2 </span>The canvas state</h6>

  <p>Each <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> rendering context maintains a stack of drawing
  states. <dfn id="drawing-state" title="drawing state">Drawing states</dfn> consist of:</p>

  <ul class="brief"><li>The current <a href="#transformations" title="dom-context-2d-transformation">transformation matrix</a>.</li>
   <li>The current <a href="#clipping-region">clipping region</a>.</li>
   <li>The current values of the following attributes: <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code>, <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code>, <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code>, <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code>, <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code>, <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code>, <code title="dom-context-2d-miterLimit"><a href="#dom-context-2d-miterlimit">miterLimit</a></code>, <code title="dom-context-2d-lineDashOffset"><a href="#dom-context-2d-linedashoffset">lineDashOffset</a></code>, <code title="dom-context-2d-shadowOffsetX"><a href="#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code>, <code title="dom-context-2d-shadowOffsetY"><a href="#dom-context-2d-shadowoffsety">shadowOffsetY</a></code>, <code title="dom-context-2d-shadowBlur"><a href="#dom-context-2d-shadowblur">shadowBlur</a></code>, <code title="dom-context-2d-shadowColor"><a href="#dom-context-2d-shadowcolor">shadowColor</a></code>, <code title="dom-context-2d-globalCompositeOperation"><a href="#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>, <code title="dom-context-2d-font"><a href="#dom-context-2d-font">font</a></code>, <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code>, <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code>, <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code>, <code title="dom-context-2d-imageSmoothingEnabled"><a href="#dom-context-2d-imagesmoothingenabled">imageSmoothingEnabled</a></code>.</li>
   <li>The current <a href="#dash-list">dash list</a>.</li>
  </ul><p class="note">The <a href="#current-default-path">current default path</a> and the rendering context's bitmaps are not
  part of the drawing state. The <a href="#current-default-path">current default path</a> is persistent, and can only be
  reset using the <code title="dom-context-2d-beginPath"><a href="#dom-context-2d-beginpath">beginPath()</a></code> method. The bitmaps
  depend on whether and how the rendering context is bound to a <code><a href="#the-canvas-element">canvas</a></code> element.</p>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-save"><a href="#dom-context-2d-save">save</a></code>()</dt>

   <dd>

    <p>Pushes the current state onto the stack.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-restore"><a href="#dom-context-2d-restore">restore</a></code>()</dt>

   <dd>

    <p>Pops the top state on the stack, restoring the context to that state.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-context-2d-save" title="dom-context-2d-save"><code>save()</code></dfn> method must push a copy of the
  current drawing state onto the drawing state stack.</p>

  <p>The <dfn id="dom-context-2d-restore" title="dom-context-2d-restore"><code>restore()</code></dfn> method must pop the top
  entry in the drawing state stack, and reset the drawing state it describes. If there is no saved
  state, the method must do nothing.</p>

  <p>When the user agent is to <dfn id="reset-the-rendering-context-to-its-default-state">reset the rendering context to its default state</dfn>, it must
  clear the drawing state stack and everything that <a href="#drawing-state">drawing state</a> consists of to
  initial values.</p>

  <!-- v7
idea from Mihai:
> 5. Drawing states should be saveable with IDs, and for easier restoring.
>
> save(id)
> restore(id)
>
> If id is not provided, then save() works as defined now. The same for
> restore().
>
> Currently, it's not trivial to save and restore a specific state.
...and from Philip:
> I think a more convenient syntax would be:
>   var state = ctx.save();
>   ctx.restore(state);
> But how would it interact with normal calls to ctx.restore()?
  -->

  </div>


<!--CLEANUP--><!-- anything involving Path2D -->

  <h6 id="drawingstyle-objects"><span class="secno">4.12.4.2.3 </span><code><a href="#drawingstyle">DrawingStyle</a></code> objects</h6>

  <p>All the line styles (line width, caps, joins, and dash patterns) and text styles (fonts)
  described in the next two sections apply to <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> objects and to
  <code><a href="#drawingstyle">DrawingStyle</a></code> objects. This section defines the constructor used to obtain a
  <code><a href="#drawingstyle">DrawingStyle</a></code> object. This object is then used by methods on <code><a href="#path2d">Path2D</a></code> objects
  to control how text and paths are rasterised and stroked.</p>

  <dl class="domintro"><dt><var title="">styles</var> = new <code title="dom-DrawingStyle"><a href="#dom-drawingstyle">DrawingStyle</a></code>( [ <var title="">element</var> ] )</dt>

   <dd>

    <p>Creates a new <code><a href="#drawingstyle">DrawingStyle</a></code> object, optionally using a specific element for
    resolving relative keywords and sizes in font specifications.</p>

   </dd>

  </dl><div class="impl">

  <p>Each <code><a href="#drawingstyle">DrawingStyle</a></code> object can have a <dfn id="styles-scope-object">styles scope object</dfn>.</p>

  <p>The <dfn id="dom-drawingstyle" title="dom-DrawingStyle"><code>DrawingStyle()</code></dfn> constructor, when invoked,
  must return a newly created <code><a href="#drawingstyle">DrawingStyle</a></code> object. If the constructor was passed an
  argument, then the <code><a href="#drawingstyle">DrawingStyle</a></code> object's <a href="#styles-scope-object">styles scope object</a> is that
  element. Otherwise, if the <a href="infrastructure.html#javascript-global-environment">JavaScript global environment</a> is a <a href="webappapis.html#document-environment">document
  environment</a>, the object's <a href="#styles-scope-object">styles scope object</a> is the <code><a href="dom.html#document">Document</a></code>
  object of the <a href="browsers.html#active-document">active document</a> of the <a href="browsers.html#browsing-context">browsing context</a> of the
  <code><a href="browsers.html#window">Window</a></code> object on which the interface object of the invoked constructor is found.
  Otherwise, the <a href="infrastructure.html#javascript-global-environment">JavaScript global environment</a> is a <a href="webappapis.html#worker-environment">worker environment</a>,
  and the <a href="#styles-scope-object">styles scope object</a> is the worker.</p>

  </div>


  <h6 id="line-styles"><span class="secno">4.12.4.2.4 </span>Line styles</h6>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current line width.</p>

    <p>Can be set, to change the line width. Values that are not finite values greater than zero are
    ignored.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current line cap style.</p>

    <p>Can be set, to change the line cap style.</p>

    <p>The possible line cap styles are <code>butt</code>, <code>round</code>, and
    <code>square</code>. Other values are ignored.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current line join style.</p>

    <p>Can be set, to change the line join style.</p>

    <p>The possible line join styles are <code>bevel</code>, <code>round</code>, and
    <code>miter</code>. Other values are ignored.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-miterLimit"><a href="#dom-context-2d-miterlimit">miterLimit</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-miterLimit"><a href="#dom-context-2d-miterlimit">miterLimit</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current miter limit ratio.</p>

    <p>Can be set, to change the miter limit ratio. Values that are not finite values greater than
    zero are ignored.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-setLineDash"><a href="#dom-context-2d-setlinedash">setLineDash</a></code>(<var title="">segments</var>)</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-setLineDash"><a href="#dom-context-2d-setlinedash">setLineDash</a></code>(<var title="">segments</var>)</dt>

   <dd>

    <p>Sets the current line dash pattern (as used when stroking). The argument is a list of
    distances for which to alternately have the line on and the line off.</p>

   </dd>


   <dt><var title="">segments</var> = <var title="">context</var> . <code title="dom-context-2d-getLineDash"><a href="#dom-context-2d-getlinedash">getLineDash</a></code>()</dt>
   <dt><var title="">segments</var> = <var title="">styles</var> . <code title="dom-context-2d-getLineDash"><a href="#dom-context-2d-getlinedash">getLineDash</a></code>()</dt>

   <dd>

    <p>Returns a copy of the current line dash pattern. The array returned will always have an even
    number of entries (i.e. the pattern is normalized).</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-lineDashOffset"><a href="#dom-context-2d-linedashoffset">lineDashOffset</a></code></dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-lineDashOffset"><a href="#dom-context-2d-linedashoffset">lineDashOffset</a></code></dt>

   <dd>

    <p>Returns the phase offset (in the same units as the line dash pattern).</p>

    <p>Can be set, to change the phase offset. Values that are not finite values are ignored.</p>

   </dd>

  </dl><div class="impl">

  <p>Objects that implement the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface have attributes and
  methods (defined in this section) that control how lines are treated by the object.</p>

  <p>The <dfn id="dom-context-2d-linewidth" title="dom-context-2d-lineWidth"><code>lineWidth</code></dfn> attribute gives the
  width of lines, in coordinate space units. On getting, it must return the current value. On
  setting, zero, negative, infinite, and NaN values must be ignored, leaving the value unchanged;
  other values must change the current value to the new value.</p>

  <p>When the object implementing the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the
  <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> attribute must initially have the value
  <code>1.0</code>.</p>

  <hr><p>The <dfn id="dom-context-2d-linecap" title="dom-context-2d-lineCap"><code>lineCap</code></dfn> attribute defines the type
  of endings that UAs will place on the end of lines. The three valid values are <code>butt</code>,
  <code>round</code>, and <code>square</code>.</p>

  <p>On getting, it must return the current value. On setting, if the new value is one of the
  literal strings <code>butt</code>, <code>round</code>, and <code>square</code>, then the current
  value must be changed to the new value; other values must ignored, leaving the value
  unchanged.</p>

  <p>When the object implementing the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the
  <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code> attribute must initially have the value
  <code>butt</code>.</p>

  <hr><p>The <dfn id="dom-context-2d-linejoin" title="dom-context-2d-lineJoin"><code>lineJoin</code></dfn> attribute defines the type
  of corners that UAs will place where two lines meet. The three valid values are
  <code>bevel</code>, <code>round</code>, and <code>miter</code>.</p>

  <p>On getting, it must return the current value. On setting, if the new value is one of the
  literal strings <code>bevel</code>, <code>round</code>, and <code>miter</code>, then the current
  value must be changed to the new value; other values must be ignored, leaving the value
  unchanged.</p>

  <p>When the object implementing the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the
  <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> attribute must initially have the value
  <code>miter</code>.</p>

  <hr><p>When the <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> attribute has the value
  <code>miter</code>, strokes use the miter limit ratio to decide how to render joins. The miter
  limit ratio can be explicitly set using the <dfn id="dom-context-2d-miterlimit" title="dom-context-2d-miterLimit"><code>miterLimit</code></dfn> attribute. On getting, it must
  return the current value. On setting, zero, negative, infinite, and NaN values must be ignored,
  leaving the value unchanged; other values must change the current value to the new value.</p>
  <!-- values less than 1.0 are equivalent to 1.0, since it's compared
       against a ratio that can't be less than 1.0 -->

  <p>When the object implementing the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the
  <code title="dom-context-2d-miterLimit"><a href="#dom-context-2d-miterlimit">miterLimit</a></code> attribute must initially have the value
  <code>10.0</code>.</p>

  <hr><p>Each <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object has a <dfn id="dash-list">dash list</dfn>, which is either empty
  or consists of an even number of non-negative numbers. Initially, the <a href="#dash-list">dash list</a> must
  be empty.</p>

  <p>When the <dfn id="dom-context-2d-setlinedash" title="dom-context-2d-setLineDash"><code>setLineDash()</code></dfn> method is
  invoked, it must run the following steps:</p>

  <ol><li><p>Let <var title="">a</var> be the argument.</p></li>

   <li><p>If any value in <var title="">a</var> is not finite (e.g. an Infinity or a NaN value), or
   if any value is negative (less than zero), then abort these steps (without throwing an exception;
   user agents could show a message on a developer console, though, as that would be helpful for
   debugging).</p></li>

   <li><p>If the number of elements in <var title="">a</var> is odd, then let <var title="">a</var>
   be the concatentation of two copies of <var title="">a</var>.</p></li>

   <li><p>Let the object's <a href="#dash-list">dash list</a> be <var title="">a</var>.</p></li>

  </ol><p>When the <dfn id="dom-context-2d-getlinedash" title="dom-context-2d-getLineDash"><code>getLineDash()</code></dfn> method is
  invoked, it must return a sequence whose values are the values of the object's <a href="#dash-list">dash
  list</a>, in the same order.</p>

  <p>It is sometimes useful to change the "phase" of the dash pattern, e.g. to achieve a "marching
  ants" effect. The phase can be set using the <dfn id="dom-context-2d-linedashoffset" title="dom-context-2d-lineDashOffset"><code>lineDashOffset</code></dfn> attribute. On getting, it
  must return the current value. On setting, infinite and NaN values must be ignored, leaving the
  value unchanged; other values must change the current value to the new value.</p>

  <p>When the object implementing the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the
  <code title="dom-context-2d-lineDashOffset"><a href="#dom-context-2d-linedashoffset">lineDashOffset</a></code> attribute must initially have
  the value <code>0.0</code>.</p>

  <hr><p>When a user agent is to <dfn id="trace-a-path">trace a <span title="concept-path">path</span></dfn>, <!-- <dfn>trace a path</dfn> -->
  given an object <var title="">style</var> that implements the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code>
  interface, it must run the following algorithm. This algorithm returns a new <a href="#concept-path" title="concept-path">path</a>.</p>

  <ol><li><p>Let <var title="">path</var> be a copy of the path being traced.</p></li>

   <!-- PATH SANITIZATION -->

   <li><p>Prune all zero-length <a href="#line-segments">line segments</a> from <var title="">path</var>.</p></li>

   <li><p>Remove from <var title="">path</var> any subpaths containing no lines (i.e. subpaths with
   just one point).</p></li>

   <li><p>Replace each point in each subpath of <var title="">path</var> other than the first point
   and the last point of each subpath by a <i>join</i> that joins the line leading to that point to
   the line leading out of that point, such that the subpaths all consist of two points (a starting
   point with a line leading out of it, and an ending point with a line leading into it), one or
   more lines (connecting the points and the joins), and zero or more joins (each connecting one
   line to another), connected together such that each subpath is a series of one or more lines with
   a join between each one and a point on each end.</p></li>

   <li><p>Add a straight closing line to each closed subpath in <var title="">path</var> connecting
   the last point and the first point of that subpath; change the last point to a join (from the
   previously last line to the newly added closing line), and change the first point to a join (from
   the newly added closing line to the first line).</p>

   </li><li><p>If the <var title="">styles</var> <a href="#dash-list">dash list</a> is empty, jump to the step
   labeled <i>convert</i>.</p></li>

   <!-- DASHING -->

   <li><p>Let <var title="">pattern width</var> be the concatenation of all the entries of the <var title="">styles</var> <a href="#dash-list">dash list</a>, in coordinate space units.</p>

   </li><li><p>For each subpath <var title="">subpath</var> in <var title="">path</var>, run the
   following substeps. These substeps mutate the subpaths in <var title="">path</var> <i>in
   vivo</i>.</p>

    <ol><li><p>Let <var title="">subpath width</var> be the length of all the lines of <var title="">subpath</var>, in coordinate space units.</p>

     </li><li><p>Let <var title="">offset</var> be the value of the <var title="">styles</var> <code title="dom-context-2d-lineDashOffset"><a href="#dom-context-2d-linedashoffset">lineDashOffset</a></code>, in coordinate space
     units.</p></li>

     <li>

      <p>While <var title="">offset</var> is greater than <var title="">pattern width</var>,
      decrement it by <var title="">pattern width</var>.</p>

      <p>While <var title="">offset</var> is less than zero, increment it by <var title="">pattern
      width</var>.</p>

     </li>

     <li><p>Define <var title="">L</var> to be a linear coordinate line defined along all lines in
     <var title="">subpath</var>, such that the start of the first line in the subpath is defined
     as coordinate 0, and the end of the last line in the subpath is defined as coordinate <var title="">subpath width</var>.</p></li>

     <li><p>Let <var title="">position</var> be zero minus <var title="">offset</var>.</p></li>

     <li><p>Let <var title="">index</var> be 0.</p></li>

     <li><p>Let <var title="">current state</var> be <i>off</i> (the other states being <i>on</i>
     and <i>zero-on</i>).</p></li>

     <li><p><i>Dash on</i>: Let <var title="">segment length</var> be
     the value of the <var title="">styles</var> <a href="#dash-list">dash
     list</a>'s <var title="">index</var>th entry.</p></li>

     <li><p>Increment <var title="">position</var> by <var title="">segment length</var>.</p></li>

     <li><p>If <var title="">position</var> is greater than <var title="">subpath width</var>, then
     end these substeps for this subpath and start them again for the next subpath; if there are no
     more subpaths, then jump to the step labeled <i>convert</i> instead.</p></li>

     <li><p>If <var title="">segment length</var> is non-zero, let <var title="">current state</var> be <i>on</i>.</p></li>

     <li><p>Increment <var title="">index</var> by one.</p></li>

     <li><p><i>Dash off<!-- labeled for consistency only --></i>: Let <var title="">segment
     length</var> be the value of the <var title="">styles</var> <a href="#dash-list">dash list</a>'s <var title="">index</var>th entry.</p></li>

     <li><p>Let <var title="">start</var> be the offset <var title="">position</var> on <var title="">L</var>.</p></li>

     <li><p>Increment <var title="">position</var> by <var title="">segment length</var>.</p></li>

     <li><p>If <var title="">position</var> is less than zero, then jump to the step labeled
     <i>post-cut</i>.</p></li> <!-- start and end both before zero -->

     <li><p>If <var title="">start</var> is less than zero, then let <var title="">start</var> be
     zero.</p></li> <!-- end will be (at or) after zero -->

     <li><p>If <var title="">position</var> is greater than <var title="">subpath width</var>, then
     let <var title="">end</var> be the offset <var title="">subpath width</var> on <var title="">L</var>. Otherwise, let <var title="">end</var> be the offset <var title="">position</var> on <var title="">L</var>.</p></li>

     <li>

      <p>Jump to the first appropriate step:</p>

      <dl class="switch"><dt>If <var title="">segment length</var> is zero and <var title="">current state</var> is <i>off</i></dt>

       <dd>

        <p>Do nothing, just continue to the next step.</p>

       </dd>


       <dt>If <var title="">current state</var> is <i>off</i></dt>

       <dd>

        <p>Cut the line on which <var title="">end</var> finds itself short at <var title="">end</var> and place a point there, cutting the subpath that it was in in two;
        remove all line segments, joins, points, and subpaths that are between <var title="">start</var> and <var title="">end</var>; and finally place a single point at <var title="">start</var> with no lines connecting to it.</p>

        <p>The point has a <i>directionality</i> for the purposes of drawing line caps (see below).
        The directionality is the direction that the original line had at that point (i.e. when <var title="">L</var> was defined above).</p>

       </dd>


       <dt>Otherwise</dt>

       <dd>

        <p>Cut the line on which <var title="">start</var> finds itself into two at <var title="">start</var> and place a point there, cutting the subpath that it was in in two, and
        similarly cut the line on which <var title="">end</var> finds itself short at <var title="">end</var> and place a point there, cutting the subpath that <em>it</em> was in in
        two, and then remove all line segments, joins, points, and subpaths that are between <var title="">start</var> and <var title="">end</var>.</p>

        <p>If <var title="">start</var> and <var title="">end</var> are the same point, then this
        results in just the line being cut in two and two points being inserted there, with nothing
        being removed, unless a join also happens to be at that point, in which case the join must
        be removed.</p>

       </dd>

      </dl></li>

     <li><p><i>Post-cut</i>: If <var title="">position</var> is greater than <var title="">subpath width</var>, then jump to the step labeled <i>convert</i>.</p></li>

     <li><p>If <var title="">segment length</var> is greater than zero, let <var title="">positioned-at-on-dash</var> be false.</p></li>

     <li><p>Increment <var title="">index</var> by one. If it is equal to the number of entries in
     the <var title="">styles</var> <a href="#dash-list">dash list</a>, then let <var title="">index</var> be
     0.</p></li>

     <li><p>Return to the step labeled <i>dash on</i>.</p></li>

    </ol></li>

   <!-- STROKING -->

   <li>

    <p><i>Convert</i>: This is the step that converts the path to a new path that represents its
    stroke.</p>

<!--CLEANUP-->
    <p>Create a new <a href="#concept-path" title="concept-path">path</a> that describes the edge of the areas that
    would be covered if a straight line of length equal to the <var title="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> was swept along each subpath in <var title="">path</var> while being kept at an angle such that the line is orthogonal to the path
    being swept, replacing each point with the end cap necessary to satisfy the <var title="">styles</var> <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code> attribute as described
    previously and elaborated below, and replacing each join with the join necessary to satisfy the
    <var title="">styles</var> <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> type, as
    defined below.</p>

    <p><strong>Caps</strong>: Each point has a flat edge perpendicular to the direction of the line
    coming out of it. This is them augmented according to the value of the <var title="">styles</var> <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code>. The <code>butt</code>
    value means that no additional line cap is added. The <code>round</code> value means that a
    semi-circle with the diameter equal to the <var title="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> width must additionally be placed on to the
    line coming out of each point. The <code>square</code> value means that a rectangle with the
    length of the <var title="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code>
    width and the width of half the <var title="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> width, placed flat against the edge
    perpendicular to the direction of the line coming out of the point, must be added at each
    point.</p>

    <p>Points with no lines coming out of them must have two caps placed back-to-back as if it was
    really two points connected to each other by an infinitesimally short straight line in the
    direction of the point's <i>directionality</i> (as defined above).</p>

    <p><strong>Joins</strong>: In addition to the point where a join occurs, two additional points
    are relevant to each join, one for each line: the two corners found half the line width away
    from the join point, one perpendicular to each line, each on the side furthest from the other
    line.</p>

<!--CLEANUP-->
    <p>A triangle connecting these two opposite corners with a straight line, with the third
    point of the triangle being the join point, must be added at all joins. The <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> attribute controls whether anything else is
    rendered. The three aforementioned values have the following meanings:</p>

    <p>The <code>bevel</code> value means that this is all that is rendered at joins.</p>

<!--CLEANUP-->
    <p>The <code>round</code> value means that an arc connecting the two aforementioned
    corners of the join, abutting (and not overlapping) the aforementioned triangle, with the
    diameter equal to the line width and the origin at the point of the join, must be added at
    joins.</p>

<!--CLEANUP-->
    <p>The <code>miter</code> value means that a second triangle must (if it can given the
    miter length) be added at the join, with one line being the line between the two aforementioned
    corners, abutting the first triangle, and the other two being continuations of the outside edges
    of the two joining lines, as long as required to intersect without going over the miter
    length.</p>

    <p>The miter length is the distance from the point where the join occurs to the intersection of
    the line edges on the outside of the join. The miter limit ratio is the maximum allowed ratio of
    the miter length to half the line width. If the miter length would cause the miter limit ratio
    (as set by the <var title="">style</var> <code title="dom-context-2d-miterLimit"><a href="#dom-context-2d-miterlimit">miterLimit</a></code> attribute) to be exceeded, this second
    triangle must not be added.</p> <!-- the actual ratio can't possibly be less than 1.0 -->

<!-- here's a nice demo of the miter:
  c.clearRect(0, 0, 640, 480);
  c.beginPath();

  c.moveTo((new Date()/100) % 600, 100);
  c.lineTo(300, 300);
  c.lineTo(500, 300);

  c.lineWidth = 50;
  c.miterLimit = 10000;
  c.strokeStyle = 'silver'
  c.stroke();

  c.miterLimit = 0.0001;
  c.strokeStyle = 'black'
  c.stroke();

  c.lineWidth = 1;
  c.strokeStyle = 'red'
  c.stroke();
-->


    <p>Subpaths in the newly created path must wind clockwise, regardless of the direction of paths
    in <var title="">path</var>.</p>

    <!-- ...because both of these examples result in two lines (assuming non-zero winding rules,
    things are different under even/odd), there's no "hole" where the lines overlap:

            c.beginPath();
            c.lineWidth=30;
            c.moveTo(200,200); // subpath 1
            c.lineTo(400,200);
            c.moveTo(400,210); // subpath 2
            c.lineTo(200,190);
            c.stroke();

            c.beginPath();
            c.lineWidth=30;
            c.moveTo(200,200); // subpath 1
            c.lineTo(400,200);
            c.lineTo(300,300);
            c.closePath();
            c.moveTo(400,210); // subpath 2
            c.lineTo(200,190);
            c.lineTo(300,300);
            c.closePath();
            c.stroke();

     ...and we want the same result when you create the two subpaths in each example above as two
     Paths, stroke them onto a third Path, and then fill that Path on the context.
    -->

   </li>

   <li><p>Return the newly created path.</p></li>

  </ol><!--v6: Another request has been for hairline width lines, that remain hairline width with
transform. ack Shaun Morris. --></div>


  <h6 id="text-styles"><span class="secno">4.12.4.2.5 </span>Text styles</h6>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-font"><a href="#dom-context-2d-font">font</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-font"><a href="#dom-context-2d-font">font</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current font settings.</p>

    <p>Can be set, to change the font. The syntax is the same as for the CSS 'font' property; values
    that cannot be parsed as CSS font values are ignored.</p>

    <p>Relative keywords and lengths are computed relative to the font of the <code><a href="#the-canvas-element">canvas</a></code>
    element.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current text alignment settings.</p>

    <p>Can be set, to change the alignment. The possible values are and their meanings are given
    below. Other values are ignored. The default is <code title="">start</code>.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current baseline alignment settings.</p>

    <p>Can be set, to change the baseline alignment. The possible values and their meanings are
    given below. Other values are ignored. The default is <code title="dom-concept-2d-textAlign-alphabetic">alphabetic</code>.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">styles</var> . <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current directionality.</p>

    <p>Can be set, to change the directionality. The possible values and their meanings are given
    below. Other values are ignored. The default is <code title="dom-concept-2d-textAlign-inherit">inherit</code>.</p>

   </dd>

  </dl><div class="impl">

  <p>Objects that implement the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface have attributes (defined
  in this section) that control how text is laid out (rasterized or outlined) by the object. Such
  objects can also have a <dfn id="font-style-source-object">font style source object</dfn>. For
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> objects whose <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, this is their <code><a href="#the-canvas-element">canvas</a></code> element; for other
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> objects, if the <a href="infrastructure.html#javascript-global-environment">JavaScript global environment</a>
  is a <a href="webappapis.html#document-environment">document environment</a>, the object's <a href="#font-style-source-object">font style source object</a> is the
  <code><a href="dom.html#document">Document</a></code> object of the <a href="browsers.html#active-document">active document</a> of the <a href="browsers.html#browsing-context">browsing
  context</a> of the <code><a href="browsers.html#window">Window</a></code> object on which the interface object of the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is found; otherwise the <a href="infrastructure.html#javascript-global-environment">JavaScript global
  environment</a> is a <a href="webappapis.html#worker-environment">worker environment</a> and the <a href="#font-style-source-object">font style source
  object</a> is the worker. For <code><a href="#drawingstyle">DrawingStyle</a></code> objects, it's the <a href="#styles-scope-object">styles scope
  object</a>.</p>

  <p>The <dfn id="dom-context-2d-font" title="dom-context-2d-font"><code>font</code></dfn> IDL attribute, on setting, must be
  parsed the same way as the 'font' property of CSS (but without supporting property-independent
  style sheet syntax like 'inherit'), and the resulting font must be assigned to the context, with
  the 'line-height' component forced to 'normal', with the 'font-size' component converted to CSS
  pixels, and with system fonts being computed to explicit values. If the new value is syntactically
  incorrect (including using property-independent style sheet syntax like 'inherit' or 'initial'),
  then it must be ignored, without assigning a new font value. <a href="references.html#refsCSS">[CSS]</a></p>

  <p>Font family names must be interpreted in the context of the <a href="#font-style-source-object">font style source
  object</a> when the font is to be used; any fonts embedded using <code title="">@font-face</code> or loaded using the <code><a href="infrastructure.html#fontloader">FontLoader</a></code> that are visible to the
  <a href="#font-style-source-object">font style source object</a> must therefore be available once they are loaded. If a font
  is used before it is fully loaded, or if the <a href="#font-style-source-object">font style source object</a> does not have
  that font in scope at the time the font is to be used, then it must be treated as if it was an
  unknown font, falling back to another as described by the relevant CSS specifications. <a href="references.html#refsCSSFONTS">[CSSFONTS]</a> <a href="references.html#refsCSSFONTLOAD">[CSSFONTLOAD]</a></p>

  <p>On getting, the <code title="dom-context-2d-font"><a href="#dom-context-2d-font">font</a></code> attribute must return the <a href="infrastructure.html#serializing-a-css-value" title="serializing a CSS value">serialized form</a> of the current font of the context (with no
  'line-height' component). <a href="references.html#refsCSSOM">[CSSOM]</a></p>

  <div class="example">

   <p>For example, after the following statement:</p>

   <pre>context.font = 'italic 400 12px/2 Unknown Font, sans-serif';</pre>

   <p>...the expression <code title="">context.font</code> would evaluate to the string "<code title="">italic 12px "Unknown Font", sans-serif</code>". The "400"
   font-weight doesn't appear because that is the default value. The line-height doesn't appear
   because it is forced to "normal", the default value.</p>

  </div>

  <p>When the object implementing the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the
  font of the context must be set to 10px sans-serif. When the 'font-size' component is set to
  lengths using percentages, 'em' or 'ex' units, or the 'larger' or 'smaller' keywords, these must
  be interpreted relative to the computed value of the 'font-size' property of the <a href="#font-style-source-object">font style
  source object</a> at the time that the attribute is set, if it is an element. When the
  'font-weight' component is set to the relative values 'bolder' and 'lighter', these must be
  interpreted relative to the computed value of the 'font-weight' property of the <a href="#font-style-source-object">font style
  source object</a> at the time that the attribute is set, if it is an element. If the computed
  values are undefined for a particular case (e.g. because the <a href="#font-style-source-object">font style source object</a>
  is not an element or is not <a href="rendering.html#being-rendered">being rendered</a>), then the relative keywords must be
  interpreted relative to the normal-weight 10px sans-serif default.</p>

  <p>The <dfn id="dom-context-2d-textalign" title="dom-context-2d-textAlign"><code>textAlign</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, if the value is one of <code title="dom-concept-2d-textAlign-start"><a href="#dom-concept-2d-textalign-start">start</a></code>, <code title="dom-concept-2d-textAlign-end"><a href="#dom-concept-2d-textalign-end">end</a></code>, <code title="dom-concept-2d-textAlign-left"><a href="#dom-concept-2d-textalign-left">left</a></code>, <code title="dom-concept-2d-textAlign-right"><a href="#dom-concept-2d-textalign-right">right</a></code>, or <code title="dom-concept-2d-textAlign-center"><a href="#dom-concept-2d-textalign-center">center</a></code>, then the value must be changed to the new
  value. Otherwise, the new value must be ignored. When the object implementing the
  <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> attribute must initially have the value <code title="dom-concept-2d-textAlign-start"><a href="#dom-concept-2d-textalign-start">start</a></code>.</p>

  <p>The <dfn id="dom-context-2d-textbaseline" title="dom-context-2d-textBaseline"><code>textBaseline</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, if the value is one of <code title="dom-context-2d-textBaseline-top"><a href="#dom-context-2d-textbaseline-top">top</a></code>, <code title="dom-context-2d-textBaseline-hanging"><a href="#dom-context-2d-textbaseline-hanging">hanging</a></code>, <code title="dom-context-2d-textBaseline-middle"><a href="#dom-context-2d-textbaseline-middle">middle</a></code>, <code title="dom-context-2d-textBaseline-alphabetic"><a href="#dom-context-2d-textbaseline-alphabetic">alphabetic</a></code>, <code title="dom-context-2d-textBaseline-ideographic"><a href="#dom-context-2d-textbaseline-ideographic">ideographic</a></code>, or <code title="dom-context-2d-textBaseline-bottom"><a href="#dom-context-2d-textbaseline-bottom">bottom</a></code>, then the value must be changed to the
  new value. Otherwise, the new value must be ignored. When the object implementing the
  <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute must initially have the value
  <code title="dom-context-2d-textBaseline-alphabetic"><a href="#dom-context-2d-textbaseline-alphabetic">alphabetic</a></code>.</p>

  <p>The <dfn id="dom-context-2d-direction" title="dom-context-2d-direction"><code>direction</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, if the value is one of <code title="dom-context-2d-direction-ltr">ltr</code>, <code title="dom-context-2d-direction-rtl">rtl</code>, <!--<code
  title="dom-context-2d-direction-auto">auto</code>,--> or <code title="dom-context-2d-direction-inherit">inherit</code>, then the value must be changed to the new
  value. Otherwise, the new value must be ignored. When the object implementing the
  <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> interface is created, the <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code> attribute must initially have the value <code title="dom-context-2d-direction-inherit">inherit</code>.</p>

  </div>

  <p>The <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> attribute's allowed keywords are
  as follows:</p>

  <dl><dt><dfn id="dom-concept-2d-textalign-start" title="dom-concept-2d-textAlign-start"><code>start</code></dfn>
   </dt><dd><p>Align to the start edge of the text (left side in left-to-right text, right side in
   right-to-left text).</p></dd>

   <dt><dfn id="dom-concept-2d-textalign-end" title="dom-concept-2d-textAlign-end"><code>end</code></dfn>
   </dt><dd><p>Align to the end edge of the text (right side in left-to-right text, left side in
   right-to-left text).</p></dd>

   <dt><dfn id="dom-concept-2d-textalign-left" title="dom-concept-2d-textAlign-left"><code>left</code></dfn>
   </dt><dd><p>Align to the left.</p></dd>

   <dt><dfn id="dom-concept-2d-textalign-right" title="dom-concept-2d-textAlign-right"><code>right</code></dfn>
   </dt><dd><p>Align to the right.</p></dd>

   <dt><dfn id="dom-concept-2d-textalign-center" title="dom-concept-2d-textAlign-center"><code>center</code></dfn>
   </dt><dd><p>Align to the center.</p></dd>

  </dl><p>The <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code>
  attribute's allowed keywords correspond to alignment points in the
  font:</p>

  <p><img src="http://images.whatwg.org/baselines.png" width="738" alt="The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like आ are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like Á, ÿ, f, and &amp;ohm; are anchored, the ideographic baseline is where glyphs like 私 and 達 are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square." height="300"></p>

  <p>The keywords map to these alignment points as follows:</p>

  <dl><dt><dfn id="dom-context-2d-textbaseline-top" title="dom-context-2d-textBaseline-top"><code>top</code></dfn>
   </dt><dd>The top of the em square</dd>

   <dt><dfn id="dom-context-2d-textbaseline-hanging" title="dom-context-2d-textBaseline-hanging"><code>hanging</code></dfn>
   </dt><dd>The hanging baseline</dd>

   <dt><dfn id="dom-context-2d-textbaseline-middle" title="dom-context-2d-textBaseline-middle"><code>middle</code></dfn>
   </dt><dd>The middle of the em square</dd>

   <dt><dfn id="dom-context-2d-textbaseline-alphabetic" title="dom-context-2d-textBaseline-alphabetic"><code>alphabetic</code></dfn>
   </dt><dd>The alphabetic baseline</dd>

   <dt><dfn id="dom-context-2d-textbaseline-ideographic" title="dom-context-2d-textBaseline-ideographic"><code>ideographic</code></dfn>
   </dt><dd>The ideographic baseline</dd>

   <dt><dfn id="dom-context-2d-textbaseline-bottom" title="dom-context-2d-textBaseline-bottom"><code>bottom</code></dfn>
   </dt><dd>The bottom of the em square</dd>

  </dl><p>The <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code> attribute's allowed keywords are
  as follows:</p>

  <dl><dt><dfn id="dom-concept-2d-direction-ltr" title="dom-concept-2d-direction-ltr"><code>ltr</code></dfn>

   </dt><dd><p>Treat input to the <a href="#text-preparation-algorithm">text preparation algorithm</a> as left-to-right text.</p></dd>

   <dt><dfn id="dom-concept-2d-direction-rtl" title="dom-concept-2d-direction-rtl"><code>rtl</code></dfn>

   </dt><dd><p>Treat input to the <a href="#text-preparation-algorithm">text preparation algorithm</a> as right-to-left text.</p></dd>

<!--
   <dt><dfn title="dom-concept-2d-direction-auto"><code>auto</code></dfn>

   <dd><p>Determine the direction from the input to the <span>text preparation algorithm</span>.</p></dd>
-->

   <dt><dfn id="dom-concept-2d-direction-inherit" title="dom-concept-2d-direction-inherit"><code>inherit</code></dfn>

   </dt><dd><p>Default to the directionality of the <code><a href="#the-canvas-element">canvas</a></code> element or <code><a href="dom.html#document">Document</a></code>
   as appropriate.</p></dd>

  </dl><p>The <dfn id="text-preparation-algorithm">text preparation algorithm</dfn> is as follows. It takes as input a string <var title="">text</var>, a <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object <var title="">target</var>, and an
  optional length <var title="">maxWidth</var>. It returns an array of glyph shapes, each positioned
  on a common coordinate space, a <var title="">physical alignment</var> whose value is one of
  <i>left</i>, <i>right</i>, and <i title="">center</i>, and an inline box. (Most callers of this
  algorithm ignore the <var title="">physical alignment</var> and the inline box.)</p>

  <ol><li><p>If <var title="">maxWidth</var> was provided but is less than or equal to zero, return an
   empty array.</p></li>

   <li><p>Replace all the <a href="common-microsyntaxes.html#space-character" title="space character">space characters</a> in <var title="">text</var> with U+0020 SPACE characters.</p></li>

   <li><p>Let <var title="">font</var> be the current font of <var title="">target</var>, as given
   by that object's <code title="dom-context-2d-font"><a href="#dom-context-2d-font">font</a></code> attribute.</p></li>

   <li>

    <p>Apply the appropriate step from the following list to determine the value of <var title="">direction</var>:</p>

    <dl class="switch"><dt>If the <var title="">target</var> object's <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code> attribute has the value "<code title="dom-context-2d-direction-ltr">ltr</code>"</dt>
     <dd>Let <var title="">direction</var> be '<a href="elements.html#concept-ltr" title="concept-ltr">ltr</a>'.</dd>

     <dt>If the <var title="">target</var> object's <code title="dom-context-2d-direction"><a href="#dom-context-2d-direction">direction</a></code> attribute has the value "<code title="dom-context-2d-direction-rtl">rtl</code>"</dt>
     <dd>Let <var title="">direction</var> be '<a href="elements.html#concept-rtl" title="concept-rtl">rtl</a>'.</dd>

<!--
     <dt>If the <var title="">target</var> object's <code
     title="dom-context-2d-direction">direction</code> attribute has the value "<code
     title="dom-context-2d-direction-auto">auto</code>"</dt>
     <dd>
      Find the first character in <var title="">text</var> of bidirectional character type L, AL, or
      R, if any. If such a character is found and it is of bidirectional character type AL or R,
      then let <var title="">direction</var> be '<span title="concept-rtl">rtl</span>'; otherwise,
      let <var title="">direction</var> be '<span title="concept-rtl">rtl</span>'. <a
      href="#refsBIDI">[BIDI]</a>
     </dd>
-->

     <dt>If the <var title="">target</var> object's <a href="#font-style-source-object">font style source object</a> is an
     element</dt>

     <dd>Let <var title="">direction</var> be <a href="elements.html#the-directionality">the directionality</a> of the <var title="">target</var> object's <a href="#font-style-source-object">font style source object</a>.</dd>

     <dt>If the <var title="">target</var> object's <a href="#font-style-source-object">font style source object</a> is a
     <code><a href="dom.html#document">Document</a></code> and that <code><a href="dom.html#document">Document</a></code> has a root element child</dt>

     <dd>Let <var title="">direction</var> be <a href="elements.html#the-directionality">the directionality</a> of the <var title="">target</var> object's <a href="#font-style-source-object">font style source object</a>'s root element child.</dd>

     <dt>Otherwise</dt>

     <dd>Let <var title="">direction</var> be '<a href="elements.html#concept-ltr" title="concept-ltr">ltr</a>'.</dd>

    </dl></li>

   <li><p>Form a hypothetical infinitely-wide CSS line box containing a single inline box containing
   the text <var title="">text</var>, with all the properties at their initial values except the
   'font' property of the inline box set to <var title="">font</var>, the 'direction' property of
   the inline box set to <var title="">direction</var>, and the 'white-space' property set to 'pre'.
   <a href="references.html#refsCSS">[CSS]</a></p></li>

   <!-- if you insert a step here, make sure to adjust the next step's final words -->

   <li><p>If <var title="">maxWidth</var> was provided and the hypothetical width of the inline box
   in the hypothetical line box is greater than <var title="">maxWidth</var> CSS pixels, then change
   <var title="">font</var> to have a more condensed font (if one is available or if a reasonably
   readable one can be synthesized by applying a horizontal scale factor to the font) or a smaller
   font, and return to the previous step.</p></li>

   <li>

    <p>The <var title="">anchor point</var> is a point on the inline box, and the <var title="">physical alignment</var> is one of the values <i>left</i>, <i>right</i>, and <i title="">center</i>. These variables are determined by the <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> and <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> values as follows:</p>

    <p>Horizontal position:</p>

    <dl><dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-left"><a href="#dom-concept-2d-textalign-left">left</a></code></dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-start"><a href="#dom-concept-2d-textalign-start">start</a></code> and <var title="">direction</var> is
     'ltr'</dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-end"><a href="#dom-concept-2d-textalign-end">end</a></code> and <var title="">direction</var> is 'rtl'</dt>

     <dd>Let the <var title="">anchor point</var>'s horizontal position be the left edge of the
     inline box, and let <var title="">physical alignment</var> be <i>left</i>.</dd>


     <dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-right"><a href="#dom-concept-2d-textalign-right">right</a></code></dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-end"><a href="#dom-concept-2d-textalign-end">end</a></code> and <var title="">direction</var> is 'ltr'</dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-start"><a href="#dom-concept-2d-textalign-start">start</a></code> and <var title="">direction</var> is
     'rtl'</dt>

     <dd>Let the <var title="">anchor point</var>'s horizontal position be the right edge of the
     inline box, and let <var title="">physical alignment</var> be <i>right</i>.</dd>


     <dt>If <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> is <code title="dom-concept-2d-textAlign-center"><a href="#dom-concept-2d-textalign-center">center</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s horizontal position be half way between the left
     and right edges of the inline box, and let <var title="">physical alignment</var> be <i title="">center</i>.</dd>

    </dl><p>Vertical position:</p>

    <dl><dt>If <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-top"><a href="#dom-context-2d-textbaseline-top">top</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be the top of the em box of
     the first available font of the inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-hanging"><a href="#dom-context-2d-textbaseline-hanging">hanging</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be the hanging baseline of the
     first available font of the inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-middle"><a href="#dom-context-2d-textbaseline-middle">middle</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be half way between the bottom
     and the top of the em box of the first available font of the inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-alphabetic"><a href="#dom-context-2d-textbaseline-alphabetic">alphabetic</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be the alphabetic baseline of
     the first available font of the inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-ideographic"><a href="#dom-context-2d-textbaseline-ideographic">ideographic</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be the ideographic baseline of
     the first available font of the inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-bottom"><a href="#dom-context-2d-textbaseline-bottom">bottom</a></code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be the bottom of the em box of
     the first available font of the inline box.</dd>

    </dl></li>

   <li>

    <p>Let <var title="">result</var> be an array constructed by iterating over each glyph in the
    inline box from left to right (if any), adding to the array, for each glyph, the shape of the
    glyph as it is in the inline box, positioned on a coordinate space using CSS pixels with its
    origin is at the <var title="">anchor point</var>.</p>

   </li>

   <li><p>Return <var title="">result</var>, <var title="">physical alignment</var>, and the inline
   box.</p></li>

  </ol><h6 id="building-paths"><span class="secno">4.12.4.2.6 </span>Building paths</h6>

  <p>Each object implementing the <code><a href="#canvaspathmethods">CanvasPathMethods</a></code> interface has a <a href="#concept-path" title="concept-path">path</a>. A <dfn id="concept-path" title="concept-path">path</dfn> has a list of zero or
  more subpaths. Each subpath consists of a list of one or more points, connected by straight or
  curved <dfn id="line-segments">line segments</dfn>, and a flag indicating whether the subpath is closed or not. A
  closed subpath is one where the last point of the subpath is connected to the first point of the
  subpath by a straight line. Subpaths with only one point are ignored when painting the path.</p>

  <p><a href="#concept-path" title="concept-path">Paths</a> have a <dfn id="need-new-subpath">need new subpath</dfn> flag. When this
  flag is set, certain APIs create a new subpath rather than extending the previous one. When a
  <a href="#concept-path" title="concept-path">path</a> is created, its <a href="#need-new-subpath">need new subpath</a> flag must be
  set.</p>

  <p>When an object implementing the <code><a href="#canvaspathmethods">CanvasPathMethods</a></code> interface is created, its <a href="#concept-path" title="concept-path">path</a> must be initialized to zero subpaths.</p>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-moveTo"><a href="#dom-context-2d-moveto">moveTo</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-moveTo"><a href="#dom-context-2d-moveto">moveTo</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Creates a new subpath with the given point.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-closePath"><a href="#dom-context-2d-closepath">closePath</a></code>()</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-closePath"><a href="#dom-context-2d-closepath">closePath</a></code>()</dt>

   <dd>

    <p>Marks the current subpath as closed, and starts a new subpath with a point the same as the
    start and end of the newly closed subpath.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-lineTo"><a href="#dom-context-2d-lineto">lineTo</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-lineTo"><a href="#dom-context-2d-lineto">lineTo</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a straight
    line.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-quadraticCurveTo"><a href="#dom-context-2d-quadraticcurveto">quadraticCurveTo</a></code>(<var title="">cpx</var>, <var title="">cpy</var>, <var title="">x</var>, <var title="">y</var>)</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-quadraticCurveTo"><a href="#dom-context-2d-quadraticcurveto">quadraticCurveTo</a></code>(<var title="">cpx</var>, <var title="">cpy</var>, <var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a quadratic
    Bézier curve with the given control point.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-bezierCurveTo"><a href="#dom-context-2d-beziercurveto">bezierCurveTo</a></code>(<var title="">cp1x</var>, <var title="">cp1y</var>, <var title="">cp2x</var>, <var title="">cp2y</var>, <var title="">x</var>, <var title="">y</var>)</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-bezierCurveTo"><a href="#dom-context-2d-beziercurveto">bezierCurveTo</a></code>(<var title="">cp1x</var>, <var title="">cp1y</var>, <var title="">cp2x</var>, <var title="">cp2y</var>, <var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a cubic
    Bézier curve with the given control points.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-arcTo"><a href="#dom-context-2d-arcto">arcTo</a></code>(<var title="">x1</var>, <var title="">y1</var>, <var title="">x2</var>, <var title="">y2</var>, <var title="">radiusX</var> [, <var title="">radiusY</var>, <var title="">rotation</var> ] )</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-arcTo"><a href="#dom-context-2d-arcto">arcTo</a></code>(<var title="">x1</var>, <var title="">y1</var>, <var title="">x2</var>, <var title="">y2</var>, <var title="">radiusX</var> [, <var title="">radiusY</var>, <var title="">rotation</var> ] )</dt>

   <dd>

    <p>Adds an arc with the given control points and radius to the current subpath, connected to the
    previous point by a straight line.</p>

    <p>If two radii are provided, the first controls the width of the arc's ellipse, and the second
    controls the height. If only one is provided, or if they are the same, the arc is from a circle.
    In the case of an ellipse, the rotation argument controls the clockwise inclination of the
    ellipse relative to the x-axis.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the given radius is negative.</p>

    <figure class="diagrams"><!-- if anyone wants to try writing alternative text for these,
     be my guest. I can't work out how to describe them. --><img src="http://images.whatwg.org/arcTo1.png" width="357" alt="" height="254"><img src="http://images.whatwg.org/arcTo2.png" width="468" alt="" height="310"><img src="http://images.whatwg.org/arcTo3.png" width="513" alt="" height="233"></figure><!--

c.clearRect(0, 0, 640, 480);
c.save();
try {
  var x0 = 150;
  var y0 = 100;
  var x1 = 375;
  var y1 = 100;
  var x2 = x1;
  var y2 = 250;
  var r = 50;

  var bottom = 210;
  var center = 100;

  var fontSize = 16;
  var margin = 50;
  var dotHalfSize = 5;

  // (also update the label positions at the bottom)


  // ========

  function extendLine(xa,ya,xb,yb) {
    var dx = xb-xa;
    var dy = yb-ya;
    var theta = Math.atan2(dx,dy);
    var extX = margin * Math.sin(theta);
    var extY = margin * Math.cos(theta);
    c.beginPath();
    c.moveTo(xa-extX,ya-extY);
    c.lineTo(xb+extX,yb+extY);
    c.stroke();
  }

  function dot(x,y,s) {
    c.beginPath();
    c.arc(x,y,dotHalfSize,0,Math.PI*2);
    c.fill();
    c.textAlign = 'left';
    c.textBaseline = 'top';
    c.fillText(s,x+dotHalfSize,y);
  }

  c.font = fontSize + 'px Gill Sans';
  c.fillStyle = 'black';
  c.lineWidth = 1;
  c.strokeStyle = 'red';
  extendLine(x0,y0,x1,y1);
  extendLine(x1,y1,x2,y2);

  c.lineWidth = 1;
  c.strokeStyle = 'silver';
  c.beginPath();
  c.moveTo(x0,y0);

  // based on http://lists.freedesktop.org/archives/cairo/2005-August/004801.html
  var angle0, angle1, angle2, angled;
  var xc, yc, dc;
  angle0 = Math.atan2(y0 - y1, x0 - x1);
  angle2 = Math.atan2(y2 - y1, x2 - x1);
  angle1 = (angle0 + angle2) / 2;
  angled = angle2 - angle0;
  if (angled > Math.PI || (angled < 0 && angled > -Math.PI)) {
    angle1 += Math.PI;
    angled = 2 * Math.PI - angled;
    angle0 += Math.PI*2;
    angle2 -= Math.PI*2;
  } else {
    angle0 -= Math.PI*2;
    angle2 += Math.PI*2;
  }
  dc = r / Math.sin (angled / 2);
  yc = Math.sin(angle1);
  xc = Math.cos(angle1);
  xc = x1 + xc * dc;
  yc = y1 + yc * dc;

  c.lineWidth = 1;
  c.strokeStyle = 'blue';
  c.beginPath();
  c.moveTo(xc,yc);
  c.arc(xc,yc,r, Math.PI*3/4, Math.PI*(3/4));
  c.stroke();
  c.beginPath();
  c.strokeStyle = 'silver';
  c.arc(xc,yc,r, Math.PI*3/4,Math.PI*(2+3/4));
  c.stroke();
  c.save();
  try {
    c.translate(xc, yc);
    c.rotate(-Math.PI/4);
    c.textAlign = 'center';
    c.textBaseline = 'top';
    c.fillText("radius", -r/2, 0);
  } finally {
    c.restore();
  }

  c.lineWidth = 15;
  c.lineCap = 'round';
  c.strokeStyle = 'rgba(20,200,40,0.8)';
  c.beginPath();
  c.moveTo(x0,y0);
  c.arcTo(x1,y1,x2,y2,r);
  c.stroke();

  dot(x0,y0, "x\u2080,y\u2080");
  dot(x1,y1, "x\u2081,y\u2081");
  dot(x2,y2, "x\u2082,y\u2082");
  dot(xc,yc, '');

  c.textAlign = 'left';
  c.textBaseline = 'alphabetic';
  var L = 0;

  function print(s) {
    c.fillText(s, center, bottom+L*fontSize*1.3);
    L += 1;
  }
  print('// the thick line corresponds to:');
  print('context.moveTo(x\u2080, y\u2080)');
  print('context.arcTo(x\u2081, y\u2081, x\u2082, y\u2082, radius)');
  print('context.stroke()');

  c.fillStyle = 'green';
  c.fillText("\u25be initial line", 160, 70);
  c.textAlign = 'right';
  c.fillText("arc \u25b8", x1-25, 115);

} finally {
  c.restore();
}

--></dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-arc"><a href="#dom-context-2d-arc">arc</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">radius</var>, <var title="">startAngle</var>, <var title="">endAngle</var> [, <var title="">anticlockwise</var> ] )</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-arc"><a href="#dom-context-2d-arc">arc</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">radius</var>, <var title="">startAngle</var>, <var title="">endAngle</var> [, <var title="">anticlockwise</var> ] )</dt>

   <dd>

    <p>Adds points to the subpath such that the arc described by the circumference of the circle
    described by the arguments, starting at the given start angle and ending at the given end angle,
    going in the given direction (defaulting to clockwise), is added to the path, connected to the
    previous point by a straight line.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the given radius is negative.</p>

    <figure class="diagrams"><!-- if anyone wants to try writing alternative text for this, be my guest. I can't work out how to describe it. --><img src="http://images.whatwg.org/arc1.png" width="590" alt="" height="255"></figure><!--

c.clearRect(0, 0, 640, 480);
c.save();
try {
  var x0 = 50;
  var y0 = 200;
  var x = 255;
  var y = 150;
  var radius = 100;
  var startAngle = 2.0;
  var endAngle = 5.7;
  var direction = false;

  var bottom = 110;
  var center = 380;

  var fontSize = 16;
  var margin = 50;
  var dotHalfSize = 5;
  var arrowHead = 5;

  // (also update the label positions at the bottom)

  // ========

  function dot(x,y,s) {
    c.beginPath();
    c.arc(x,y,dotHalfSize,0,Math.PI*2);
    c.fill();
    c.textAlign = 'center';
    c.textBaseline = 'top';
    c.fillText(s,x,y+dotHalfSize);
  }

  function arc(x, y, r, sA, eA, d, fr, s) {
    c.lineWidth = 1;
    c.strokeStyle = 'red';
    c.beginPath();
    c.arc(x, y, r, sA, eA, d);
    c.stroke();

    c.save();
    c.translate(x, y);
    c.rotate(eA);
    c.beginPath();
    c.moveTo(r-arrowHead, d?arrowHead:-arrowHead);
    c.lineTo(r, 0);
    c.lineTo(r+arrowHead, d?arrowHead:-arrowHead);
    c.stroke();
    c.strokeStyle = 'silver';
    c.beginPath();
    c.moveTo(0, 0);
    c.lineTo(fr, 0);
    c.stroke();
    c.restore();

    c.fillStyle = 'black';
    if (eA<Math.PI) {
      c.save();
      c.translate(x, y);
      c.rotate(sA+(eA-sA)/2-Math.PI/2);
      c.translate(0, r);
      c.rotate(-(sA+(eA-sA)/2-Math.PI/2));
      c.beginPath();
      c.textAlign = 'center';
      c.textBaseline = 'bottom';
      c.fillText(s + '  ',0,0);
      c.restore();
    } else {
      c.save();
      c.beginPath();
      c.textAlign = 'left';
      c.textBaseline = 'middle';
      c.fillText(' ' + s,x-r,y);
      c.restore();
    }
  }

  function radial(x, y, length, rotation, s) {
    c.lineWidth = 1;
    c.strokeStyle = 'blue';
    c.save();
    c.translate(x, y);
    c.rotate(rotation);
    c.beginPath();
    c.moveTo(0, 0);
    c.lineTo(length, 0);
    c.stroke();
    c.textAlign = 'center';
    c.textBaseline = 'bottom';
    c.fillStyle = 'black';
    c.fillText(s,length/2,0);
    c.restore();
  }

  c.font = fontSize + 'px Gill Sans';

  // construction lines
  c.lineWidth = 1;
  c.strokeStyle = 'silver';
  // circle
  c.beginPath();
  c.arc(x, y, radius, 0, 2*Math.PI);
  c.stroke();
  // angles
  arc(x, y, radius/10+2*radius/3, 0, startAngle, false, radius, '\u03B1');
  arc(x, y, radius/10+radius/3, 0, endAngle, false, radius, '\u03B2');
  // radii
  radial(x, y, radius, 0, 'radius');

  // the line
  c.lineWidth = 15;
  c.lineCap = 'round';
  c.strokeStyle = 'rgba(20,200,40,0.8)';
  c.beginPath();
  c.moveTo(x0,y0);
  c.arc(x,y,radius,startAngle,endAngle,direction);
  c.stroke();

  dot(x0,y0, "x\u2080,y\u2080");
  dot(x,y, "x,y");

  c.textAlign = 'left';
  c.textBaseline = 'alphabetic';
  var L = 0;

  function print(s) {
    c.fillText(s, center, bottom+L*fontSize*1.3);
    L += 1;
  }
  print('// the thick line corresponds to:');
  print('context.moveTo(x\u2080, y\u2080)');
  print('context.arc(x, y, radius, \u03B1, \u03B2)');
  print('context.stroke()');

  c.fillStyle = 'green';

  c.textBaseline = 'top';
  c.fillText("initial line \u25b4", x0+20, y0+fontSize*2);

  c.textAlign = 'right';
  c.textBaseline = 'middle';
  c.fillText("arc \u25b8", x-radius-15, y);

} finally {
  c.restore();
}
--></dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-ellipse"><a href="#dom-context-2d-ellipse">ellipse</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">radiusX</var>, <var title="">radiusY</var>, <var title="">rotation</var>, <var title="">startAngle</var>, <var title="">endAngle</var> [, <var title="">anticlockwise</var>] )</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-ellipse"><a href="#dom-context-2d-ellipse">ellipse</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">radiusX</var>, <var title="">radiusY</var>, <var title="">rotation</var>, <var title="">startAngle</var>, <var title="">endAngle</var> [, <var title="">anticlockwise</var>] )</dt>

   <dd>

    <p>Adds points to the subpath such that the arc described by the circumference of the ellipse
    described by the arguments, starting at the given start angle and ending at the given end angle,
    going in the given direction (defaulting to clockwise), is added to the path, connected to the
    previous point by a straight line.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the given radius is negative.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-rect"><a href="#dom-context-2d-rect">rect</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</dt>
   <dt><var title="">path</var> . <code title="dom-context-2d-rect"><a href="#dom-context-2d-rect">rect</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</dt>

   <dd>

    <p>Adds a new closed subpath to the path, representing the given rectangle.</p>

   </dd>

  </dl><div class="impl">

  <p>The following methods allow authors to manipulate the <a href="#concept-path" title="concept-path">paths</a>
  of objects implementing the <code><a href="#canvaspathmethods">CanvasPathMethods</a></code> interface.</p>

  <p>For <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> objects, the points passed to the methods, and the
  resulting lines added to <a href="#current-default-path">current default path</a> by these methods, must be transformed
  according to the <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a>
  before being added to the path.</p>


  <p>The <dfn id="dom-context-2d-moveto" title="dom-context-2d-moveTo"><code>moveTo(<var title="">x</var>, <var title="">y</var>)</code></dfn> method must create a new subpath with the specified point as its
  first (and only) point.</p>

  <p>When the user agent is to <dfn id="ensure-there-is-a-subpath">ensure there is a subpath</dfn> for a coordinate (<var title="">x</var>, <var title="">y</var>) on a <a href="#concept-path" title="concept-path">path</a>, the user
  agent must check to see if the <a href="#concept-path" title="concept-path">path</a> has its <a href="#need-new-subpath">need new
  subpath</a> flag set. If it does, the user agent must create a new subpath with the point (<var title="">x</var>, <var title="">y</var>) as its first (and only) point, as if the <code title="dom-context-2d-moveTo"><a href="#dom-context-2d-moveto">moveTo()</a></code> method had been called, and must then unset the
  <a href="#concept-path" title="concept-path">path</a>'s <a href="#need-new-subpath">need new subpath</a> flag.</p>


  <p>The <dfn id="dom-context-2d-closepath" title="dom-context-2d-closePath"><code>closePath()</code></dfn> method must do nothing
  if the object's path has no subpaths. Otherwise, it must mark the last subpath as closed, create a
  new subpath whose first point is the same as the previous subpath's first point, and finally add
  this new subpath to the path.</p>

  <p class="note">If the last subpath had more than one point in its list of points, then this is
  equivalent to adding a straight line connecting the last point back to the first point, thus
  "closing" the shape, and then repeating the last (possibly implied) <code title="dom-context-2d-moveTo"><a href="#dom-context-2d-moveto">moveTo()</a></code> call.</p>


  <p>New points and the lines connecting them are added to subpaths using the methods described
  below. In all cases, the methods only modify the last subpath in the object's path.</p>


  <p>The <dfn id="dom-context-2d-lineto" title="dom-context-2d-lineTo"><code>lineTo(<var title="">x</var>, <var title="">y</var>)</code></dfn> method must <a href="#ensure-there-is-a-subpath">ensure there is a subpath</a> for <span title="">(<var title="">x</var>, <var title="">y</var>)</span> if the object's path has no
  subpaths. Otherwise, it must connect the last point in the subpath to the given point (<var title="">x</var>, <var title="">y</var>) using a straight line, and must then add the given point
  (<var title="">x</var>, <var title="">y</var>) to the subpath.</p>


  <p>The <dfn id="dom-context-2d-quadraticcurveto" title="dom-context-2d-quadraticCurveTo"><code>quadraticCurveTo(<var title="">cpx</var>, <var title="">cpy</var>, <var title="">x</var>, <var title="">y</var>)</code></dfn> method must <a href="#ensure-there-is-a-subpath">ensure there is a subpath</a> for <span title="">(<var title="">cpx</var>, <var title="">cpy</var>)</span>, and then must connect the last
  point in the subpath to the given point (<var title="">x</var>, <var title="">y</var>) using a
  quadratic Bézier curve with control point (<var title="">cpx</var>, <var title="">cpy</var>), and must then add the given point (<var title="">x</var>, <var title="">y</var>) to the subpath. <a href="references.html#refsBEZIER">[BEZIER]</a></p>


  <p>The <dfn id="dom-context-2d-beziercurveto" title="dom-context-2d-bezierCurveTo"><code>bezierCurveTo(<var title="">cp1x</var>,
  <var title="">cp1y</var>, <var title="">cp2x</var>, <var title="">cp2y</var>, <var title="">x</var>, <var title="">y</var>)</code></dfn> method must <a href="#ensure-there-is-a-subpath">ensure there is a
  subpath</a> for <span title="">(<var title="">cp1x</var>, <var title="">cp1y</var>)</span>, and
  then must connect the last point in the subpath to the given point (<var title="">x</var>, <var title="">y</var>) using a cubic Bézier curve with control points (<var title="">cp1x</var>,
  <var title="">cp1y</var>) and (<var title="">cp2x</var>, <var title="">cp2y</var>). Then, it must
  add the point (<var title="">x</var>, <var title="">y</var>) to the subpath. <a href="references.html#refsBEZIER">[BEZIER]</a></p>

  <hr><p>The <dfn id="dom-context-2d-arcto" title="dom-context-2d-arcTo"><code>arcTo(<var title="">x1</var>, <var title="">y1</var>, <var title="">x2</var>, <var title="">y2</var>, <var title="">radiusX</var>,
  <var title="">radiusY</var>, <var title="">rotation</var>)</code></dfn> method must first
  <a href="#ensure-there-is-a-subpath">ensure there is a subpath</a> for <span title="">(<var title="">x1</var>, <var title="">y1</var>)</span>. Then, the behavior depends on the arguments and the last point in the
  subpath, as described below.</p>

  <p>Negative values for <var title="">radiusX</var> or <var title="">radiusY</var> must cause the
  implementation to throw an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception. If <var title="">radiusY</var>
  is omitted, user agents must act as if it had the same value as <var title="">radiusX</var>.</p>

  <p>Let the point (<var title="">x0</var>, <var title="">y0</var>) be the last point in the
  subpath, transformed by the inverse of the <a href="#transformations" title="dom-context-2d-transformation">current
  transformation matrix</a> (so that it is in the same coordinate system as the points passed to
  the method).</p>

  <p>If the point (<var title="">x0</var>, <var title="">y0</var>) is equal to the point (<var title="">x1</var>, <var title="">y1</var>), or if the point (<var title="">x1</var>, <var title="">y1</var>) is equal to the point (<var title="">x2</var>, <var title="">y2</var>), or if
  both <var title="">radiusX</var> and <var title="">radiusY</var> are zero, then the method must
  add the point (<var title="">x1</var>, <var title="">y1</var>) to the subpath, and connect that
  point to the previous point (<var title="">x0</var>, <var title="">y0</var>) by a straight
  line.</p>

  <p>Otherwise, if the points (<var title="">x0</var>, <var title="">y0</var>), (<var title="">x1</var>, <var title="">y1</var>), and (<var title="">x2</var>, <var title="">y2</var>)
  all lie on a single straight line, then the method must add the point (<var title="">x1</var>,
  <var title="">y1</var>) to the subpath, and connect that point to the previous point (<var title="">x0</var>, <var title="">y0</var>) by a straight line.</p>

  <p>Otherwise, let <var title="">The Arc</var> be the shortest arc given by circumference of the
  ellipse that has radius <var title="">radiusX</var> on the major axis and radius <var title="">radiusY</var> on the minor axis, and whose semi-major axis is rotated <var title="">rotation</var> radians clockwise from the positive x-axis, and that has one point tangent
  to the half-infinite line that crosses the point (<var title="">x0</var>, <var title="">y0</var>)
  and ends at the point (<var title="">x1</var>, <var title="">y1</var>), and that has a different
  point tangent to the half-infinite line that ends at the point (<var title="">x1</var>, <var title="">y1</var>) and crosses the point (<var title="">x2</var>, <var title="">y2</var>). The
  points at which this ellipse touches these two lines are called the start and end tangent points
  respectively. The method must connect the point (<var title="">x0</var>, <var title="">y0</var>)
  to the start tangent point by a straight line, adding the start tangent point to the subpath, and
  then must connect the start tangent point to the end tangent point by <var title="">The Arc</var>,
  adding the end tangent point to the subpath.</p>

  <hr><p>The <dfn id="dom-context-2d-arc" title="dom-context-2d-arc"><code>arc(<var title="">x</var>, <var title="">y</var>,
  <var title="">radius</var>, <var title="">startAngle</var>, <var title="">endAngle</var>, <var title="">anticlockwise</var>)</code></dfn> and <dfn id="dom-context-2d-ellipse" title="dom-context-2d-ellipse"><code>ellipse(<var title="">x</var>, <var title="">y</var>, <var title="">radiusX</var>, <var title="">radiusY</var>, <var title="">rotation</var>, <var title="">startAngle</var>, <var title="">endAngle</var>, <var title="">anticlockwise</var>)</code></dfn> methods draw arcs.</p>

  <p>The <code title="dom-context-2d-arc"><a href="#dom-context-2d-arc">arc()</a></code> method is equivalent to the <code title="dom-context-2d-ellipse"><a href="#dom-context-2d-ellipse">ellipse()</a></code> method in the case where the two radii are equal.
  When the <code title="dom-context-2d-arc"><a href="#dom-context-2d-arc">arc()</a></code> method is invoked, it must act as if the
  <code title="dom-context-2d-ellipse"><a href="#dom-context-2d-ellipse">ellipse()</a></code> method had been invoked with the <var title="">radiusX</var> and <var title="">radiusY</var> arguments set to the value of the <var title="">radius</var> argument, the <var title="">rotation</var> argument set to zero, and the
  other arguments set to the same values as their identically named arguments on the <code title="dom-context-2d-arc"><a href="#dom-context-2d-arc">arc()</a></code> method.</p>

  <p>When the <code title="dom-context-2d-ellipse"><a href="#dom-context-2d-ellipse">ellipse()</a></code> method is invoked, it must
  proceed as follows. First, if the object's path has any subpaths, then the method must add a
  straight line from the last point in the subpath to the start point of the arc. Then, it must add
  the start and end points of the arc to the subpath, and connect them with an arc. The arc and its
  start and end points are defined as follows:</p>

  <p>Consider an ellipse that has its origin at (<var title="">x</var>, <var title="">y</var>), that
  has a major-axis radius <var title="">radiusX</var> and a minor-axis radius <var title="">radiusY</var>, and that is rotated about its origin such that its semi-major axis is
  inclined <var title="">rotation</var> radians clockwise from the x-axis.</p>

  <p>If the <var title="">anticlockwise</var> argument is false and <span title=""><var title="">endAngle</var>-<var title="">startAngle</var></span> is equal to or greater than <span title="">2π</span>, or, if the <var title="">anticlockwise</var> argument is <em>true</em>
  and <span title=""><var title="">startAngle</var>-<var title="">endAngle</var></span> is equal
  to or greater than <span title="">2π</span>, then the arc is the whole circumference of this
  ellipse, and the point at <var title="">startAngle</var> along this circle's circumference,
  measured in radians clockwise from the ellipse's semi-major axis, acts as both the start point and
  the end point.</p>

  <p>Otherwise, the points at <var title="">startAngle</var> and <var title="">endAngle</var>
  along this circle's circumference, measured in radians clockwise from the ellipse's semi-major
  axis, are the start and end points respectively, and the arc is the path along the circumference
  of this ellipse from the start point to the end point, going anti-clockwise if the <var title="">anticlockwise</var> argument is true, and clockwise otherwise. Since the points are on
  the ellipse, as opposed to being simply angles from zero, the arc can never cover an angle greater
  than <span title="">2π</span> radians.</p>

  <p class="note">Even if the arc covers the entire circumference of the ellipse and there are no
  other points in the subpath, the path is not closed unless the <code title="dom-context-2d-closePath"><a href="#dom-context-2d-closepath">closePath()</a></code> method is appropriately invoked.</p>

  <p>Negative values for <var title="">radiusX</var> or <var title="">radiusY</var> must cause the
  implementation to throw an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception.</p>

  <hr><p>The <dfn id="dom-context-2d-rect" title="dom-context-2d-rect"><code>rect(<var title="">x</var>, <var title="">y</var>,
  <var title="">w</var>, <var title="">h</var>)</code></dfn> method must create a new subpath
  containing just the four points (<var title="">x</var>, <var title="">y</var>), (<var title="">x</var>+<var title="">w</var>, <var title="">y</var>), (<var title="">x</var>+<var title="">w</var>, <var title="">y</var>+<var title="">h</var>), (<var title="">x</var>, <var title="">y</var>+<var title="">h</var>), with those four points connected by straight lines, and
  must then mark the subpath as closed. It must then create a new subpath with the point (<var title="">x</var>, <var title="">y</var>) as the only point in the subpath.</p>


  <!-- v6 feature request:
        * points as a primitive shape
          http://home.comcast.net/~urbanjost/canvas/vogle4.html
  -->

  </div>



  <h6 id="path2d-objects"><span class="secno">4.12.4.2.7 </span><code><a href="#path2d">Path2D</a></code> objects</h6>

  <p><code><a href="#path2d">Path2D</a></code> objects can be used to declare paths that are then later used on
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> objects. In addition to many of the APIs described in
  earlier sections, <code><a href="#path2d">Path2D</a></code> objects have methods to combine paths, and to add text to
  paths.</p>

  <dl class="domintro"><dt><var title="">path</var> = new <code title="dom-Path2D"><a href="#dom-path2d">Path2D</a></code>()</dt>

   <dd>

    <p>Creates a new empty <code><a href="#path2d">Path2D</a></code> object.</p>

   </dd>

   <dt><var title="">path</var> = new <code title="dom-Path2D-copy"><a href="#dom-path2d-copy">Path2D</a></code>(<var title="">path</var>)</dt>

   <dd>

    <p>Creates a new <code><a href="#path2d">Path2D</a></code> object that is a copy of the argument.</p>

   </dd>

   <dt><var title="">path</var> = new <code title="dom-Path2D-merge"><a href="#dom-path2d-merge">Path2D</a></code>(<var title="">paths</var> [, <var title="">fillRule</var> ] )</dt>

   <dd>

    <p>Creates a new <code><a href="#path2d">Path2D</a></code> object that describes a path that outlines the given <var title="">paths</var>, using the given fill rule.</p>

   </dd>

   <dt><var title="">path</var> = new <code title="dom-Path2D-withdata"><a href="#dom-path2d-withdata">Path2D</a></code>(<var title="">d</var>)</dt>

   <dd>

    <p>Creates a new path with the path described by the argument, interpreted as SVG path data. <a href="references.html#refsSVG">[SVG]</a></p>

   </dd>

   <dt><var title="">path</var> . <code title="dom-Path2D-addPath"><a href="#dom-path2d-addpath">addPath</a></code>(<var title="">path</var> [, <var title="">transform</var> ] )</dt>
   <dt><var title="">path</var> . <code title="dom-Path2D-addPathByStrokingPath"><a href="#dom-path2d-addpathbystrokingpath">addPathByStrokingPath</a></code>(<var title="">path</var>, <var title="">styles</var> [, <var title="">transform</var> ] )</dt>

   <dd>

    <p>Adds to the path the path given by the argument.</p>

    <p>In the case of the stroking variants, the line styles are taken from the <var title="">styles</var> argument, which can be either a <code><a href="#drawingstyle">DrawingStyle</a></code> object or a
    <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object.</p>

   </dd>

   <dt><var title="">path</var> . <code title="dom-Path2D-addText"><a href="#dom-path2d-addtext">addText</a></code>(<var title="">text</var>, <var title="">styles</var>, <var title="">transform</var>, <var title="">x</var>, <var title="">y</var> [, <var title="">maxWidth</var> ] )</dt>
   <dt><var title="">path</var> . <code title="dom-Path2D-addText"><a href="#dom-path2d-addtext">addText</a></code>(<var title="">text</var>, <var title="">styles</var>, <var title="">transform</var>, <var title="">path</var> [, <var title="">maxWidth</var> ] )</dt>
   <dt><var title="">path</var> . <code title="dom-Path2D-addPathByStrokingText"><a href="#dom-path2d-addpathbystrokingtext">addPathByStrokingText</a></code>(<var title="">text</var>, <var title="">styles</var>, <var title="">transform</var>, <var title="">x</var>, <var title="">y</var> [, <var title="">maxWidth</var> ] )</dt>
   <dt><var title="">path</var> . <code title="dom-Path2D-addPathByStrokingText"><a href="#dom-path2d-addpathbystrokingtext">addPathByStrokingText</a></code>(<var title="">text</var>, <var title="">styles</var>, <var title="">transform</var>, <var title="">path</var> [, <var title="">maxWidth</var> ] )</dt>

   <dd>

    <p>Adds to the path a series of subpaths corresponding to the given text. If the arguments give
    a coordinate, the text is drawn horizontally at the given coordinates. If the arguments give a
    path, the text is drawn along the path. If a maximum width is provided, the text will be scaled
    to fit that width if necessary.</p>

    <p>The font, and in the case of the stroking variants, the line styles, are taken from the <var title="">styles</var> argument, which can be either a <code><a href="#drawingstyle">DrawingStyle</a></code> object or a
    <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-path2d" title="dom-Path2D"><code>Path()</code></dfn> constructor, when invoked, must return a
  newly created <code><a href="#path2d">Path2D</a></code> object.</p>

  <hr><p>The <dfn id="dom-path2d-copy" title="dom-Path2D-copy"><code>Path(<var title="">path</var>)</code></dfn> constructor,
  when invoked, must return a newly created <code><a href="#path2d">Path2D</a></code> object, to which the subpaths of the
  argument are added. (In other words, it returns a copy of the argument.)</p>

  <hr><p>The <dfn id="dom-path2d-merge" title="dom-Path2D-merge"><code>Path(<var title="">paths</var>, <var title="">fillRule</var>)</code></dfn> constructor, when invoked, must run the following
  steps:</p>

  <ol><li>

    <p>Run the appropriate step from the following list, based on the constructor's sectond
    argument:</p>

    <dl class="switch"><dd>If it is "nonzero"</dd>

     <dd>

      <p>Let <var title="">merged path</var> be a <a href="#concept-path" title="concept-path">path</a> that
      consists of a set of non-overlapping subpaths that exactly outline the points from which, in
      any of the <a href="#concept-path" title="concept-path">paths</a> provided in the constructor's first
      argument, the number of times a half-infinite straight line drawn from that point crosses a
      subpath going in one direction is not equal to the number of times it crosses a subpath going
      in the other direction.</p>

     </dd>

     <dd>If it is "evenodd"</dd>

     <dd>

      <p>Let <var title="">merged path</var> be a <a href="#concept-path" title="concept-path">path</a> that
      consists of a set of non-overlapping subpaths that exactly outline the points from which, in
      any of the <a href="#concept-path" title="concept-path">paths</a> provided in the constructor's first
      argument, the number of times a half-infinite straight line drawn from that point crosses that
      path is odd.</p>

     </dd>

    </dl><p>The subpaths in <var title="">merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

   </li>

   <li><p>Add all the subpaths in <var title="">merged path</var> to the <code><a href="#path2d">Path2D</a></code>
   object.</p></li>

   <li><p>Set the <code><a href="#path2d">Path2D</a></code> object's <a href="#need-new-subpath">need new subpath</a> flag.</p></li>

  </ol><hr><p>The <dfn id="dom-path2d-withdata" title="dom-Path2D-withdata"><code>Path(<var title="">d</var>)</code></dfn> constructor
  must run the following steps:</p>

  <ol><li>

    <p>Parse and interpret the <var title="">d</var> argument according to the SVG specification's
    rules for path data, thus obtaining an SVG path. <a href="references.html#refsSVG">[SVG]</a></p>

    <p class="note">The resulting path could be empty. SVG defines error handling rules for parsing
    and applying path data.</p>

   </li>

   <li><p>Let (<var title="">x</var>, <var title="">y</var>) be the last point in the SVG
   path.</p></li>

   <li><p>Create a new <code><a href="#path2d">Path2D</a></code> object and add all the subpaths in the SVG path, if any, to
   that <code><a href="#path2d">Path2D</a></code> object. </p>

   </li><li><p>Create a new subpath in the <code><a href="#path2d">Path2D</a></code> object with (<var title="">x</var>, <var title="">y</var>) as the only point in the subpath.</p></li>

   <li><p>Return the <code><a href="#path2d">Path2D</a></code> object as the constructed object.</p></li>

  </ol><hr><p>The <dfn id="dom-path2d-addpath" title="dom-Path2D-addPath"><code>addPath(<var title="">b</var>, <var title="">transform</var>)</code></dfn> method, when invoked on a <code><a href="#path2d">Path2D</a></code> object <var title="">a</var>, must run the following steps:</p>

  <ol><li><p>If the <code><a href="#path2d">Path2D</a></code> object <var title="">b</var> has no subpaths, abort these
   steps.</p></li>

   <li><p>Create a copy of all the subpaths in <var title="">b</var>. Let this copy be known as <var title="">c</var>.</p></li>

   <li><p>Transform all the coordinates and lines in <var title="">c</var> by the transform matrix
   <var title="">transform</var>, if it is not null.</p></li>

   <li><p>Let (<var title="">x</var>, <var title="">y</var>) be the last point in the last subpath
   of <var title="">c</var>.</p></li>

   <li><p>Add all the subpaths in <var title="">c</var> to <var title="">a</var>.</p></li>

   <li><p>Create a new subpath in <var title="">a</var> with (<var title="">x</var>, <var title="">y</var>) as the only point in the subpath.</p></li>

  </ol><hr><p>The <dfn id="dom-path2d-addpathbystrokingpath" title="dom-Path2D-addPathByStrokingPath"><code>addPathByStrokingPath(<var title="">b</var>, <var title="">styles</var>, <var title="">transform</var>)</code></dfn> method,
  when invoked on a <code><a href="#path2d">Path2D</a></code> object <var title="">a</var>, must run the following
  steps:</p>

  <ol><li><p>If the <code><a href="#path2d">Path2D</a></code> object <var title="">b</var> has no subpaths, abort these
   steps.</p></li>

   <li><p>Create a copy of all the subpaths in <var title="">b</var>. Let this copy be known as <var title="">c</var>.</p></li>

   <li><p>Transform all the coordinates and lines in <var title="">c</var> by transformation matrix
   <var title="">transform</var>, if it is not null.</p></li>

   <li><p>Let a new list of subpaths <var title="">d</var> be the result of <a href="#trace-a-path" title="trace a
   path">tracing</a> <var title="">c</var>, using the <var title="">styles</var> argument for the
   line styles.</p>

   </li><li><p>Let (<var title="">x</var>, <var title="">y</var>) be the last point in the last subpath
   of <var title="">d</var>.</p></li>

   <li><p>Add all the subpaths in <var title="">d</var> to <var title="">a</var>.</p></li>

   <li><p>Create a new subpath in <var title="">a</var> with (<var title="">x</var>, <var title="">y</var>) as the only point in the subpath.</p></li>

  </ol><hr><p>The <dfn id="dom-path2d-addtext" title="dom-Path2D-addText"><code>addText()</code></dfn> and <dfn id="dom-path2d-addpathbystrokingtext" title="dom-Path2D-addPathByStrokingText"><code>addPathByStrokingText()</code></dfn> methods each
  come in two variants: one rendering text at a given coordinate, and one rendering text along a
  given path. In both cases, the methods take a <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object argument for
  the text and (if appropriate) line styles to use, an <code><a href="infrastructure.html#svgmatrix">SVGMatrix</a></code> object <var title="">transform</var> (which can be null), and a maximum width can optionally be provided.</p>

  <p>When one of the <code title="dom-Path2D-addText"><a href="#dom-path2d-addtext">addText()</a></code> and <code title="dom-Path2D-addPathByStrokingText"><a href="#dom-path2d-addpathbystrokingtext">addPathByStrokingText()</a></code> variants that take as
  argument an (<var title="">x</var>, <var title="">y</var>) coordinate is invoked, the method must
  run the following algorithm:</p>

  <ol><li><p>Run the <a href="#text-preparation-algorithm">text preparation algorithm</a>, passing it <var title="">text</var>, the
   <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object argument, and, if the <var title="">maxWidth</var>
   argument was provided, that argument. Let <var title="">glyphs</var> be the result.</p>

   </li><li><p>Move all the shapes in <var title="">glyphs</var> to the right by <var title="">x</var>
   CSS pixels and down by <var title="">y</var> CSS pixels.</p></li>

<!--CLEANUP-->
   <li><p>Let <var title="">glyph paths</var> be a list of <a href="#concept-path" title="concept-path">paths</a> describing the shapes given
   in <var title="">glyphs</var>, with each CSS pixel in the coordinate space of <var title="">glyphs</var> mapped to one coordinate space unit in <var title="">glyph paths</var>.
   Subpaths in <var title="">glyph paths</var> must wind clockwise, regardless of how the user
   agent's font subsystem renders fonts and regardless of how the fonts themselves are defined.</p>

   </li><li><p>Transform all the coordinates and lines in <var title="">glyph paths</var> by the
   transformation matrix <var title="">transform</var>, if it is not null.</p></li>

<!--CLEANUP-->
   <li><p>If the method is <code title="dom-Path2D-addPathByStrokingText"><a href="#dom-path2d-addpathbystrokingtext">addPathByStrokingText()</a></code>, replace <var title="">glyph paths</var> by the result of <a href="#trace-a-path" title="trace a path">tracing</a> each <a href="#concept-path" title="concept-path">path</a> in <var title="">glyph paths</var>, using the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object argument for the
   line styles.</p>

   </li><li id="mergeGlyphs">

    <p>Let <var title="">merged path</var> be a <a href="#concept-path" title="concept-path">path</a> that
    consists of a set of non-overlapping subpaths that exactly outline the points from which, in any
    of the <a href="#concept-path" title="concept-path">paths</a> in <var title="">glyph paths</var>, the number
    of times a half-infinite straight line drawn from that point crosses that path is odd.</p>

    <p>The subpaths in <var title="">merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

    <div class="example">

     <p>For example, suppose <var title="">text</var> consists of two overlapping glyphs "Q" and
     "p" (maybe the "Q" has a flourish that crosses into the tail of the "p"). The <var title="">glyph paths</var> therefore consist of two paths, each with two subpaths: one for the
     outside of the letter shape, and one for the inside of the letter shape. There are points that,
     according to the even-odd fill rule, are filled in both shapes simultaneously: where they
     overlap. As such, the subpaths from the two glyphs actually cross each other.</p>

     <p><img src="http://images.whatwg.org/Qp-overlap.png" alt=""></p> <!-- this image repeats the previous paragraph,
     so alternative text would be redundant -->
     <!--
          c.clearRect(0, 0, 640, 480);
          c.save();
          try {
            c.font = '100px Zapfino';
            c.fillStyle = 'blue';
            c.fillText('Q', 200, 200);
            c.fillStyle = 'fuchsia';
            c.fillText('p', 337, 200);
          } finally {
            c.restore();
          }
     -->

     <p>The resulting <var title="">merged path</var> in such a situation would have just one path
     for these two letters, with a total of just three subpaths (one big outer outline, one for the
     inside of the "Q", and one for inside of the "p"). This single path would have no subpaths that
     cross each other.</p>

     <p><img src="http://images.whatwg.org/Qp-overlap-outline.png" alt=""></p> <!-- this image again repeats the
     previous paragraph, so alternative text would be redundant -->
     <!-- this is just an edge-detected version of the previous image -->

    </div>

   </li>

   <li><p>Add all the subpaths in <var title="">merged path</var> to the <code><a href="#path2d">Path2D</a></code>
   object.</p></li>

   <li><p>Set the <code><a href="#path2d">Path2D</a></code> object's <a href="#need-new-subpath">need new subpath</a> flag.</p></li>

  </ol><p>When one of the <code title="dom-Path2D-addText"><a href="#dom-path2d-addtext">addText()</a></code> and <code title="dom-Path2D-addPathByStrokingText"><a href="#dom-path2d-addpathbystrokingtext">addPathByStrokingText()</a></code> variants that take as
  argument a <code><a href="#path2d">Path2D</a></code> object is invoked, the method must run the following algorithm:</p>

  <ol><li><p>Let <var title="">target</var> be the <code><a href="#path2d">Path2D</a></code> object on which the method was
   invoked.</p></li>

   <li><p>Let <var title="">path</var> be the <code><a href="#path2d">Path2D</a></code> object that was provided in the
   method's arguments.</p></li>

   <li><p>Run the <a href="#text-preparation-algorithm">text preparation algorithm</a>, passing it <var title="">text</var>, the
   <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object argument, and, if the <var title="">maxWidth</var>
   argument was provided, that argument. Let <var title="">glyphs</var> be the resulting array, and
   <var title="">physical alignment</var> be the resulting alignment value.</p>

   </li><li><p>Let <var title="">width</var> be the aggregate length of all the subpaths in <var title="">path</var>, including the distances from the last point of each closed subpath to the
   first point of that subpath.</p></li>

   <li><p>Define <var title="">L</var> to be a linear coordinate line for of all the subpaths in
   <var title="">path</var>, with additional lines drawn between the last point and the first point
   of each closed subpath, such that the first point of the first subpath is defined as point 0, and
   the last point of the last subpath, if the last subpath is not closed, or the second occurrence
   first point of that subpath, if it is closed, is defined as point <var title="">width</var>.</p></li>

   <li>

    <p>Let <var title="">offset</var> be determined according to the appropriate step below:</p>

    <dl class="switch"><dt>If <var title="">physical alignment</var> is <i>left</i></dt> <dd>Let <var title="">offset</var> be zero.</dd>

     <dt>If <var title="">physical alignment</var> is <i>right</i></dt> <dd>Let <var title="">offset</var> be <var title="">width</var>.</dd>

     <dt>If <var title="">physical alignment</var> is <i title="">center</i></dt> <dd>Let <var title="">offset</var> be half of <var title="">width</var>.</dd>

    </dl></li>

   <li><p>Move all the shapes in <var title="">glyphs</var> to the right by <var title="">offset</var> CSS pixels.</p></li>

   <li><p>Let <var title="">transformed path list</var> be an empty list of paths.</p></li>

   <li>

    <p>For each glyph <var title="">glyph</var> in the <var title="">glyphs</var> array, run these
    substeps:</p>

    <ol><li><p>Let <var title="">dx</var> be the <var title="">x</var>-coordinate of the horizontal
     center of the bounding box of the shape described by <var title="">glyph</var>, in CSS
     pixels.</p></li>

     <li><p>If <var title="">dx</var> is negative or greater than <var title="">width</var>, skip
     the remainder of these substeps for this glyph.</p></li>

     <li><p>Recast <var title="">dx</var> to coordinate spaces units in <var title="">path</var>.
     (This just changes the dimensionality of <var title="">dx</var>, not its numeric value.)</p>
     <!-- hide this step if people get confused by the pedancy -->

     </li><li><p>Find the point <var title="">p</var> on <var title="">path</var> (or implied closing
     lines in <var title="">path</var>) that corresponds to the position <var title="">dx</var> on
     the coordinate line <var title="">L</var>.</p>

     </li><li><p>Let <var title="">θ</var> be the clockwise angle from the positive x-axis to the
     side of the line that is tangential to <var title="">path</var> at the point <var title="">p</var> that is going in the same direction as the line at point <var title="">p</var>.</p></li>

     <li><p>Rotate the shape described by <var title="">glyph</var> clockwise by <var title="">θ</var> about the point that is at the <var title="">dx</var> coordinate
     horizontally and the zero coordinate vertically.</p></li>

     <li><p>Let (<var title="">x</var>, <var title="">y</var>) be the coordinate of the point <var title="">p</var>.</p></li>

     <li><p>Move the shape described by <var title="">glyph</var> to the right by <var title="">x</var> and down by <var title="">y</var>.</p></li>

     <li><p>Let <var title="">glyph subpaths</var> be a list of subpaths describing the shape given
     in <var title="">glyph</var>, with each CSS pixel in the coordinate space of <var title="">glyph</var> mapped to one coordinate space unit in <var title="">glyph subpaths</var>.
     Subpaths in <var title="">glyph subpaths</var> must wind clockwise, regardless of how the user
     agent's font subsystem renders fonts and regardless of how the fonts themselves are
     defined.</p>

     </li><li><p>Transform all the coordinates and lines in <var title="">glyph subpaths</var> by the
     transformation matrix <var title="">transform</var>, if it is not null.</p></li>

     <li><p>If the method is <code title="dom-Path2D-addPathByStrokingText"><a href="#dom-path2d-addpathbystrokingtext">addPathByStrokingText()</a></code>, replace <var title="">glyph subpaths</var> by the result of <a href="#trace-a-path" title="trace a path">tracing</a> <var title="">glyph subpaths</var>, using the <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> object argument for
     the line styles.</p>

     </li><li><p>Add all the subpaths in <var title="">glyph subpaths</var> to <var title="">transformed path list</var>.</p></li>

    </ol></li>

   <li>

    <p>Let <var title="">merged path</var> be a <a href="#concept-path" title="concept-path">path</a> that
    consists of a set of non-overlapping subpaths that exactly outline the points from which, in any
    of the <a href="#concept-path" title="concept-path">paths</a> in <var title="">transformed path list</var>,
    the number of times a half-infinite straight line drawn from that point crosses that path is
    odd.</p>

    <p>The subpaths in <var title="">merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

    <p class="note">See <a href="#mergeGlyphs">the equivalent step in the earlier algorithm</a> for
    an example of this step. It's even more likely that there will be overlap with this method,
    since neighboring glyphs are likely to be rotated relative to each other.</p>

   </li>

   <li><p>Add all the subpaths in <var title="">merged path</var> to <var title="">target</var>.</p></li>

   <li><p>Set the <code><a href="#path2d">Path2D</a></code> object's <a href="#need-new-subpath">need new subpath</a> flag.</p></li>

  </ol></div>


  <h6 id="transformations"><span class="secno">4.12.4.2.8 </span><dfn title="dom-context-2d-transformation">Transformations</dfn></h6>

  <p>Each <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object has a <i>current transformation matrix</i>,
  as well as methods (described in this section) to manipulate it. When a
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is created, its transformation matrix must be
  initialized to the identity transform.</p>

  <p>The transformation matrix is applied to coordinates when creating the <a href="#current-default-path">current default
  path</a>, and when painting text, shapes, and <code><a href="#path2d">Path2D</a></code> objects, on
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> objects.</p> <!-- conformance criteria for actual drawing
  are described in the various sections below -->

  <p class="note">Most of the API uses <code><a href="infrastructure.html#svgmatrix">SVGMatrix</a></code> objects rather than this API. This API
  remains mostly for historical reasons.</p>

  <div class="impl">

  <p>The transformations must be performed in reverse order.</p>

  <p class="note">For instance, if a scale transformation that doubles the width is applied to the
  canvas, followed by a rotation transformation that rotates drawing operations by a quarter turn,
  and a rectangle twice as wide as it is tall is then drawn on the canvas, the actual result will be
  a square.</p> <!-- q.v. http://goo.gl/5RLrN -->

  </div>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-currentTransform"><a href="#dom-context-2d-currenttransform">currentTransform</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the transformation matrix, as an <code><a href="infrastructure.html#svgmatrix">SVGMatrix</a></code> object.</p>

    <p>Can be set, to change the transformation matrix.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-scale"><a href="#dom-context-2d-scale">scale</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Changes the transformation matrix to apply a scaling transformation with the given characteristics.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-rotate"><a href="#dom-context-2d-rotate">rotate</a></code>(<var title="">angle</var>)</dt>

   <dd>

    <p>Changes the transformation matrix to apply a rotation transformation with the given characteristics. The angle is in radians.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-translate"><a href="#dom-context-2d-translate">translate</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Changes the transformation matrix to apply a translation transformation with the given characteristics.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-transform"><a href="#dom-context-2d-transform">transform</a></code>(<var title="">a</var>, <var title="">b</var>, <var title="">c</var>, <var title="">d</var>, <var title="">e</var>, <var title="">f</var>)</dt>

   <dd>

    <p>Changes the transformation matrix to apply the matrix given by the arguments as described below.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-setTransform"><a href="#dom-context-2d-settransform">setTransform</a></code>(<var title="">a</var>, <var title="">b</var>, <var title="">c</var>, <var title="">d</var>, <var title="">e</var>, <var title="">f</var>)</dt>

   <dd>

    <p>Changes the transformation matrix <em>to</em> the matrix given by the arguments as described below.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-resetTransform"><a href="#dom-context-2d-resettransform">resetTransform</a></code>()</dt>

   <dd>

    <p>Changes the transformation matrix to the identity transform.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-context-2d-currenttransform" title="dom-context-2d-currentTransform"><code>currentTransform</code></dfn>, on
  getting, must return the last object that it was set to. On setting, its value must be changed to
  the new value, and the transformation matrix must be updated to match the matrix described by the
  new value. When the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is created, the <code title="dom-context-2d-currentTransform"><a href="#dom-context-2d-currenttransform">currentTransform</a></code> attribute must be set a newly
  created <code><a href="infrastructure.html#svgmatrix">SVGMatrix</a></code> object. When the transformation matrix is mutated by the methods
  described in this section, the last <code><a href="infrastructure.html#svgmatrix">SVGMatrix</a></code> object to which the attribute has been
  set must be mutated in a corresponding fashion.</p>

  <p>The <dfn id="dom-context-2d-scale" title="dom-context-2d-scale"><code>scale(<var title="">x</var>, <var title="">y</var>)</code></dfn> method must add the scaling transformation described by the
  arguments to the transformation matrix. The <var title="">x</var> argument represents the scale
  factor in the horizontal direction and the <var title="">y</var> argument represents the scale
  factor in the vertical direction. The factors are multiples.</p>

  <p>The <dfn id="dom-context-2d-rotate" title="dom-context-2d-rotate"><code>rotate(<var title="">angle</var>)</code></dfn>
  method must add the rotation transformation described by the argument to the transformation
  matrix. The <var title="">angle</var> argument represents a clockwise rotation angle expressed in
  radians.</p>

  <p>The <dfn id="dom-context-2d-translate" title="dom-context-2d-translate"><code>translate(<var title="">x</var>, <var title="">y</var>)</code></dfn> method must add the translation transformation described by the
  arguments to the transformation matrix. The <var title="">x</var> argument represents the
  translation distance in the horizontal direction and the <var title="">y</var> argument represents
  the translation distance in the vertical direction. The arguments are in coordinate space
  units.</p>

  <p>The <dfn id="dom-context-2d-transform" title="dom-context-2d-transform"><code>transform(<var title="">a</var>, <var title="">b</var>, <var title="">c</var>, <var title="">d</var>, <var title="">e</var>, <var title="">f</var>)</code></dfn> method must replace the current transformation matrix with the
  result of multiplying the current transformation matrix with the matrix described by:</p>

  </div>

  <table class="matrix"><tr><td><var title="">a</var></td>
    <td><var title="">c</var></td>
    <td><var title="">e</var></td>
   </tr><tr><td><var title="">b</var></td>
    <td><var title="">d</var></td>
    <td><var title="">f</var></td>
   </tr><tr><td>0</td>
    <td>0</td>
    <td>1</td>
   </tr></table><p class="note">The arguments <var title="">a</var>, <var title="">b</var>, <var title="">c</var>,
  <var title="">d</var>, <var title="">e</var>, and <var title="">f</var> are sometimes called <var title="">m11</var>, <var title="">m12</var>, <var title="">m21</var>, <var title="">m22</var>,
  <var title="">dx</var>, and <var title="">dy</var> or <var title="">m11</var>, <var title="">m21</var>, <var title="">m12</var>, <var title="">m22</var>, <var title="">dx</var>, and
  <var title="">dy</var>. Care should be taken in particular with the order of the second and third
  arguments (<var title="">b</var> and <var title="">c</var>) as their order varies from API to API
  and APIs sometimes use the notation <var title="">m12</var>/<var title="">m21</var> and sometimes
  <var title="">m21</var>/<var title="">m12</var> for those positions.</p>

  <div class="impl">

  <p>The <dfn id="dom-context-2d-settransform" title="dom-context-2d-setTransform"><code>setTransform(<var title="">a</var>, <var title="">b</var>, <var title="">c</var>, <var title="">d</var>, <var title="">e</var>, <var title="">f</var>)</code></dfn> method must reset the current transform to the identity matrix, and
  then invoke the <code><a href="#dom-context-2d-transform" title="dom-context-2d-transform">transform</a>(<var title="">a</var>, <var title="">b</var>, <var title="">c</var>, <var title="">d</var>, <var title="">e</var>, <var title="">f</var>)</code> method with the same arguments.</p>

  <p>The <dfn id="dom-context-2d-resettransform" title="dom-context-2d-resetTransform"><code>resetTransform()</code></dfn> method must
  reset the current transform to the identity matrix.</p>

  </div>



  <h6 id="image-sources-for-2d-rendering-contexts"><span class="secno">4.12.4.2.9 </span>Image sources for 2D rendering contexts</h6>

  <p>Several methods in the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> API take the union type
  <code><a href="#canvasimagesource">CanvasImageSource</a></code> as an argument.</p>

  <p>This union type allows objects implementing any of the following interfaces to be used as image
  sources:</p>

  <ul><li><code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code> (<code><a href="edits.html#the-img-element">img</a></code> elements)</li>

   <li><code><a href="the-video-element.html#htmlvideoelement">HTMLVideoElement</a></code> (<code><a href="the-video-element.html#the-video-element">video</a></code> elements)</li>

   <li><code><a href="#htmlcanvaselement">HTMLCanvasElement</a></code> (<code><a href="#the-canvas-element">canvas</a></code> elements)</li>

   <li><code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code></li>

   <li><code><a href="timers.html#imagebitmap">ImageBitmap</a></code></li>

  </ul><p class="note">The <code><a href="timers.html#imagebitmap">ImageBitmap</a></code> interface can be created from a number of other
  image-representing types, including <code><a href="#imagedata">ImageData</a></code>.</p>

  <p>When a user agent is required to <dfn id="check-the-usability-of-the-image-argument">check the usability of the <var title="">image</var>
  argument</dfn>, where <var title="">image</var> is a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object, the
  user agent must run these steps, which return either <i>good</i>, <i>bad</i>, or
  <i>aborted</i>:</p>

  <ol><li><p>If the <var title="">image</var> argument is an <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code> object that
   is in the <a href="edits.html#img-error" title="img-error">broken</a> state, then throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception, return <i>aborted</i>, and abort these steps.</p>

   </li><li><p>If the <var title="">image</var> argument is an <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code> object that
   is not <a href="edits.html#img-good" title="img-good">fully decodable</a>, or if the <var title="">image</var>
   argument is an <code><a href="the-video-element.html#htmlvideoelement">HTMLVideoElement</a></code> object whose <code title="dom-media-readyState"><a href="the-video-element.html#dom-media-readystate">readyState</a></code> attribute is either <code title="dom-media-HAVE_NOTHING"><a href="the-video-element.html#dom-media-have_nothing">HAVE_NOTHING</a></code> or <code title="dom-media-HAVE_METADATA"><a href="the-video-element.html#dom-media-have_metadata">HAVE_METADATA</a></code>, then return <i>bad</i> and abort these
   steps.</p></li>

   <li><p>If the <var title="">image</var> argument is an <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code> object with
   an intrinsic width or intrinsic height (or both) equal to zero, then return <i>bad</i> and abort
   these steps.</p> <!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2567 -->

   </li><li><p>If the <var title="">image</var> argument is an <code><a href="#htmlcanvaselement">HTMLCanvasElement</a></code> object with
   either a horizontal dimension or a vertical dimension equal to zero, then return <i>bad</i> and
   abort these steps.</p>

   </li><li><p>Return <i>good</i>.</p></li>

  </ol><p>When a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents an <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code>, the
  element's image must be used as the source image.</p>

  <p>Specifically, when a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents an animated image in an
  <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code>, the user agent must use the default image of the animation (the
  one that the format defines is to be used when animation is not supported or is disabled), or, if
  there is no such image, the first frame of the animation, when rendering the image for
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> APIs.</p>

  <p>When a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents an <code><a href="the-video-element.html#htmlvideoelement">HTMLVideoElement</a></code>, then
  the frame at the <a href="the-video-element.html#current-playback-position">current playback position</a> when the method with the argument is
  invoked must be used as the source image when rendering the image for
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> APIs, and the source image's dimensions must be the <a href="the-video-element.html#concept-video-intrinsic-width" title="concept-video-intrinsic-width">intrinsic width</a> and <a href="the-video-element.html#concept-video-intrinsic-height" title="concept-video-intrinsic-height">intrinsic height</a> of the <a href="the-video-element.html#media-resource">media resource</a>
  (i.e. after any aspect-ratio correction has been applied).</p>

  <p>When a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents an <code><a href="#htmlcanvaselement">HTMLCanvasElement</a></code>, the
  element's bitmap must be used as the source image.</p>

  <p>When a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents a <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>, the
  object's <a href="#scratch-bitmap">scratch bitmap</a> must be used as the source image.</p>

  <p>When a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents an element that is <a href="rendering.html#being-rendered">being
  rendered</a> and that element has been resized, the original image data of the source image
  must be used, not the image as it is rendered (e.g. <code title="attr-dim-width"><a href="the-map-element.html#attr-dim-width">width</a></code> and
  <code title="attr-dim-height"><a href="the-map-element.html#attr-dim-height">height</a></code> attributes on the source element have no effect on how
  the object is interpreted when rendering the image for <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>
  APIs).</p>

  <p>When a <code><a href="#canvasimagesource">CanvasImageSource</a></code> object represents an <code><a href="timers.html#imagebitmap">ImageBitmap</a></code>, the
  object's bitmap image data must be used as the source image.</p>

<!--ADD-TOPIC:Security-->
  <p><dfn id="the-image-argument-is-not-origin-clean">The <var title="">image argument</var> is not origin-clean</dfn> if it is an
  <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code> or <code><a href="the-video-element.html#htmlvideoelement">HTMLVideoElement</a></code> whose <a href="origin-0.html#origin">origin</a> is not
  the <a href="origin-0.html#same-origin" title="same origin">same</a> as the <a href="origin-0.html#origin">origin</a> specified by the <a href="webappapis.html#entry-settings-object">entry
  settings object</a>, or if it is an <code><a href="#htmlcanvaselement">HTMLCanvasElement</a></code> whose bitmap's <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag is false, or if it is a
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object whose <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag is false.</p>
<!--REMOVE-TOPIC:Security-->



  <h6 id="fill-and-stroke-styles"><span class="secno">4.12.4.2.10 </span>Fill and stroke styles</h6>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current style used for filling shapes.</p>

    <p>Can be set, to change the fill style.</p>

    <p>The style can be either a string containing a CSS color, or a
    <code><a href="#canvasgradient">CanvasGradient</a></code> or <code><a href="#canvaspattern">CanvasPattern</a></code>
    object. Invalid values are ignored.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current style used for stroking shapes.</p>

    <p>Can be set, to change the stroke style.</p>

    <p>The style can be either a string containing a CSS color, or a
    <code><a href="#canvasgradient">CanvasGradient</a></code> or <code><a href="#canvaspattern">CanvasPattern</a></code>
    object. Invalid values are ignored.</p>

   </dd>

  </dl><div class="impl">

  <!-- v6 feature requests:

   * Getting and setting colours by component to bypass the CSS value parsing.

     Either:
        context.fillStyle.red += 1;

     Or:
        var array = context.fillStyle;
        array[1] += 1;
        context.fillStyle = array;

   * A more performant way of setting colours in general, e.g.:

       context.setFillColor(r,g,b,a) // already supported by webkit

     Or:

       context.fillStyle = 0xRRGGBBAA; // set a 32bit int directly

  -->

  <p>The <dfn id="dom-context-2d-fillstyle" title="dom-context-2d-fillStyle"><code>fillStyle</code></dfn> attribute represents the
  color or style to use inside shapes, and the <dfn id="dom-context-2d-strokestyle" title="dom-context-2d-strokeStyle"><code>strokeStyle</code></dfn> attribute represents the color
  or style to use for the lines around the shapes.</p>

  <p>Both attributes can be either strings, <code><a href="#canvasgradient">CanvasGradient</a></code>s, or
  <code><a href="#canvaspattern">CanvasPattern</a></code>s. On setting, strings must be <a href="infrastructure.html#parsed-as-a-css-color-value" title="parsed as a CSS
  &lt;color&gt; value">parsed as CSS &lt;color&gt; values</a> and the color assigned, and
  <code><a href="#canvasgradient">CanvasGradient</a></code> and <code><a href="#canvaspattern">CanvasPattern</a></code> objects must be assigned themselves. <a href="references.html#refsCSSCOLOR">[CSSCOLOR]</a> If the value is a string but cannot be <a href="infrastructure.html#parsed-as-a-css-color-value">parsed as a CSS
  &lt;color&gt; value</a>, then it must be ignored, and the attribute must retain its previous
  value.
<!--ADD-TOPIC:Security-->
  If the new value is a <code><a href="#canvaspattern">CanvasPattern</a></code> object that is marked as <a href="#concept-canvas-pattern-not-origin-clean" title="concept-canvas-pattern-not-origin-clean">not origin-clean</a>, then the <a href="#scratch-bitmap">scratch
  bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag must be set to
  false.
<!--REMOVE-TOPIC:Security-->
  </p>

  <p>When set to a <code><a href="#canvaspattern">CanvasPattern</a></code> or <code><a href="#canvasgradient">CanvasGradient</a></code> object, the assignment
  is <a href="infrastructure.html#live">live</a>, meaning that changes made to the object after the assignment do affect
  subsequent stroking or filling of shapes.</p>

  <p>On getting, if the value is a color, then the <a href="#serialization-of-a-color" title="serialization of a
  color">serialization of the color</a> must be returned. Otherwise, if it is not a color but a
  <code><a href="#canvasgradient">CanvasGradient</a></code> or <code><a href="#canvaspattern">CanvasPattern</a></code>, then the respective object must be
  returned. (Such objects are opaque and therefore only useful for assigning to other attributes or
  for comparison to other gradients or patterns.)</p>

  <p>The <dfn id="serialization-of-a-color">serialization of a color</dfn> for a color value is a string, computed as follows: if
  it has alpha equal to 1.0, then the string is a lowercase six-digit hex value, prefixed with a "#"
  character (U+0023 NUMBER SIGN), with the first two digits representing the red component, the next
  two digits representing the green component, and the last two digits representing the blue
  component, the digits being <a href="common-microsyntaxes.html#lowercase-ascii-hex-digits">lowercase ASCII hex digits</a>. Otherwise, the color value
  has alpha less than 1.0, and the string is the color value in the CSS <code title="">rgba()</code>
  functional-notation format: the literal string <code title="">rgba</code> (U+0072 U+0067 U+0062
  U+0061) followed by a U+0028 LEFT PARENTHESIS, a base-ten integer in the range 0-255 representing
  the red component (using <a href="common-microsyntaxes.html#ascii-digits">ASCII digits</a> in the shortest form possible), a literal
  U+002C COMMA and U+0020 SPACE, an integer for the green component, a comma and a space, an integer
  for the blue component, another comma and space, a U+0030 DIGIT ZERO, if the alpha value is
  greater than zero then a U+002E FULL STOP (representing the decimal point), if the alpha value is
  greater than zero then one or more <a href="common-microsyntaxes.html#ascii-digits">ASCII digits</a> representing the fractional part of
  the alpha<!-- value with no trailing zeros (implied by next sentence)-->, and finally a U+0029
  RIGHT PARENTHESIS. User agents must express the fractional part of the alpha value, if any, with
  the level of precision necessary for the alpha value, when reparsed, to be interpreted as the same
  alpha value.</p> <!-- if people complain this is unreadable, expand it into a <dl> with two nested
  <ol>s -->

  <p>When the context is created, the <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code> and <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> attributes
  must initially have the string value <code title="">#000000</code>.</p>

  <p>When the value is a color, it must not be affected by the transformation matrix when used to
  draw on bitmaps.</p> <!-- so singular matrices don't affect solid color fillStyles -->

  </div>

  <hr><p>There are two types of gradients, linear gradients and radial gradients, both represented by
  objects implementing the opaque <code><a href="#canvasgradient">CanvasGradient</a></code> interface.</p>

  <p id="interpolation">Once a gradient has been created (see below), stops are placed along it to
  define how the colors are distributed along the gradient. <span class="impl">The color of the
  gradient at each stop is the color specified for that stop. Between each such stop, the colors and
  the alpha component must be linearly interpolated over the RGBA space without premultiplying the
  alpha value to find the color to use at that offset. Before the first stop, the color must be the
  color of the first stop. After the last stop, the color must be the color of the last stop. When
  there are no stops, the gradient is transparent black.</span></p>

  <dl class="domintro"><dt><var title="">gradient</var> . <code title="dom-canvasgradient-addColorStop"><a href="#dom-canvasgradient-addcolorstop">addColorStop</a></code>(<var title="">offset</var>, <var title="">color</var>)</dt>

   <dd>

    <p>Adds a color stop with the given color to the gradient at the given offset. 0.0 is the offset
    at one end of the gradient, 1.0 is the offset at the other end.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the offset is out of range. Throws a
    <code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code> exception if the color cannot be parsed.</p>

   </dd>

   <dt><var title="">gradient</var> = <var title="">context</var> . <code title="dom-context-2d-createLinearGradient"><a href="#dom-context-2d-createlineargradient">createLinearGradient</a></code>(<var title="">x0</var>, <var title="">y0</var>, <var title="">x1</var>, <var title="">y1</var>)</dt>

   <dd>

    <p>Returns a <code><a href="#canvasgradient">CanvasGradient</a></code> object that represents a
    linear gradient that paints along the line given by the
    coordinates represented by the arguments.</p>

   </dd>

   <dt><var title="">gradient</var> = <var title="">context</var> . <code title="dom-context-2d-createRadialGradient"><a href="#dom-context-2d-createradialgradient">createRadialGradient</a></code>(<var title="">x0</var>, <var title="">y0</var>, <var title="">r0</var>, <var title="">x1</var>, <var title="">y1</var>, <var title="">r1</var>)</dt>

   <dd>

    <p>Returns a <code><a href="#canvasgradient">CanvasGradient</a></code> object that represents a
    radial gradient that paints along the cone given by the circles
    represented by the arguments.</p>

    <p>If either of the radii are negative, throws an
    <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-canvasgradient-addcolorstop" title="dom-canvasgradient-addColorStop"><code>addColorStop(<var title="">offset</var>,
  <var title="">color</var>)</code></dfn> method on the <code><a href="#canvasgradient">CanvasGradient</a></code> interface adds a
  new stop to a gradient. If the <var title="">offset</var> is less than 0 or greater than 1 then an
  <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception must be thrown. If the <var title="">color</var> cannot be
  <a href="infrastructure.html#parsed-as-a-css-color-value">parsed as a CSS &lt;color&gt; value</a>, then a <code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code> exception must
  be thrown. Otherwise, the gradient must have a new stop placed, at offset <var title="">offset</var> relative to the whole gradient, and with the color obtained by parsing <var title="">color</var> as a CSS &lt;color&gt; value. If multiple stops are added at the same offset
  on a gradient, they must be placed in the order added, with the first one closest to the start of
  the gradient, and each subsequent one infinitesimally further along towards the end point (in
  effect causing all but the first and last stop added at each point to be ignored).</p>

  <p>The <dfn id="dom-context-2d-createlineargradient" title="dom-context-2d-createLinearGradient"><code>createLinearGradient(<var title="">x0</var>, <var title="">y0</var>, <var title="">x1</var>, <var title="">y1</var>)</code></dfn> method takes four arguments that represent the start point (<var title="">x0</var>, <var title="">y0</var>) and end point (<var title="">x1</var>, <var title="">y1</var>) of the gradient. The method must return a linear <code><a href="#canvasgradient">CanvasGradient</a></code>
  initialized with the specified line.</p>

  <p>Linear gradients must be rendered such that all points on a line perpendicular to the line that
  crosses the start and end points have the color at the point where those two lines cross (with the
  colors coming from the <a href="#interpolation">interpolation and extrapolation</a> described
  above). The points in the linear gradient must be transformed as described by the <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a> when rendering.</p>

  <p>If <span title=""><var title="">x0</var> = <var title="">x1</var></span> and <span title=""><var title="">y0</var> = <var title="">y1</var></span>, then the linear
  gradient must paint nothing.</p>

  <p>The <dfn id="dom-context-2d-createradialgradient" title="dom-context-2d-createRadialGradient"><code>createRadialGradient(<var title="">x0</var>, <var title="">y0</var>, <var title="">r0</var>, <var title="">x1</var>, <var title="">y1</var>, <var title="">r1</var>)</code></dfn> method takes six arguments, the first
  three representing the start circle with origin (<var title="">x0</var>, <var title="">y0</var>)
  and radius <var title="">r0</var>, and the last three representing the end circle with origin
  (<var title="">x1</var>, <var title="">y1</var>) and radius <var title="">r1</var>. The values are
  in coordinate space units. If either of <var title="">r0</var> or <var title="">r1</var> are
  negative, an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception must be thrown. Otherwise, the method must
  return a radial <code><a href="#canvasgradient">CanvasGradient</a></code> initialized with the two specified circles.</p>

  <p>Radial gradients must be rendered by following these steps:</p>

  <ol><li><p>If <span title=""><var title="">x<sub title="">0</sub></var> = <var title="">x<sub title="">1</sub></var></span> and <span title=""><var title="">y<sub title="">0</sub></var> = <var title="">y<sub title="">1</sub></var></span> and <span title=""><var title="">r<sub title="">0</sub></var> = <var title="">r<sub title="">1</sub></var></span>, then the radial gradient must
   paint nothing. Abort these steps.</p></li>

   <li>

    <p>Let <span title="">x(<var title="">ω</var>) = (<var title="">x<sub title="">1</sub></var>-<var title="">x<sub title="">0</sub></var>)<var title="">ω</var> + <var title="">x<sub title="">0</sub></var></span></p>

    <p>Let <span title="">y(<var title="">ω</var>) = (<var title="">y<sub title="">1</sub></var>-<var title="">y<sub title="">0</sub></var>)<var title="">ω</var> + <var title="">y<sub title="">0</sub></var></span></p>

    <p>Let <span title="">r(<var title="">ω</var>) = (<var title="">r<sub title="">1</sub></var>-<var title="">r<sub title="">0</sub></var>)<var title="">ω</var> + <var title="">r<sub title="">0</sub></var></span></p>

    <p>Let the color at <var title="">ω</var> be the color at that position on the gradient
    (with the colors coming from the <a href="#interpolation">interpolation and extrapolation</a>
    described above).</p>

   </li>

   <li><p>For all values of <var title="">ω</var> where <span title="">r(<var title="">ω</var>) &gt; 0</span>, starting with the value of <var title="">ω</var> nearest to positive infinity and ending with the value of <var title="">ω</var> nearest to negative infinity, draw the circumference of the circle with
   radius <span title="">r(<var title="">ω</var>)</span> at position (<span title="">x(<var title="">ω</var>)</span>, <span title="">y(<var title="">ω</var>)</span>), with the
   color at <var title="">ω</var>, but only painting on the parts of the bitmap that have not
   yet been painted on by earlier circles in this step for this rendering of the gradient.</p></li>

  </ol><p class="note">This effectively creates a cone, touched by the two circles defined in the
  creation of the gradient, with the part of the cone before the start circle (0.0) using the color
  of the first offset, the part of the cone after the end circle (1.0) using the color of the last
  offset, and areas outside the cone untouched by the gradient (transparent black).</p>

  <p>The resulting radial gradient must then be transformed as described by the <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a> when rendering.</p>

  <p>Gradients must be painted only where the relevant stroking or filling effects requires that
  they be drawn.</p>

  </div>

  <hr><p>Patterns are represented by objects implementing the opaque <code><a href="#canvaspattern">CanvasPattern</a></code>
  interface.</p>

  <dl class="domintro"><dt><var title="">pattern</var> = <var title="">context</var> . <code title="dom-context-2d-createPattern"><a href="#dom-context-2d-createpattern">createPattern</a></code>(<var title="">image</var>, <var title="">repetition</var>)</dt>

   <dd>

    <p>Returns a <code><a href="#canvaspattern">CanvasPattern</a></code> object that uses the given image and repeats in the
    direction(s) given by the <var title="">repetition</var> argument.</p>

    <p>The allowed values for <var title="">repetition</var> are <code title="">repeat</code> (both
    directions), <code title="">repeat-x</code> (horizontal only), <code title="">repeat-y</code>
    (vertical only), and <code title="">no-repeat</code> (neither). If the <var title="">repetition</var> argument is empty, the value <code title="">repeat</code> is used.</p>

    <p>If the image isn't yet fully decoded, then nothing is drawn. If the image is a canvas with no
    data, throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.</p>

   </dd>

   <dt><var title="">pattern</var> . <code title="dom-canvaspattern-setTransform"><a href="#dom-canvaspattern-settransform">setTransform</a></code>(<var title="">transform</var>)</dt>

   <dd>

    <p>Sets the transformation matrix that will be used when rendering the pattern during a fill or
    stroke painting operation.</p>

   </dd>

  </dl><div class="impl">

  <p>To create objects of this type, the <dfn id="dom-context-2d-createpattern" title="dom-context-2d-createPattern"><code>createPattern(<var title="">image</var>, <var title="">repetition</var>)</code></dfn> method is used. When the method is invoked, the user agent
  must run the following steps:</p>

  <ol><li><p>Let <var title="">image</var> be the first argument and <var title="">repetition</var> be
   the second argument.</p></li>

   <li><p><a href="#check-the-usability-of-the-image-argument">Check the usability of the <var title="">image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then return null and abort these steps. Otherwise it
   returns <i>good</i>; continue with these steps.</p></li>

   <li><p>If <var title="">repetition</var> is the empty string, let it be "<code title="">repeat</code>".</p>

   </li><li><p>If <var title="">repetition</var> is not a <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for one of
   "<code title="">repeat</code>", "<code title="">repeat-x</code>", "<code title="">repeat-y</code>", or "<code title="">no-repeat</code>", throw a <code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code>
   exception and abort these steps.</p></li>

   <li><p>Create a new <code><a href="#canvaspattern">CanvasPattern</a></code> object with the image <var title="">image</var>
   and the repetition behavior given by <var title="">repetition</var>.</p></li>

<!--ADD-TOPIC:Security-->
   <li><p>If <a href="#the-image-argument-is-not-origin-clean">the <var title="">image argument</var> is not origin-clean</a>, then mark the
   <code><a href="#canvaspattern">CanvasPattern</a></code> object as <dfn id="concept-canvas-pattern-not-origin-clean" title="concept-canvas-pattern-not-origin-clean">not
   origin-clean</dfn>.</p></li>
<!--REMOVE-TOPIC:Security-->

   <li><p>Return the <code><a href="#canvaspattern">CanvasPattern</a></code> object.</p></li>

  </ol><p>Modifying the <var title="">image</var> used when creating a <code><a href="#canvaspattern">CanvasPattern</a></code> object
  after calling the <code title="dom-context-2d-createPattern"><a href="#dom-context-2d-createpattern">createPattern()</a></code> method must
  not affect the pattern(s) rendered by the <code><a href="#canvaspattern">CanvasPattern</a></code> object.</p>

  <p>Patterns have a transformation matrix, which controls how the pattern is used when it is
  painted. Initially, a pattern's transformation matrix must be the identity transform.</p>

  <p>When the <dfn id="dom-canvaspattern-settransform" title="dom-canvaspattern-setTransform"><code>setTransform()</code></dfn> method
  is invoked on the pattern, the user agent must replace the pattern's transformation matrix with
  the one described by the <code><a href="infrastructure.html#svgmatrix">SVGMatrix</a></code> object provided as an argument to the method.</p>

  <p>When a pattern is to be rendered within an area, the user agent must run the following steps to
  determine what is rendered:</p>

  <ol><li><p>Create an infinite transparent black bitmap.</p></li>

   <li>

    <p>Place a copy of the image on the bitmap, anchored such that its top left corner is at the
    origin of the coordinate space, with one coordinate space unit per CSS pixel of the image, then
    place repeated copies of this image horizontally to the left and right, if the repetition
    behavior is "<code title="">repeat-x</code>", or vertically up and down, if the repetition
    behavior is "<code title="">repeat-y</code>", or in all four directions all over the bitmap, if
    the repetition behavior is "<code title="">repeat</code>".</p>

    <p>If the original image data is a bitmap image, the value painted at a point in the area of the
    repetitions is computed by filtering the original image data. When scaling up, if the <code title="dom-context-2d-imageSmoothingEnabled"><a href="#dom-context-2d-imagesmoothingenabled">imageSmoothingEnabled</a></code> attribute is set to
    false, the image must be rendered using nearest-neighbor interpolation. Otherwise, the user agent
    may use any filtering algorithm (for example bilinear interpolation or nearest-neighbor). When
    such a filtering algorithm requires a pixel value from outside the original image data, it must
    instead use the value from wrapping the pixel's coordinates to the original image's dimensions.
    (That is, the filter uses 'repeat' behavior, regardless of the value of the pattern's repetition
    behavior.)</p>
    <!-- drawImage() has similar paragraphs with different rules -->

   </li>

   <li><p>Transform the resulting bitmap according to the pattern's transformation matrix.</p></li>

   <li><p>Transform the resulting bitmap again, this time according to the <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a>.</p></li>

   <li><p>Replace any part of the image outside the area in which the pattern is to be rendered with
   transparent black.</p></li>

   <li><p>The resulting bitmap is what is to be rendered, with the same origin and same
   scale.</p></li>

  </ol><hr><p>If a radial gradient or repeated pattern is used when the transformation matrix is singular,
  the resulting style must be transparent black (otherwise the gradient or pattern would be
  collapsed to a point or line, leaving the other pixels undefined). Linear gradients and solid
  colors always define all points even with singular tranformation matrices.</p>

  </div>




  <h6 id="drawing-rectangles-to-the-bitmap"><span class="secno">4.12.4.2.11 </span>Drawing rectangles to the bitmap</h6>

  <p>There are three methods that immediately draw rectangles to the bitmap. They each take four
  arguments; the first two give the <var title="">x</var> and <var title="">y</var> coordinates of
  the top left of the rectangle, and the second two give the width <var title="">w</var> and height
  <var title="">h</var> of the rectangle, respectively.</p>

  <div class="impl">

  <p>The <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a> must be
  applied to the following four coordinates, which form the path that must then be closed to get the
  specified rectangle: <span title="">(<var title="">x</var>, <var title="">y</var>)</span>, <span title="">(<span title=""><var title="">x</var>+<var title="">w</var></span>, <var title="">y</var>)</span>, <span title="">(<span title=""><var title="">x</var>+<var title="">w</var></span>, <span title=""><var title="">y</var>+<var title="">h</var></span>)</span>, <span title="">(<var title="">x</var>, <span title=""><var title="">y</var>+<var title="">h</var></span>)</span>.</p>

  <p>Shapes are painted without affecting the <a href="#current-default-path">current default path</a>, and are subject to
  the <a href="#clipping-region">clipping region</a>, and, with the exception of <code title="dom-context-2d-clearRect"><a href="#dom-context-2d-clearrect">clearRect()</a></code>, also <a href="#shadows" title="shadows">shadow
  effects</a>, <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, and <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition operators</a>.</p>

  </div>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-clearRect"><a href="#dom-context-2d-clearrect">clearRect</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</dt>

   <dd>

    <p>Clears all pixels on the bitmap in the given rectangle to transparent black.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-fillRect"><a href="#dom-context-2d-fillrect">fillRect</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</dt>

   <dd>

    <p>Paints the given rectangle onto the bitmap, using the current fill style.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-strokeRect"><a href="#dom-context-2d-strokerect">strokeRect</a></code>(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</dt>

   <dd>

    <p>Paints the box that outlines the given rectangle onto the bitmap, using the current stroke
    style.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-context-2d-clearrect" title="dom-context-2d-clearRect"><code>clearRect(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>Let <var title="">pixels</var> be the set of pixels in the specified rectangle that also
   intersect the current <a href="#clipping-region">clipping region</a>.</p></li>

   <li><p>Clear the pixels in <var title="">pixels</var> to a fully transparent black, erasing any
   previous image.</p></li>

   <li><p><a href="#clear-regions-that-cover-the-pixels">Clear regions that cover the pixels</a> in <var title="">pixels</var> on the
   <a href="#scratch-bitmap">scratch bitmap</a>.</p></li>

  </ol><p class="note">If either height or width are zero, this method has no effect, since the set of
  pixels would be empty.</p>

  <p>The <dfn id="dom-context-2d-fillrect" title="dom-context-2d-fillRect"><code>fillRect(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</code></dfn> method must paint the
  specified rectangular area using the <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code>. If
  either height or width are zero, this method has no effect.</p>

  <p>The <dfn id="dom-context-2d-strokerect" title="dom-context-2d-strokeRect"><code>strokeRect(<var title="">x</var>, <var title="">y</var>, <var title="">w</var>, <var title="">h</var>)</code></dfn> method must take the
  result of <a href="#trace-a-path" title="trace a path">tracing the path</a> described below, using the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's line styles, and fill it with the <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code>.</p>

  <p>If both <var title="">w</var> and <var title="">h</var> are zero, the path has a single subpath
  with just one point (<var title="">x</var>, <var title="">y</var>), and no lines, and this method
  thus has no effect (the <a href="#trace-a-path">trace a path</a> algorithm returns an empty path in that
  case).</p>

  <p>If just one of either <var title="">w</var> or <var title="">h</var> is zero, then the path has
  a single subpath consisting of two points, with coordinates (<span title=""><var title="">x</var></span>, <span title=""><var title="">y</var></span>) and (<span title=""><var title="">x</var>+<var title="">w</var></span>, <span title=""><var title="">y</var></span>+<var title="">h</var>), in that order, connected by a single straight line.</p>

  <p>Otherwise, the path has a single subpath consisting of four points, with coordinates (<span title=""><var title="">x</var></span>, <span title=""><var title="">y</var></span>), (<span title=""><var title="">x</var>+<var title="">w</var></span>, <span title=""><var title="">y</var></span>), (<span title=""><var title="">x</var>+<var title="">w</var></span>,
  <span title=""><var title="">y</var></span>+<var title="">h</var>), and (<span title=""><var title="">x</var></span>, <span title=""><var title="">y</var>+<var title="">h</var></span>),
  connected to each other in that order by straight lines.</p>

  </div>



  <h6 id="drawing-text-to-the-bitmap"><span class="secno">4.12.4.2.12 </span>Drawing text to the bitmap</h6>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-fillText"><a href="#dom-context-2d-filltext">fillText</a></code>(<var title="">text</var>, <var title="">x</var>, <var title="">y</var> [, <var title="">maxWidth</var> ] )</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-strokeText"><a href="#dom-context-2d-stroketext">strokeText</a></code>(<var title="">text</var>, <var title="">x</var>, <var title="">y</var> [, <var title="">maxWidth</var> ] )</dt>

   <dd>

    <p>Fills or strokes (respectively) the given text at the given position. If a maximum width is
    provided, the text will be scaled to fit that width if necessary.</p>

   </dd>

   <dt><var title="">metrics</var> = <var title="">context</var> . <code title="dom-context-2d-measureText"><a href="#dom-context-2d-measuretext">measureText</a></code>(<var title="">text</var>)</dt>

   <dd>

    <p>Returns a <code><a href="#textmetrics">TextMetrics</a></code> object with the metrics of the given text in the current
    font.</p>

   </dd>

   <dt><var title="">metrics</var> . <code title="dom-textmetrics-width"><a href="#dom-textmetrics-width">width</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-actualBoundingBoxLeft"><a href="#dom-textmetrics-actualboundingboxleft">actualBoundingBoxLeft</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-actualBoundingBoxRight"><a href="#dom-textmetrics-actualboundingboxright">actualBoundingBoxRight</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-fontBoundingBoxAscent"><a href="#dom-textmetrics-fontboundingboxascent">fontBoundingBoxAscent</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-fontBoundingBoxDescent"><a href="#dom-textmetrics-fontboundingboxdescent">fontBoundingBoxDescent</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-actualBoundingBoxAscent"><a href="#dom-textmetrics-actualboundingboxascent">actualBoundingBoxAscent</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-actualBoundingBoxDescent"><a href="#dom-textmetrics-actualboundingboxdescent">actualBoundingBoxDescent</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-emHeightAscent"><a href="#dom-textmetrics-emheightascent">emHeightAscent</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-emHeightDescent"><a href="#dom-textmetrics-emheightdescent">emHeightDescent</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-hangingBaseline"><a href="#dom-textmetrics-hangingbaseline">hangingBaseline</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-alphabeticBaseline"><a href="#dom-textmetrics-alphabeticbaseline">alphabeticBaseline</a></code></dt>
   <dt><var title="">metrics</var> . <code title="dom-textmetrics-ideographicBaseline"><a href="#dom-textmetrics-ideographicbaseline">ideographicBaseline</a></code></dt>

   <dd>

    <p>Returns the measurement described below.</p>

   </dd>

  </dl><div class="impl">

  <p>The <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> interface provides the following methods for
  rendering text.</p>

  <p>The <dfn id="dom-context-2d-filltext" title="dom-context-2d-fillText"><code>fillText()</code></dfn> and <dfn id="dom-context-2d-stroketext" title="dom-context-2d-strokeText"><code>strokeText()</code></dfn> methods take three or four
  arguments, <var title="">text</var>, <var title="">x</var>, <var title="">y</var>, and optionally
  <var title="">maxWidth</var>, and render the given <var title="">text</var> at the given (<var title="">x</var>, <var title="">y</var>) coordinates ensuring that the text isn't wider than <var title="">maxWidth</var> if specified, using the current <code title="dom-context-2d-font"><a href="#dom-context-2d-font">font</a></code>, <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code>,
  and <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> values. Specifically, when the
  methods are called, the user agent must run the following steps:</p>

  <ol><li><p>Run the <a href="#text-preparation-algorithm">text preparation algorithm</a>, passing it <var title="">text</var>, the
   <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object, and, if the <var title="">maxWidth</var> argument
   was provided, that argument. Let <var title="">glyphs</var> be the result.</p>

   </li><li><p>Move all the shapes in <var title="">glyphs</var> to the right by <var title="">x</var>
   CSS pixels and down by <var title="">y</var> CSS pixels.</p></li>

   <li>

    <p>Paint the shapes given in <var title="">glyphs</var>, as transformed by the <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a>, with each CSS pixel
    in the coordinate space of <var title="">glyphs</var> mapped to one coordinate space unit.</p>

    <p>For <code title="dom-context-2d-fillText"><a href="#dom-context-2d-filltext">fillText()</a></code>, <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code> must be applied to the shapes and <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> must be ignored. For <code title="dom-context-2d-strokeText"><a href="#dom-context-2d-stroketext">strokeText()</a></code>, the reverse holds: <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> must be applied to the result of <a href="#trace-a-path" title="trace a path">tracing</a> the shapes using the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>
    object for the line styles, and <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code> must be
    ignored.</p>

    <p>These shapes are painted without affecting the current path, and are subject to <a href="#shadows" title="shadows">shadow effects</a>, <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global
    alpha</a>, the <a href="#clipping-region">clipping region</a>, and <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition operators</a>.</p>

   </li>

<!--ADD-TOPIC:Security-->
   <li><p>If the <a href="#text-preparation-algorithm">text preparation algorithm</a> used a font that has an <a href="origin-0.html#origin">origin</a>
   that is not the <a href="origin-0.html#same-origin" title="same origin">same</a> as the <a href="origin-0.html#origin">origin</a> specified by
   the <a href="webappapis.html#entry-settings-object">entry settings object</a> (even if "using a font" means just checking if that font
   has a particular glyph in it before falling back to another font), then set the <a href="#scratch-bitmap">scratch
   bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag to
   false.</p></li> <!-- because fonts could consider sensitive material, I guess; and because that
   sensitivity could extend to whether or not a particular glyph is in the font in the first place.
   -->
<!--REMOVE-TOPIC:Security-->

  </ol><!--v6DVT - this is commented out until CSS can get its act together
enough to actual specify vertical text rendering (how long have we
been waiting now?)

WHEN EDITING THIS, FIX THE PARTS MARKED "&#x0058;&#x0058;&#x0058;" BELOW

ALSO NOTE THAT THIS PROBABLY NEEDS ENTIRELY REVISITING NOW THAT WE
HAVE REJIGGED HOW TEXT WORKS IN v5 (e.g. remember security)

  <p>The <dfn title="dom-context-2d-fillVerticalText"><code>fillVerticalText()</code></dfn> and <dfn
  title="dom-context-2d-strokeVerticalText"><code>strokeVerticalText()</code></dfn> methods take
  three or four arguments, <var title="">text</var>, <var title="">x</var>, <var title="">y</var>,
  and optionally <var title="">maxHeight</var>, and render the given <var title="">text</var> as
  vertical text at the given (<var title="">x</var>, <var title="">y</var>) coordinates ensuring
  that the text isn't taller than <var title="">maxHeight</var> if specified, using the current
  <code title="dom-context-2d-font">font</code> and <code
  title="dom-context-2d-textAlign">textAlign</code> values. Specifically, when the methods are
  called, the user agent must run the following steps:</p>

  <ol>

   <li><p>If <var title="">maxHeight</var> is present but less than or equal to zero, return without
   doing anything; abort these steps.</p></li>

   <li><p>Let <var title="">font</var> be the current font of the context, as given by the <code
   title="dom-context-2d-font">font</code> attribute.</p></li>

   <li><p>Replace all the <span title="space character">space characters</span> in <var
   title="">text</var> with U+0020 SPACE characters.</p></li>

   <li><p>Form a <em class="&#x0058;&#x0058;&#x0058;">whatever CSS ends up calling vertical line
   boxes and inline boxes</em> containing the text <var title="">text</var>, with all the properties
   at their initial values except the 'font' property of the inline box set to <var
   title="">font</var> and the 'direction' property of the inline box set to <span>the
   directionality</span> of the <code>canvas</code> element.</p></li>

   <!- - if you insert a step here, make sure to adjust the next step's final words - ->

   <li><p>If the <var title="">maxHeight</var> argument was specified and the hypothetical height of
   the <em class="&#x0058;&#x0058;&#x0058;">box</em> in the hypothetical line box is greater than
   <var title="">maxHeight</var> CSS pixels, then change <var title="">font</var> to have a more
   condensed font (if one is available or if a reasonably readable one can be synthesized by
   applying an appropriate scale factor to the font) or a smaller font, and return to the previous
   step.</p></li>

   <li>

    <p>Let the <var title="">anchor point</var> be a point on the <em
    class="&#x0058;&#x0058;&#x0058;">inline box</var>, determined by the <code
    title="dom-context-2d-textAlign">textAlign</code>, as follows:</p>

    <p>Vertical position:</p>

    <dl>

     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">start</code></dt>

     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code title="">left</code>
     and <span>the directionality</span> of the <code>canvas</code> element is 'ltr'</dt>

     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code title="">right</code>
     and <span>the directionality</span> of the <code>canvas</code> element is 'rtl'</dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be the top edge of the <em
     class="&#x0058;&#x0058;&#x0058;">inline box</em>.</dd>


     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">end</code></dt>

     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code title="">right</code>
     and <span>the directionality</span> of the <code>canvas</code> element is 'ltr'</dt>

     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code title="">left</code>
     and <span>the directionality</span> of the <code>canvas</code> element is 'rtl'</dt>

     <dd>Let the <var title="">anchor point</var>'s vertical
     position be the bottom edge of the <em class="&#x0058;&#x0058;&#x0058;">inline
     box</em>.</dd>


     <dt>If <code title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">center</code></dt>

     <dd>Let the <var title="">anchor point</var>'s vertical position be half way between the top
     and bottom edges of the <em class="&#x0058;&#x0058;&#x0058;">inline box</em>.</dd>

    </dl>

    <p>Let the horizontal position be half way between the left and right edges of the em box of the
    first available font of the <em class="&#x0058;&#x0058;&#x0058;">inline box</em>.</p>

   </li>

   <li>

    <p>Paint the hypothetical inline box as the shape given by the text's glyphs, as transformed by
    the <span title="dom-context-2d-transformation">current transformation matrix</span>, and
    anchored and sized so that before applying the <span
    title="dom-context-2d-transformation">current transformation matrix</span>, the <var
    title="">anchor point</var> is at (<var title="">x</var>, <var title="">y</var>) and each CSS
    pixel is mapped to one coordinate space unit.</p>

    <p>For <code title="dom-context-2d-fillVerticalText">fillVerticalText()</code> <code
    title="dom-context-2d-fillStyle">fillStyle</code> must be applied and <code
    title="dom-context-2d-strokeStyle">strokeStyle</code> must be ignored. For <code
    title="dom-context-2d-strokeVerticalText">strokeVerticalText()</code> the reverse holds and
    <code title="dom-context-2d-strokeStyle">strokeStyle</code> must be applied and <code
    title="dom-context-2d-fillStyle">fillStyle</code> must be ignored.</p>

    <p>Text is painted without affecting the current path, and is subject to <span
    title="shadows">shadow effects</span>, <span title="dom-context-2d-globalAlpha">global
    alpha</span>, the <span>clipping region</span>, and <span
    title="dom-context-2d-globalCompositeOperation">global composition operators</span>.</p>

   </li>

  </ol>

v6DVT (also check for '- -' bits in the part above) --><p>The <dfn id="dom-context-2d-measuretext" title="dom-context-2d-measureText"><code>measureText()</code></dfn> method takes one
  argument, <var title="">text</var>. When the method is invoked, the user agent must run the
  <a href="#text-preparation-algorithm">text preparation algorithm</a>, passing it <var title="">text</var> and the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object, and then using the returned inline box must create a
  new <code><a href="#textmetrics">TextMetrics</a></code> object with its attributes set as described in the following list.
<!--ADD-TOPIC:Security-->
  If doing these measurements requires using a font that has an <a href="origin-0.html#origin">origin</a> that is not the
  <a href="origin-0.html#same-origin" title="same origin">same</a> as that of the <code><a href="dom.html#document">Document</a></code> object that owns the
  <code><a href="#the-canvas-element">canvas</a></code> element (even if "using a font" means just checking if that font has a
  particular glyph in it before falling back to another font), then the method must throw a
  <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception.
<!--REMOVE-TOPIC:Security-->
  Otherwise, it must return the new <code><a href="#textmetrics">TextMetrics</a></code> object.
  <a href="references.html#refsCSS">[CSS]</a>
  <a href="introduction.html#fingerprinting-vector" class="fingerprint" title="fingerprinting vector"><img src="http://images.whatwg.org/fingerprint.png" width="46" alt="(This is a fingerprinting vector.)" height="64"></a>
  </p>

  </div>

  <dl><dt><dfn id="dom-textmetrics-width" title="dom-textmetrics-width"><code>width</code></dfn> attribute</dt>

   <dd><p>The width of that inline box, in CSS pixels. (The text's advance width.)</p></dd>

   <dt><dfn id="dom-textmetrics-actualboundingboxleft" title="dom-textmetrics-actualBoundingBoxLeft"><code>actualBoundingBoxLeft</code></dfn> attribute</dt>

   <dd>

    <p>The distance parallel to the baseline from the alignment point given by the <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> attribute to the left side of the bounding
    rectangle of the given text, in CSS pixels; positive numbers indicating a distance going left
    from the given alignment point.

    </p><p class="note">The sum of this value and the next (<code title="dom-textmetrics-actualBoundingBoxRight"><a href="#dom-textmetrics-actualboundingboxright">actualBoundingBoxRight</a></code>) can be wider than
    the width of the inline box (<code title="dom-textmetrics-width"><a href="#dom-textmetrics-width">width</a></code>), in particular
    with slanted fonts where characters overhang their advance width.</p>

   </dd>

   <dt><dfn id="dom-textmetrics-actualboundingboxright" title="dom-textmetrics-actualBoundingBoxRight"><code>actualBoundingBoxRight</code></dfn> attribute</dt>

   <dd>

    <p>The distance parallel to the baseline from the alignment point given by the <code title="dom-context-2d-textAlign"><a href="#dom-context-2d-textalign">textAlign</a></code> attribute to the right side of the bounding
    rectangle of the given text, in CSS pixels; positive numbers indicating a distance going right
    from the given alignment point.</p>

   </dd>

   <dt><dfn id="dom-textmetrics-fontboundingboxascent" title="dom-textmetrics-fontBoundingBoxAscent"><code>fontBoundingBoxAscent</code></dfn> attribute</dt>

   <dd>

    <p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the top of the highest
    bounding rectangle of all the fonts used to render the text, in CSS pixels; positive numbers
    indicating a distance going up from the given baseline.</p>

    <p class="note">This value and the next are useful when rendering a background that must have a
    consistent height even if the exact text being rendered changes. The <code title="dom-textmetrics-actualBoundingBoxAscent"><a href="#dom-textmetrics-actualboundingboxascent">actualBoundingBoxAscent</a></code> attribute (and
    its corresponding attribute for the descent) are useful when drawing a bounding box around
    specific text.</p>

   </dd>

   <dt><dfn id="dom-textmetrics-fontboundingboxdescent" title="dom-textmetrics-fontBoundingBoxDescent"><code>fontBoundingBoxDescent</code></dfn> attribute</dt>

   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the bottom of the lowest
   bounding rectangle of all the fonts used to render the text, in CSS pixels; positive numbers
   indicating a distance going down from the given baseline.</p></dd>

   <dt><dfn id="dom-textmetrics-actualboundingboxascent" title="dom-textmetrics-actualBoundingBoxAscent"><code>actualBoundingBoxAscent</code></dfn> attribute</dt>

   <dd>

    <p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the top of the bounding
    rectangle of the given text, in CSS pixels; positive numbers indicating a distance going up from
    the given baseline.

    </p><p class="note">This number can vary greatly based on the input text, even if the first font
    specified covers all the characters in the input. For example, the <code title="dom-textmetrics-actualBoundingBoxAscent"><a href="#dom-textmetrics-actualboundingboxascent">actualBoundingBoxAscent</a></code> of a lowercase
    "o" from an alphabetic baseline would be less than that of an uppercase "F". The value can
    easily be negative; for example, the distance from the top of the em box (<code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> value "<code title="dom-context-2d-textBaseline-top"><a href="#dom-context-2d-textbaseline-top">top</a></code>") to the top of the bounding rectangle when
    the given text is just a single comma "<code title="">,</code>" would likely (unless the font is
    quite unusual) be negative.</p>

   </dd>

   <dt><dfn id="dom-textmetrics-actualboundingboxdescent" title="dom-textmetrics-actualBoundingBoxDescent"><code>actualBoundingBoxDescent</code></dfn> attribute</dt>

   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the bottom of the bounding
   rectangle of the given text, in CSS pixels; positive numbers indicating a distance going down
   from the given baseline.</p></dd>

   <dt><dfn id="dom-textmetrics-emheightascent" title="dom-textmetrics-emHeightAscent"><code>emHeightAscent</code></dfn> attribute</dt>

<!--CLEANUP-->
   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the highest top of the em squares in
   the line box, in CSS pixels; positive numbers indicating that the given baseline is below the top
   of that em square (so this value will usually be positive). Zero if the given baseline is the top
   of that em square; half the font size if the given baseline is the middle of that em
   square.</p></dd>

   <dt><dfn id="dom-textmetrics-emheightdescent" title="dom-textmetrics-emHeightDescent"><code>emHeightDescent</code></dfn> attribute</dt>

<!--CLEANUP-->
   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the lowest bottom of the em squares
   in the line box, in CSS pixels; positive numbers indicating that the given baseline is below the
   bottom of that em square (so this value will usually be negative). (Zero if the given baseline is
   the top of that em square.)</p></dd>

   <dt><dfn id="dom-textmetrics-hangingbaseline" title="dom-textmetrics-hangingBaseline"><code>hangingBaseline</code></dfn> attribute</dt>

   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the hanging baseline of the
   line box, in CSS pixels; positive numbers indicating that the given baseline is below the hanging
   baseline. (Zero if the given baseline is the hanging baseline.)</p></dd>

   <dt><dfn id="dom-textmetrics-alphabeticbaseline" title="dom-textmetrics-alphabeticBaseline"><code>alphabeticBaseline</code></dfn> attribute</dt>

   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the alphabetic baseline of
   the line box, in CSS pixels; positive numbers indicating that the given baseline is below the
   alphabetic baseline. (Zero if the given baseline is the alphabetic baseline.)</p></dd>

   <dt><dfn id="dom-textmetrics-ideographicbaseline" title="dom-textmetrics-ideographicBaseline"><code>ideographicBaseline</code></dfn> attribute</dt>

   <dd><p>The distance from the horizontal line indicated by the <code title="dom-context-2d-textBaseline"><a href="#dom-context-2d-textbaseline">textBaseline</a></code> attribute to the ideographic baseline of
   the line box, in CSS pixels; positive numbers indicating that the given baseline is below the
   ideographic baseline. (Zero if the given baseline is the ideographic baseline.)</p></dd>

  </dl><p class="note">Glyphs rendered using <code title="dom-context-2d-fillText"><a href="#dom-context-2d-filltext">fillText()</a></code> and
  <code title="dom-context-2d-strokeText"><a href="#dom-context-2d-stroketext">strokeText()</a></code> can spill out of the box given by the
  font size (the em square size) and the width returned by <code title="dom-context-2d-measureText"><a href="#dom-context-2d-measuretext">measureText()</a></code> (the text width). Authors are encouraged
  to use the bounding box values described above if this is an issue.</p>

  <p class="note">A future version of the 2D context API may provide a way to render fragments of
  documents, rendered using CSS, straight to the canvas. This would be provided in preference to a
  dedicated way of doing multiline layout.</p>



  <h6 id="drawing-paths-to-the-canvas"><span class="secno">4.12.4.2.13 </span>Drawing paths to the canvas</h6>

  <p>The context always has a <dfn id="current-default-path">current default path</dfn>. There is only one <a href="#current-default-path">current
  default path</a>, it is not part of the <a href="#drawing-state">drawing state</a>. The <a href="#current-default-path">current default
  path</a> is a <a href="#concept-path" title="concept-path">path</a>, as described above.</p>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-beginPath"><a href="#dom-context-2d-beginpath">beginPath</a></code>()</dt>

   <dd>

    <p>Resets the <a href="#current-default-path">current default path</a>.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-fill"><a href="#dom-context-2d-fill">fill</a></code>( [ <var title="">fillRule</var> ] )</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-fill"><a href="#dom-context-2d-fill">fill</a></code>(<var title="">path</var> [, <var title="">fillRule</var> ] )</dt>

   <dd>

    <p>Fills the subpaths of the <a href="#current-default-path">current default path</a> or the given path with the
    current fill style, obeying the given fill rule.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-stroke"><a href="#dom-context-2d-stroke">stroke</a></code>()</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-stroke"><a href="#dom-context-2d-stroke">stroke</a></code>(<var title="">path</var>)</dt>

   <dd>

    <p>Strokes the subpaths of the <a href="#current-default-path">current default path</a> or the given path with the
    current stroke style.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-drawSystemFocusRing"><a href="#dom-context-2d-drawsystemfocusring">drawSystemFocusRing</a></code>(<var title="">element</var>)</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-drawSystemFocusRing"><a href="#dom-context-2d-drawsystemfocusring">drawSystemFocusRing</a></code>(<var title="">path</var>, <var title="">element</var>)</dt>

   <dd>

<!--CLEANUP-->
    <p>If the given element is <a href="editing.html#focused">focused</a>, draws a focus ring around the <a href="#current-default-path">current default
    path</a> or the given path, following the platform conventions for focus rings.</p>

   </dd>


   <dt><var title="">shouldDraw</var> = <var title="">context</var> . <code title="dom-context-2d-drawCustomFocusRing"><a href="#dom-context-2d-drawcustomfocusring">drawCustomFocusRing</a></code>(<var title="">element</var>)</dt>
   <dt><var title="">shouldDraw</var> = <var title="">context</var> . <code title="dom-context-2d-drawCustomFocusRing"><a href="#dom-context-2d-drawcustomfocusring">drawCustomFocusRing</a></code>(<var title="">path</var>, <var title="">element</var>)</dt>

   <dd>

<!--CLEANUP-->
    <p>If the given element is <a href="editing.html#focused">focused</a>, and the user has configured his system to draw focus rings
    in a particular manner (for example, high contrast focus rings), draws a focus ring around the
    <a href="#current-default-path">current default path</a> or the given path and returns false.</p>

    <p>Otherwise, returns true if the given element is <a href="editing.html#focused">focused</a>, and false otherwise. This can thus
    be used to determine when to draw a focus ring (see <a href="#drawCustomFocusRingExample">the
    example</a> below).</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-scrollPathIntoView"><a href="#dom-context-2d-scrollpathintoview">scrollPathIntoView</a></code>()</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-scrollPathIntoView"><a href="#dom-context-2d-scrollpathintoview">scrollPathIntoView</a></code>(<var title="">path</var>)</dt>

   <dd>

    <p>Scrolls the <a href="#current-default-path">current default path</a> or the given path into view. This is especially
    useful on devices with small screens, where the whole canvas might not be visible at once.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-clip"><a href="#dom-context-2d-clip">clip</a></code>( [ <var title="">fillRule</var> ] )</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-clip"><a href="#dom-context-2d-clip">clip</a></code>(<var title="">path</var> [, <var title="">fillRule</var> ] )</dt>

   <dd>

    <p>Further constrains the clipping region to the <a href="#current-default-path">current default path</a> or the given
    path, using the given fill rule to determine what points are in the path.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-resetClip"><a href="#dom-context-2d-resetclip">resetClip</a></code>()</dt>

   <dd>

    <p>Unconstrains the clipping region.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-isPointInPath"><a href="#dom-context-2d-ispointinpath">isPointInPath</a></code>(<var title="">x</var>, <var title="">y</var> [, <var title="">fillRule</var> ] )</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-isPointInPath"><a href="#dom-context-2d-ispointinpath">isPointInPath</a></code>(<var title="">path</var>, <var title="">x</var>, <var title="">y</var> [, <var title="">fillRule</var> ] )</dt>

   <dd>

    <p>Returns true if the given point is in the <a href="#current-default-path">current default path</a> or the given
    path, using the given fill rule to determine what points are in the path.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-isPointInStroke"><a href="#dom-context-2d-ispointinstroke">isPointInStroke</a></code>(<var title="">x</var>, <var title="">y</var>)</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-isPointInStroke"><a href="#dom-context-2d-ispointinstroke">isPointInStroke</a></code>(<var title="">path</var>, <var title="">x</var>, <var title="">y</var>)</dt>

   <dd>

    <p>Returns true if the given point would be in the region covered by the stroke of the
    <a href="#current-default-path">current default path</a> or the given path, given the current stroke style.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-context-2d-beginpath" title="dom-context-2d-beginPath"><code>beginPath()</code></dfn> method must empty the
  list of subpaths in the context's <a href="#current-default-path">current default path</a> so that the it once again has
  zero subpaths.</p>

  <p>Where the following method definitions use the term <i>intended path</i>, it means the
  <code><a href="#path2d">Path2D</a></code> argument, if one was provided, or the <a href="#current-default-path">current default path</a>
  otherwise.</p>

  <p>When the intended path is a <code><a href="#path2d">Path2D</a></code> object, the coordinates and lines of its subpaths
  must be transformed according to the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#transformations" title="dom-context-2d-transformation">current transformation matrix</a> when used by these
  methods (without affecting the <code><a href="#path2d">Path2D</a></code> object itself). When the intended path is the
  <a href="#current-default-path">current default path</a>, it is not affected by the transform. (This is because
  transformations already affect the <a href="#current-default-path">current default path</a> when it is constructed, so
  applying it when it is painted as well would result in a double transformation.)</p>

  <p>The <dfn id="dom-context-2d-fill" title="dom-context-2d-fill"><code>fill()</code></dfn> method must fill all the
  subpaths of the intended path, using <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code>, and
  using the <a href="#fill-rule">fill rule</a> indicated by the <var title="">fillRule</var> argument. Open
  subpaths must be implicitly closed when being filled (without affecting the actual subpaths).</p>

  <p>The <dfn id="dom-context-2d-stroke" title="dom-context-2d-stroke"><code>stroke()</code></dfn> method must <a href="#trace-a-path" title="trace a path">trace</a> the intended path, using the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object for the line styles, and then fill the resulting path
  using the <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> attribute, using the <a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">non-zero winding rule</a>.</p>

  <p class="note">As a result of how the algorithm to <a href="#trace-a-path">trace a path</a> is defined,
  overlapping parts of the paths in one stroke operation are treated as if their union was what was
  painted.</p>

  <p class="note">The stroke <em><a href="semantics.html#the-style-element">style</a></em> is affected by the transformation during painting, even
  if the intended path is the <a href="#current-default-path">current default path</a>.</p>

  <p>Paths, when filled or stroked, must be painted without affecting the <a href="#current-default-path">current default
  path</a> or any <code><a href="#path2d">Path2D</a></code> objects, and must be subject to <a href="#shadows" title="shadows">shadow
  effects</a>, <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, the <a href="#clipping-region">clipping
  region</a>, and <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition
  operators</a>. (The effect of transformations is described above and varies based on which path
  is being used.)</p>

  <hr><p id="dom-context-2d-drawosfocusring">The <dfn id="dom-context-2d-drawsystemfocusring" title="dom-context-2d-drawSystemFocusRing"><code>drawSystemFocusRing(<var title="">element</var>)</code></dfn> method, when invoked, must run the following steps:</p>

  <ol><li><p>If <var title="">element</var> is not <a href="editing.html#focused">focused</a> or is not a descendant of the element with
   whose context the method is associated, then abort these steps.</p></li>

   <li>

    <p>If the user has requested the use of particular focus rings (e.g. high-contrast focus rings),
    or if the <var title="">element</var> would have a focus ring drawn around it, then draw a focus
    ring of the appropriate style along the intended path, following platform conventions.</p>

    <p class="note">Some platforms only draw focus rings around elements that have been focused from
    the keyboard, and not those focused from the mouse. Other platforms simply don't draw focus
    rings around some elements at all unless relevant accessibility features are enabled. This API
    is intended to follow these conventions. User agents that implement distinctions based on the
    manner in which the element was focused are encouraged to classify focus driven by the <code title="dom-focus"><a href="editing.html#dom-focus">focus()</a></code> method based on the kind of user interaction event from which
    the call was triggered (if any).</p>

    <p>The focus ring should not be subject to the <a href="#shadows" title="shadows">shadow effects</a>, the
    <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, the <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition operators</a>, the <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code> attribute, the <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> attribute, or any of the
    <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> members, but <em>should</em> be subject to the <a href="#clipping-region">clipping
    region</a>. (The effect of transformations is described above and varies based on which path
    is being used.)</p>

   </li>

   <li>

    <p>Optionally, run the appropriate step from the following list:</p>

    <dl><dt>If the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a></dt>

     <dd><p><a href="#inform">Inform the user</a> that the focus is at the location given by the
     intended path. User agents may wait until the next time the <a href="webappapis.html#event-loop">event loop</a> reaches its
     <i>update the rendering</i> step to optionally inform the user.</p></dd>

     <dt>Otherwise</dt>

     <dd><p>Add instructions to the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#list-of-pending-interface-actions">list of pending interface
     actions</a> that <a href="#inform">inform the user</a> that the focus is at the location of
     the bitmap given by the intended path.</p></dd>

    </dl></li>

  </ol><p>The <dfn id="dom-context-2d-drawcustomfocusring" title="dom-context-2d-drawCustomFocusRing"><code>drawCustomFocusRing(<var title="">element</var>)</code></dfn> method, when invoked, must run the following steps:</p>

  <ol><li><p>If <var title="">element</var> is not <a href="editing.html#focused">focused</a> or is not a descendant of the element with
   whose context the method is associated, then return false and abort these steps.</p></li>

   <li><p>Let <var title="">result</var> be true.</p></li>

   <li>

    <p>If the user has requested the use of particular focus rings (e.g. high-contrast focus rings),
    then draw a focus ring of the appropriate style along the intended path, and set <var title="">result</var> to false.</p>

    <p>The focus ring should not be subject to the <a href="#shadows" title="shadows">shadow effects</a>, the
    <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, the <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition operators</a>, the <code title="dom-context-2d-fillStyle"><a href="#dom-context-2d-fillstyle">fillStyle</a></code> attribute, the <code title="dom-context-2d-strokeStyle"><a href="#dom-context-2d-strokestyle">strokeStyle</a></code> attribute, or any of the
    <code><a href="#canvasdrawingstyles">CanvasDrawingStyles</a></code> members, but <em>should</em> be subject to the <a href="#clipping-region">clipping
    region</a>. (The effect of transformations is described above and varies based on which path
    is being used.)</p>

   </li>

   <li>

    <p>Optionally, run the appropriate step from the following list:</p>

    <dl><dt>If the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a></dt>

     <dd><p><a href="#inform">Inform the user</a> that the focus is at the location given by the
     intended path. The user agent may wait until the next time the <a href="webappapis.html#event-loop">event loop</a> reaches
     its <i>update the rendering</i> step to optionally inform the user.</p></dd>

     <dt>Otherwise</dt>

     <dd><p>Add instructions to the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#list-of-pending-interface-actions">list of pending interface
     actions</a> that <a href="#inform">inform the user</a> that the focus is at the location of
     the bitmap given by the intended path.</p></dd>

    </dl></li>

   <li><p>Return <var title="">result</var>.</p></li>

  </ol><p>User agents should not implicitly close open subpaths in the intended path when drawing the
  focus ring.</p>

  <p class="note">This might be a moot point, however. For example, if the focus ring is drawn as an
  axis-aligned bounding rectangle around the points in the intended path, then whether the subpaths
  are closed or not has no effect. This specification intentionally does not specify precisely how
  focus rings are to be drawn: user agents are expected to honor their platform's native
  conventions.</p>

  <hr><p>The <dfn id="dom-context-2d-scrollpathintoview" title="dom-context-2d-scrollPathIntoView"><code>scrollPathIntoView()</code></dfn>
  method, when invoked, if the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> is <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a>, must run the following steps; and otherwise, must add
  instructions to the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#list-of-pending-interface-actions">list of pending interface actions</a>
  that run the following steps:</p>

  <ol><li><p>Let <var title="">the specified rectangle</var> be the rectangle of the bounding box of
   the intended path.</p></li>

   <li><p>Let <var title="">notional child</var> be a hypothetical element that is a rendered child
   of the <code><a href="#the-canvas-element">canvas</a></code> element whose dimensions are those of <var title="">the specified
   rectangle</var>.</p></li>

   <li><p><a href="infrastructure.html#scroll-an-element-into-view" title="scroll an element into view">Scroll <var title="">notional child</var> into
   view</a> with the <var title="">align to top flag</var> set.</p>

   </li><li><p>Optionally, <a href="#inform">inform the user</a> that the caret or selection (or both)
   cover <var title="">the specified rectangle</var> of the canvas. If the
   <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#concept-canvas-context-bitmap-mode" title="concept-canvas-context-bitmap-mode">context bitmap mode</a> was <a href="#concept-canvas-fixed" title="concept-canvas-fixed">fixed</a> when the method was invoked, the user agent may wait
   until the next time the <a href="webappapis.html#event-loop">event loop</a> reaches its <i>update the rendering</i> step to
   optionally inform the user.</p></li>

  </ol><p id="inform">"Inform the user", as used in this section, does not imply any persistent state
  change. It could mean, for instance, calling a system accessibility API to notify assistive
  technologies such as magnification tools so that the user's magnifier moves to the given area of
  the canvas. However, it does not associate the path with the element, or provide a region for
  tactile feedback, etc. To persistently associate a region with information provided to
  accessibility tools, use the <code title="dom-context-2d-addHitRegion"><a href="#dom-context-2d-addhitregion">addHitRegion()</a></code>
  API.</p>

  <hr><p>The <dfn id="dom-context-2d-clip" title="dom-context-2d-clip"><code>clip()</code></dfn> method must create a new
  <dfn id="clipping-region">clipping region</dfn> by calculating the intersection of the current clipping region and the
  area described by the intended path, using the <a href="#fill-rule">fill rule</a> indicated by the <var title="">fillRule</var> argument. Open subpaths must be implicitly closed when computing the
  clipping region, without affecting the actual subpaths. The new clipping region replaces the
  current clipping region.</p>

  <p>When the context is initialized, the clipping region must be set to the largest infinite
  surface (i.e. by default, no clipping occurs).</p>

  <!-- v6
   Jordan OSETE suggests:
    * support ways of extending the clipping region (union instead of intersection)
       - also "add", "subtract", "replace", "intersect" and "xor"
       - maybe just support creating unions, intersections, and other -ions of paths
  -->

  <p>The <dfn id="dom-context-2d-resetclip" title="dom-context-2d-resetClip"><code>resetClip()</code></dfn> method must create a
  new <a href="#clipping-region">clipping region</a> that is the largest infinite surface. The new clipping region
  replaces the current clipping region.</p>

  <hr><p>The <dfn id="dom-context-2d-ispointinpath" title="dom-context-2d-isPointInPath"><code>isPointInPath()</code></dfn> method must
  return true if the point given by the <var title="">x</var> and <var title="">y</var> coordinates
  passed to the method, when treated as coordinates in the canvas coordinate space unaffected by the
  current transformation, is inside the intended path as determined by the <a href="#fill-rule">fill rule</a>
  indicated by the <var title="">fillRule</var> argument; and must return false otherwise. Open
  subpaths must be implicitly closed when computing the area inside the path, without affecting the
  actual subpaths. Points on the path itself must be considered to be inside the path. If either of
  the arguments is infinite or NaN, then the method must return false.</p>

  <hr><p>The <dfn id="dom-context-2d-ispointinstroke" title="dom-context-2d-isPointInStroke"><code>isPointInStroke()</code></dfn> method
  must return true if the point given by the <var title="">x</var> and <var title="">y</var>
  coordinates passed to the method, when treated as coordinates in the canvas coordinate space
  unaffected by the current transformation, is inside the path that results from <a href="#trace-a-path" title="trace
  a path">tracing</a> the intended path, using the <a href="#dom-context-2d-fillrule-nonzero" title="dom-context-2d-fillRule-nonzero">non-zero winding rule</a>, and using the
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object for the line styles; and must return false otherwise.
  Points on the resulting path must be considered to be inside the path. If either of the arguments
  is infinite or NaN, then the method must return false.</p>

  <hr></div>

  <div class="example" id="drawCustomFocusRingExample">

   <p>This <code><a href="#the-canvas-element">canvas</a></code> element has a couple of checkboxes. The path-related commands are
   highlighted:</p>

   <pre>&lt;canvas height=400 width=750&gt;
 &lt;label&gt;&lt;input type=checkbox id=showA&gt; Show As&lt;/label&gt;
 &lt;label&gt;&lt;input type=checkbox id=showB&gt; Show Bs&lt;/label&gt;
 &lt;!-- ... --&gt;
&lt;/canvas&gt;
&lt;script&gt;
 function drawCheckbox(context, element, x, y, paint) {
   context.save();
   context.font = '10px sans-serif';
   context.textAlign = 'left';
   context.textBaseline = 'middle';
   var metrics = context.measureText(element.labels[0].textContent);
   if (paint) {
<strong>     context.beginPath();
     context.strokeStyle = 'black';
     context.rect(x-5, y-5, 10, 10);
     context.stroke();
     context.addHitRegion({ control: element });
</strong>     if (element.checked) {
<strong>       context.fillStyle = 'black';
       context.fill();
</strong>     }
     context.fillText(element.labels[0].textContent, x+5, y);
   }
<strong>   context.beginPath();
   context.rect(x-7, y-7, 12 + metrics.width+2, 14);
   if (paint &amp;&amp; context.drawCustomFocusRing(element)) {
     context.strokeStyle = 'silver';
     context.stroke();
   }
</strong>   context.restore();
 }
 function drawBase() { /* ... */ }
 function drawAs() { /* ... */ }
 function drawBs() { /* ... */ }
 function redraw() {
   var canvas = document.getElementsByTagName('canvas')[0];
   var context = canvas.getContext('2d');
   context.clearRect(0, 0, canvas.width, canvas.height);
   drawCheckbox(context, document.getElementById('showA'), 20, 40, true);
   drawCheckbox(context, document.getElementById('showB'), 20, 60, true);
   drawBase();
   if (document.getElementById('showA').checked)
     drawAs();
   if (document.getElementById('showB').checked)
     drawBs();
 }
 function processClick(event) {
   var canvas = document.getElementsByTagName('canvas')[0];
   var context = canvas.getContext('2d');
   var x = event.clientX;
   var y = event.clientY;
   var node = event.target;
   while (node) {
     x -= node.offsetLeft - node.scrollLeft;
     y -= node.offsetTop - node.scrollTop;
     node = node.offsetParent;
   }
   drawCheckbox(context, document.getElementById('showA'), 20, 40, false);
   if (<strong>context.isPointInPath(x, y)</strong>)
     document.getElementById('showA').checked = !(document.getElementById('showA').checked);
   drawCheckbox(context, document.getElementById('showB'), 20, 60, false);
   if (<strong>context.isPointInPath(x, y)</strong>)
     document.getElementById('showB').checked = !(document.getElementById('showB').checked);
   redraw();
 }
 document.getElementsByTagName('canvas')[0].addEventListener('focus', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('blur', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('change', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('click', processClick, false);
 redraw();
&lt;/script&gt;</pre>
<!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/340 -->

  </div>



  <h6 id="drawing-images"><span class="secno">4.12.4.2.14 </span>Drawing images</h6>

  <p>To draw images, the <dfn id="dom-context-2d-drawimage" title="dom-context-2d-drawImage"><code>drawImage</code></dfn> method
  can be used.</p>

  <div class="impl">

  <p>This method can be invoked with three different sets of arguments:</p>

  <ul class="brief"><li><code title="">drawImage(<var title="">image</var>, <var title="">dx</var>, <var title="">dy</var>)</code>
   </li><li><code title="">drawImage(<var title="">image</var>, <var title="">dx</var>, <var title="">dy</var>, <var title="">dw</var>, <var title="">dh</var>)</code>
   </li><li><code title="">drawImage(<var title="">image</var>, <var title="">sx</var>, <var title="">sy</var>, <var title="">sw</var>, <var title="">sh</var>, <var title="">dx</var>, <var title="">dy</var>, <var title="">dw</var>, <var title="">dh</var>)</code>
  </li></ul></div>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage</a></code>(<var title="">image</var>, <var title="">dx</var>, <var title="">dy</var>)</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage</a></code>(<var title="">image</var>, <var title="">dx</var>, <var title="">dy</var>, <var title="">dw</var>, <var title="">dh</var>)</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage</a></code>(<var title="">image</var>, <var title="">sx</var>, <var title="">sy</var>, <var title="">sw</var>, <var title="">sh</var>, <var title="">dx</var>, <var title="">dy</var>, <var title="">dw</var>, <var title="">dh</var>)</dt>

   <dd>

    <p>Draws the given image onto the canvas. The arguments are
    interpreted as follows:</p>

    <p><img src="http://images.whatwg.org/drawImage.png" width="356" alt="The sx and sy parameters give the x and y coordinates of the source rectangle; the sw and sh arguments give the width and height of the source rectangle; the dx and dy give the x and y coordinates of the destination rectangle; and the dw and dh arguments give the width and height of the destination rectangle." height="356"></p>

    <p>If the image isn't yet fully decoded, then nothing is drawn. If the image is a canvas with no
    data, throws an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.</p>

   </dd>

  </dl><div class="impl">

  <p>When the <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage()</a></code> method is invoked, the user
  agent must run the following steps:</p>

  <ol><li><p><a href="#check-the-usability-of-the-image-argument">Check the usability of the <var title="">image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then abort these steps without drawing anything.
   Otherwise it returns <i>good</i>; continue with these steps.</p></li>

   <li>

    <p>Establish the source and destination rectangles as follows:</p>

    <p>If not specified, the <var title="">dw</var> and <var title="">dh</var> arguments must
    default to the values of <var title="">sw</var> and <var title="">sh</var>, interpreted such
    that one CSS pixel in the image is treated as one unit in the <a href="#scratch-bitmap">scratch bitmap</a>'s
    coordinate space. If the <var title="">sx</var>, <var title="">sy</var>, <var title="">sw</var>,
    and <var title="">sh</var> arguments are omitted, they must default to 0, 0, the image's
    intrinsic width in image pixels, and the image's intrinsic height in image pixels, respectively.
    If the image has no intrinsic dimensions, the <i>concrete object size</i> must be used instead,
    as determined using the CSS "<a href="http://dev.w3.org/csswg/css3-images/#default-sizing">Concrete Object Size Resolution</a>"
    algorithm, with the <i>specified size</i> having neither a definite width nor height, nor any
    additional contraints, the object's intrinsic properties being those of the <var title="">image</var> argument, and the <i><a href="infrastructure.html#default-object-size">default object size</a></i> being the size of the
    <a href="#scratch-bitmap">scratch bitmap</a>. <a href="references.html#refsCSSIMAGES">[CSSIMAGES]</a></p>

    <p>The source rectangle is the rectangle whose corners are the four points (<var title="">sx</var>, <var title="">sy</var>), (<span title=""><var title="">sx</var>+<var title="">sw</var></span>, <var title="">sy</var>), (<span title=""><var title="">sx</var>+<var title="">sw</var></span>, <span title=""><var title="">sy</var>+<var title="">sh</var></span>),
    (<var title="">sx</var>, <span title=""><var title="">sy</var>+<var title="">sh</var></span>).</p>

    <p>The destination rectangle is the rectangle whose corners are the four points (<var title="">dx</var>, <var title="">dy</var>), (<span title=""><var title="">dx</var>+<var title="">dw</var></span>, <var title="">dy</var>), (<span title=""><var title="">dx</var>+<var title="">dw</var></span>, <span title=""><var title="">dy</var>+<var title="">dh</var></span>),
    (<var title="">dx</var>, <span title=""><var title="">dy</var>+<var title="">dh</var></span>).</p>

    <p>When the source rectangle is outside the source image, the source rectangle must be clipped
    to the source image and the destination rectangle must be clipped in the same proportion.</p>

    <p class="note">When the destination rectangle is outside the destination image (the
    <a href="#scratch-bitmap">scratch bitmap</a>), the pixels that land outside the <a href="#scratch-bitmap">scratch bitmap</a> are
    discarded, as if the destination was an infinite canvas whose rendering was clipped to the
    dimensions of the <a href="#scratch-bitmap">scratch bitmap</a>.</p>

   </li>

   <li><p>If one of the <var title="">sw</var> or <var title="">sh</var> arguments is zero, abort
   these steps. Nothing is painted.</p></li>

   <li>

    <p>Paint the region of the <var title="">image</var> argument specified by the source rectangle
    on the region of the rendering context's <a href="#scratch-bitmap">scratch bitmap</a> specified by the
    destination rectangle, after applying the <a href="#transformations" title="dom-context-2d-transformation">current
    transformation matrix</a> to the destination rectangle.</p>

    <p>The image data must be processed in the original direction, even if the dimensions given are
    negative. <!-- note: that last sentence has several times been needed to correct people who
    suggested that 5,5,-2,-2 was different than 3,3,2,2 --></p>

    <p>When scaling up, if the <code title="dom-context-2d-imageSmoothingEnabled"><a href="#dom-context-2d-imagesmoothingenabled">imageSmoothingEnabled</a></code> attribute is set to
    true, the user agent should attempt to apply a smoothing algorithm to the image data when it is
    scaled. Otherwise, the image must be rendered using nearest-neighbor interpolation.</p>

    <p class="note">This specification does not define the precise algorithm to use when scaling an
    image down, or when scaling an image up when the <code title="dom-context-2d-imageSmoothingEnabled"><a href="#dom-context-2d-imagesmoothingenabled">imageSmoothingEnabled</a></code> attribute is set to
    true.</p>

    <p class="note">When a <code><a href="#the-canvas-element">canvas</a></code> or <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is
    drawn onto itself, the <a href="#drawing-model">drawing model</a> requires the source to be copied before the
    image is drawn, so it is possible to copy parts of a <code><a href="#the-canvas-element">canvas</a></code> or <a href="#scratch-bitmap">scratch
    bitmap</a> onto overlapping parts of itself.</p>

    <p>If the original image data is a bitmap image, the value painted at a point in the destination
    rectangle is computed by filtering the original image data. The user agent may use any filtering
    algorithm (for example bilinear interpolation or nearest-neighbor). When the filtering algorithm
    requires a pixel value from outside the original image data, it must instead use the value from
    the nearest edge pixel. (That is, the filter uses 'clamp-to-edge' behavior.) When the filtering
    algorithm requires a pixel value from outside the source rectangle but inside the original image
    data, then the value from the original image data must be used.</p>
    <!-- see CORE-32111 and:
         http://krijnhoetmer.nl/irc-logs/whatwg/20100818#l-737
         http://www.w3.org/Bugs/Public/show_bug.cgi?id=10799#c11
    -->
    <!-- createPattern() has a similar paragraph with different rules -->

    <p class="note">Thus, scaling an image in parts or in whole will have the same effect. This does
    mean that when sprites coming from a single sprite sheet are to be scaled, adjacent images in
    the sprite sheet can interfere. This can be avoided by ensuring each sprite in the sheet is
    surrounded by a border of transparent black, or by copying sprites to be scaled into temporary
    <code><a href="#the-canvas-element">canvas</a></code> elements and drawing the scaled sprites from there.</p>

    <p>Images are painted without affecting the current path, and are subject to <a href="#shadows" title="shadows">shadow effects</a>, <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global
    alpha</a>, the <a href="#clipping-region">clipping region</a>, and <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition operators</a>.</p>

   </li>

<!--ADD-TOPIC:Security-->
   <li><p>If <a href="#the-image-argument-is-not-origin-clean">the <var title="">image argument</var> is not origin-clean</a>, set the
   <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> flag
   to false.</p></li>
<!--REMOVE-TOPIC:Security-->

  </ol></div>


  <h6 id="hit-regions"><span class="secno">4.12.4.2.15 </span>Hit regions</h6>

  <p>A <dfn id="hit-region-list">hit region list</dfn> is a list of <a href="#hit-region" title="hit region">hit regions</a> for a
  bitmap.</p>

  <p>Each <dfn id="hit-region">hit region</dfn> consists of the following information:</p>

  <ul><li><p>A <dfn id="hit-region's-set-of-pixels" title="hit region's set of pixels">set of pixels</dfn> on the bitmap for which this
   region is responsible.</p></li>

   <li><p>A <dfn id="hit-region's-bounding-circumference" title="hit region's bounding circumference">bounding circumference</dfn> on the
   bitmap that surrounds the <a href="#hit-region's-set-of-pixels">hit region's set of pixels</a> as they stood when it was
   created.</p></li>

   <li><p>Optionally, a non-empty string representing an <dfn id="hit-region's-id" title="hit region's ID">ID</dfn> for
   distinguishing the region from others.</p></li> <!-- cannot be the empty string -->

   <li><p>Optionally, a reference to another region that acts as the <dfn id="hit-region's-parent" title="hit region's
   parent">parent</dfn> for this one.</p></li>

   <li><p>A count of regions that have this one as their <a href="#hit-region's-parent" title="hit region's
   parent">parent</a>, known as the <dfn id="hit-region's-child-count">hit region's child count</dfn>.</p></li>

   <li><p>A <dfn id="hit-region's-cursor-specification" title="hit region's cursor specification">cursor specification</dfn>, in the form
   of either a CSS cursor value, or the string "<code title="">inherit</code>" meaning that the
   cursor of the <a href="#hit-region's-parent">hit region's parent</a>, if any, or of the <code><a href="#the-canvas-element">canvas</a></code> element, if
   not, is to be used instead.</p></li>

   <li>

    <p>Optionally, either a <a href="#hit-region's-control" title="hit region's control">control</a>, or an <a href="#hit-region's-unbacked-region-description" title="hit region's unbacked region description">unbacked region description</a>.</p>

    <p>A <dfn id="hit-region's-control" title="hit region's control">control</dfn> is just a reference to an
    <code><a href="infrastructure.html#element">Element</a></code> node, to which, in certain conditions, the user agent will route events,
    and from which the user agent will determine the state of the hit region for the purposes of
    accessibility tools. (The control is ignored when it is not a descendant of the
    <code><a href="#the-canvas-element">canvas</a></code> element.)</p>

    <p>An <dfn id="hit-region's-unbacked-region-description" title="hit region's unbacked region description">unbacked region description</dfn>
    consists of the following:</p>

    <ul class="brief"><li><p>Optionally, a <dfn id="hit-region's-label" title="hit region's label">label</dfn>.</p>

     </li><li><p>An <dfn id="hit-region's-aria-role" title="hit region's ARIA role">ARIA role</dfn>, which, if the <a href="#hit-region's-unbacked-region-description" title="hit
     region's unbacked region description">unbacked region description</a> also has a label,
     could be the empty string.</p></li>

    </ul></li>

  </ul><dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-addHitRegion"><a href="#dom-context-2d-addhitregion">addHitRegion</a></code>(<var title="">options</var>)</dt>

   <dd>

    <p>Adds a hit region to the bitmap. The argument is an object with the following members:</p>

    <dl><dt><dfn id="dom-hitregionoptions-path" title="dom-HitRegionOptions-path"><code>path</code></dfn> (default null)</dt>

     <dd>A <code><a href="#path2d">Path2D</a></code> object that describes the pixels that form part of the region. If this
     member is not provided or is set to null, the <a href="#current-default-path">current default path</a> is used
     instead.</dd>

     <dt><dfn id="dom-hitregionoptions-fillrule" title="dom-HitRegionOptions-fillRule"><code>fillRule</code></dfn> (default "<code title="dom-context-2d-fillRule-nonzero"><a href="#dom-context-2d-fillrule-nonzero">nonzero</a></code>")</dt>

     <dd>The <a href="#fill-rule">fill rule</a> to use when determining which pixels are inside the path.</dd>

<!--
     <dt><dfn title="dom-HitRegionOptions-transform"><code>transform</code></dfn> (default null)</dt>

     <dd>An <code>SVGMatrix</code> object that describes a
     transformation to apply to the path described by the <code
     title="dom-HitRegionOptions-path">path</code> member.</dd>
-->

     <dt><dfn id="dom-hitregionoptions-id" title="dom-HitRegionOptions-id"><code>id</code></dfn> (default empty string) <!-- empty string is treated as null internally --></dt>

     <dd>The ID to use for this region. This is used in <code><a href="infrastructure.html#mouseevent">MouseEvent</a></code> events on the
     <code><a href="#the-canvas-element">canvas</a></code> (<code title="dom-MouseEvent-region"><a href="#dom-mouseevent-region">event.region</a></code>) and as a way to
     reference this region in later calls to <code title="dom-context-2d-addHitRegion"><a href="#dom-context-2d-addhitregion">addHitRegion()</a></code>.</dd>

     <dt><dfn id="dom-hitregionoptions-parentid" title="dom-HitRegionOptions-parentID"><code>parentID</code></dfn> (default null)</dt>

     <dd>The ID of the parent region, for purposes of navigation by accessibility tools and for
     cursor fallback.</dd>

     <dt><dfn id="dom-hitregionoptions-cursor" title="dom-HitRegionOptions-cursor"><code>cursor</code></dfn> (default "<code title="">inherit</code>")</dt>

     <dd>The cursor to use when the mouse is over this region. The value "<code title="">inherit</code>" means to use the cursor for the parent region (as specified by the
     <code title="dom-HitRegionOptions-parentID"><a href="#dom-hitregionoptions-parentid">parentID</a></code> member), if any, or to use the
     <code><a href="#the-canvas-element">canvas</a></code> element's cursor if the region has no parent.</dd>

     <dt><dfn id="dom-hitregionoptions-control" title="dom-HitRegionOptions-control"><code>control</code></dfn> (default null)</dt>

     <dd>An element (that is a descendant of the <code><a href="#the-canvas-element">canvas</a></code>) to which events are to be
     routed, and which accessibility tools are to use as a surrogate for describing and interacting
     with this region.</dd>

     <dt><dfn id="dom-hitregionoptions-label" title="dom-HitRegionOptions-label"><code>label</code></dfn> (default null)</dt>

     <dd>A text label for accessibility tools to use as a description of this region, if there is no
     control.</dd>

     <dt><dfn id="dom-hitregionoptions-role" title="dom-HitRegionOptions-role"><code>role</code></dfn> (default null)</dt>

     <dd>An ARIA role for accessibility tools to use to determine how to represent this region, if
     there is no control.</dd>

    </dl><p>Hit regions can be used for a variety of purposes:</p>

    <ul><li>With an ID, they can make hit detection easier by having the user agent check which region
     the mouse is over and include the ID in the mouse events.</li>

     <li>With a control, they can make routing events to DOM elements automatic, allowing e.g.
     clicks on a <code><a href="#the-canvas-element">canvas</a></code> to automatically submit a form via a <code><a href="the-button-element.html#the-button-element">button</a></code>
     element.</li>

     <li>With a label, they can make it easier for users to explore a <code><a href="#the-canvas-element">canvas</a></code> without
     seeing it, e.g. by touch on a mobile device.</li>

     <li>With a cursor, they can make it easier for different regions of the <code><a href="#the-canvas-element">canvas</a></code> to
     have different cursors, with the user agent automatically switching between them.</li>

    </ul></dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-removeHitRegion"><a href="#dom-context-2d-removehitregion">removeHitRegion</a></code>(<var title="">id</var>)</dt>

   <dd>

    <p>Removes a hit region (and all its descendants) from the canvas bitmap. The argument is the ID
    of a region added using <code title="dom-context-2d-addHitRegion"><a href="#dom-context-2d-addhitregion">addHitRegion()</a></code>.</p>

    <p>The pixels that were covered by this region and its descendants are effectively cleared by
    this operation, leaving the regions non-interactive. In particular, regions that occupied the
    same pixels before the removed regions were added, overlapping them, do not resume their
    previous role.</p>

   </dd>

  </dl><div class="impl">

  <p>A <a href="#hit-region">hit region</a> <var title="">A</var> is an <dfn id="ancestor-region">ancestor region</dfn> of a <a href="#hit-region">hit
  region</a> <var title="">B</var> if <var title="">B</var> has a <a href="#hit-region's-parent" title="hit region's
  parent">parent</a> and its <a href="#hit-region's-parent" title="hit region's parent">parent</a> is either <var title="">A</var> or another <a href="#hit-region">hit region</a> for which <var title="">A</var> is an
  <a href="#ancestor-region">ancestor region</a>.</p>

  <p><dfn id="the-region-identified-by-the-id">The region identified by the ID</dfn> <var title="">ID</var> in a bitmap <var title="">bitmap</var> is the value returned by the following algorithm (which can return a
  <a href="#hit-region">hit region</a> or nothing):</p>

  <ol><li><p>If <var title="">ID</var> is null, return nothing and abort these steps.</p></li> <!--
   this step is redundant but makes sure people don't confuse 'null' for 'not having an ID' -->

   <li><p>Let <var title="">list</var> be the <a href="#hit-region-list">hit region list</a> associated with <var title="">bitmap</var>.</p></li>

   <li><p>If there is a <a href="#hit-region">hit region</a> in <var title="">list</var> whose <a href="#hit-region's-id" title="hit
   region's ID">ID</a> is a <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for <var title="">ID</var>, then
   return that <a href="#hit-region">hit region</a> and abort these steps.</p></li>

   <li><p>Otherwise, return nothing.</p></li>

  </ol><p><dfn id="the-region-representing-the-control">The region representing the control</dfn> <var title="">control</var> for a bitmap <var title="">bitmap</var> is the value returned by the following algorithm (which can return a
  <a href="#hit-region">hit region</a> or nothing):</p>

  <ol><li><p>Let <var title="">list</var> be the <a href="#hit-region-list">hit region list</a> associated with <var title="">bitmap</var>.</p></li>

   <li><p>If there is a <a href="#hit-region">hit region</a> in <var title="">list</var> whose <a href="#hit-region's-control" title="hit
   region's control">control</a> is <var title="">control</var>, then return that <a href="#hit-region">hit
   region</a> and abort these steps.</p></li>

   <li><p>Otherwise, return nothing.</p></li>

  </ol><p><dfn id="the-control-represented-by-a-region">The control represented by a region</dfn> <var title="">region</var> for a
  <code><a href="#the-canvas-element">canvas</a></code> element <var title="">ancestor</var> is the value returned by the following
  algorithm (which can return an element or nothing):</p>

  <ol><li><p>If <var title="">region</var> has no <a href="#hit-region's-control" title="hit region's control">control</a>,
   return nothing and abort these steps.</p></li>

   <li><p>Let <var title="">control</var> be <var title="">region</var>'s <a href="#hit-region's-control" title="hit region's
   control">control</a>.</p></li>

   <li><p>If <var title="">control</var> is not a descendant of <var title="">ancestor</var>, then
   return nothing and abort these steps.</p></li>

   <li><p>If <var title="">control</var> is no longer a <a href="#supported-interactive-canvas-fallback-element">supported interactive canvas fallback
   element</a>, then return nothing and abort these steps.</p></li>

   <li><p>Otherwise, return <var title="">control</var>.</p></li>

  </ol><p><dfn id="the-cursor-for-a-hit-region">The cursor for a hit region</dfn> <var title="">region</var> of a <code><a href="#the-canvas-element">canvas</a></code>
  element <var title="">ancestor</var> is the value returned by the following algorithm:</p>

  <ol><li><p><i>Loop</i>: If <var title="">region</var> has a <a href="#hit-region's-cursor-specification" title="hit region's cursor
   specification">cursor specification</a> other than "<code title="">inherit</code>", then
   return that <a href="#hit-region's-cursor-specification">hit region's cursor specification</a> and abort these steps.</p></li>

   <li><p>If <var title="">region</var> has a <a href="#hit-region's-parent" title="hit region's parent">parent</a>, then
   let <var title="">region</var> be that <a href="#hit-region's-parent">hit region's parent</a>, and return to the step
   labeled <i>loop</i>.</p></li>

   <li><p>Otherwise, return the used value of the 'cursor' property for the <code><a href="#the-canvas-element">canvas</a></code>
   element, if any; if there isn't one, return 'auto'. <a href="references.html#refsCSSUI">[CSSUI]</a></p></li>

  </ol><p><dfn id="the-region-for-a-pixel">The region for a pixel</dfn> <var title="">pixel</var> on a bitmap <var title="">bitmap</var> is the value returned by the following algorithm (which can return a
  <a href="#hit-region">hit region</a> or nothing):</p>

  <ol><li><p>Let <var title="">list</var> be the <a href="#hit-region-list">hit region list</a> associated with <var title="">bitmap</var>.</p></li>

   <li><p>If there is a <a href="#hit-region">hit region</a> in <var title="">list</var> whose <a href="#hit-region's-set-of-pixels" title="hit
   region's set of pixels">set of pixels</a> contains <var title="">pixel</var>, then return that
   <a href="#hit-region">hit region</a> and abort these steps.</p></li>

   <li><p>Otherwise, return nothing.</p></li>

  </ol><p>To <dfn id="clear-regions-that-cover-the-pixels">clear regions that cover the pixels</dfn> <var title="">pixels</var> on a bitmap <var title="">bitmap</var>, the user agent must run the following steps:</p>

  <ol><li><p>Let <var title="">list</var> be the <a href="#hit-region-list">hit region list</a> associated with <var title="">bitmap</var>.</p></li>

   <li><p>Remove all pixels in <var title="">pixels</var> from the <a href="#hit-region's-set-of-pixels" title="hit region's set of
   pixels">set of pixels</a> of each <a href="#hit-region">hit region</a> in <var title="">list</var>.</p></li>

   <li><p><a href="#garbage-collect-the-regions">Garbage-collect the regions</a> of <var title="">bitmap</var>.</p></li>

  </ol><p>To <dfn id="garbage-collect-the-regions">garbage-collect the regions</dfn> of a bitmap <var title="">bitmap</var>, the user
  agent must run the following steps:</p>

  <ol><li><p>Let <var title="">list</var> be the <a href="#hit-region-list">hit region list</a> associated with <var title="">bitmap</var>.</p></li>

   <li><p><i>Loop</i>: Let <var title="">victim</var> be the first <a href="#hit-region">hit region</a> in <var title="">list</var> to have an empty <a href="#hit-region's-set-of-pixels" title="hit region's set of pixels">set of
   pixels</a> and a zero <a href="#hit-region's-child-count" title="hit region's child count">child count</a>, if any. If
   there is no such <a href="#hit-region">hit region</a>, abort these steps.</p></li>

   <li><p>If <var title="">victim</var> has a <a href="#hit-region's-parent" title="hit region's parent">parent</a>, then
   decrement that <a href="#hit-region's-child-count">hit region's child count</a> by one.</p></li>

   <li><p>Remove <var title="">victim</var> from <var title="">list</var>.</p></li>

   <li><p>Jump back to the step labeled <i>loop</i>.</p></li>

  </ol><p class="note">Adding a new region and calling <code title="dom-context-2d-clearRect"><a href="#dom-context-2d-clearrect">clearRect()</a></code> are the two ways this clearing algorithm can
  be invoked. The <a href="#hit-region-list">hit region list</a> itself is also reset when the rendering context is
  reset, e.g. when a <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is bound to or unbound from a
  <code><a href="#the-canvas-element">canvas</a></code>, or when the dimensions of the bitmap are changed.</p>

  <hr><p>An element is a <dfn id="supported-interactive-canvas-fallback-element">supported interactive canvas fallback element</dfn> if it is one of the
  following:</p>

  <ul class="brief"><li><p>an <code><a href="text-level-semantics.html#the-a-element">a</a></code> element that <a href="elements.html#represents">represents</a> a
   <a href="links.html#hyperlink">hyperlink</a> and that does not have any <code><a href="edits.html#the-img-element">img</a></code> descendants</p></li>

   <li><p>a <code><a href="the-button-element.html#the-button-element">button</a></code> element</p></li>

   <li><p>an <code><a href="the-input-element.html#the-input-element">input</a></code> element whose <code title="attr-input-type"><a href="the-input-element.html#attr-input-type">type</a></code>
   attribute is in one of the <a href="states-of-the-type-attribute.html#checkbox-state-(type=checkbox)" title="attr-input-type-checkbox">Checkbox</a> or <a href="states-of-the-type-attribute.html#radio-button-state-(type=radio)" title="attr-input-type-radio">Radio Button</a> states</p></li>

   <li><p>an <code><a href="the-input-element.html#the-input-element">input</a></code> element that is a <a href="forms.html#concept-button" title="concept-button">button</a> but
   its <code title="attr-input-type"><a href="the-input-element.html#attr-input-type">type</a></code> attribute is not in the <a href="states-of-the-type-attribute.html#image-button-state-(type=image)" title="attr-input-type-image">Image Button</a> state</p></li>

   <li><p>a <code><a href="the-button-element.html#the-select-element">select</a></code> element with a <code title="attr-select-multiple"><a href="the-button-element.html#attr-select-multiple">multiple</a></code> attribute or a <a href="the-button-element.html#concept-select-size" title="concept-select-size">display size</a> greater than 1</p></li>

   <li><p>an <code><a href="the-button-element.html#the-option-element">option</a></code> element that is in a <a href="the-button-element.html#concept-select-option-list" title="concept-select-option-list">list of options</a> of a <code><a href="the-button-element.html#the-select-element">select</a></code> element
   with a <code title="attr-select-multiple"><a href="the-button-element.html#attr-select-multiple">multiple</a></code> attribute or a <a href="the-button-element.html#concept-select-size" title="concept-select-size">display size</a> greater than 1</p></li>

   <li><p>a <a href="tabular-data.html#sorting-interface-th-element">sorting interface <code>th</code> element</a></p></li>

   <li><p>an element that would not be <a href="elements.html#interactive-content">interactive content</a> except for having the
   <code title="attr-tabindex"><a href="editing.html#attr-tabindex">tabindex</a></code> attribute specified</p></li>

   <!-- so that people can do grids, like crosswords, yet let AT users select rows, or the
   entire table, to see the whole context -->
   <li><p>a non-<a href="elements.html#interactive-content" title="interactive content">interactive</a> <code><a href="tabular-data.html#the-table-element">table</a></code>,
   <code><a href="tabular-data.html#the-caption-element">caption</a></code>, <code><a href="tabular-data.html#the-thead-element">thead</a></code>, <code><a href="tabular-data.html#the-tbody-element">tbody</a></code>, <code><a href="tabular-data.html#the-tfoot-element">tfoot</a></code>,
   <code><a href="tabular-data.html#the-tr-element">tr</a></code>, <code><a href="tabular-data.html#the-td-element">td</a></code>, or <code><a href="tabular-data.html#the-th-element">th</a></code> element</p></li>

  </ul><hr><p>When the <dfn id="dom-context-2d-addhitregion" title="dom-context-2d-addHitRegion"><code>addHitRegion()</code></dfn> method is
  invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var title="">arguments</var> be the dictionary object provided as the method's
   argument.</p></li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-path"><a href="#dom-hitregionoptions-path">path</a></code> member is not null, let <var title="">source
   path</var> be the <code title="dom-HitRegionOptions-path"><a href="#dom-hitregionoptions-path">path</a></code> member's value. Otherwise,
   let it be the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object's <a href="#current-default-path">current default
   path</a>.</p></li>

<!--
   <li><p>If the <var title="">arguments</var> object's <code
   title="dom-HitRegionOptions-path">path</code> member is null, but the <code
   title="dom-HitRegionOptions-transform">transform</code> member is not, then throw a
   <code>NotSupportedError</code> exception and abort these steps.</p></li>

   <li><p>Transform all the coordinates and lines in <var title="">source path</var> by the
   transform matrix given by the <var title="">arguments</var> object's <code
   title="dom-HitRegionOptions-transform">transform</code> member, if it is not null.</p></li>
-->

   <li><p>Transform all the coordinates and lines in <var title="">source path</var> by the current
   transform matrix, if the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-path"><a href="#dom-hitregionoptions-path">path</a></code> member is not null.</p></li>

   <li><p>Let <var title="">specified pixels</var> be the pixels contained in <var title="">source
   path</var>, using the <a href="#fill-rule">fill rule</a> indicated by the <code title="dom-HitRegionOptions-fillRule"><a href="#dom-hitregionoptions-fillrule">fillRule</a></code> member.</p></li>

   <li><p>Remove from <var title="">specified pixels</var> any pixels not contained within the
   <a href="#clipping-region">clipping region</a>.</p></li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-id"><a href="#dom-hitregionoptions-id">id</a></code> member is the empty string, let it be null
   instead.</p></li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-id"><a href="#dom-hitregionoptions-id">id</a></code> member is not null, then let <var title="">previous
   region for this ID</var> be <a href="#the-region-identified-by-the-id">the region identified by the ID</a> given by the <code title="dom-HitRegionOptions-id"><a href="#dom-hitregionoptions-id">id</a></code> member's value in this <a href="#scratch-bitmap">scratch bitmap</a>, if
   any. If the <code title="dom-HitRegionOptions-id"><a href="#dom-hitregionoptions-id">id</a></code> member is null or no such region
   currently exists, let <var title="">previous region for this ID</var> be null.</p></li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-parent">parent</code> member is the empty string, let it be null
   instead.</p></li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-parent">parent</code> member is not null, then let <var title="">parent region</var> be <a href="#the-region-identified-by-the-id">the region identified by the ID</a> given by the <code title="dom-HitRegionOptions-parent">parent</code> member's value in the <a href="#scratch-bitmap">scratch
   bitmap</a>, if any. If the <code title="dom-HitRegionOptions-parent">parent</code> member is
   null or no such region currently exists, let <var title="">parent region</var> be null.</p></li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-label"><a href="#dom-hitregionoptions-label">label</a></code> member is the empty string, let it be null
   instead.</p></li>

   <li>

    <p>If any of the following conditions are met, throw a <code><a href="infrastructure.html#notsupportederror">NotSupportedError</a></code> exception
    and abort these steps.</p>

    <ul class="brief"><!--
     <li><p>The <var title="">arguments</var> object's <code
     title="dom-HitRegionOptions-path">path</code> member is null, but its <code
     title="dom-HitRegionOptions-transform">transform</code> member is not.</p></li>
--><li><p>The <var title="">arguments</var> object's <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> and <code title="dom-HitRegionOptions-label"><a href="#dom-hitregionoptions-label">label</a></code> members are both non-null.</p></li>

     <li><p>The <var title="">arguments</var> object's <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> and <code title="dom-HitRegionOptions-role"><a href="#dom-hitregionoptions-role">role</a></code> members are both non-null.</p></li>

<!--CLEANUP-->
     <li><p>The <var title="">arguments</var> object's <code title="dom-HitRegionOptions-role"><a href="#dom-hitregionoptions-role">role</a></code> member's value is the empty string, and the <code title="dom-HitRegionOptions-label"><a href="#dom-hitregionoptions-label">label</a></code> member's value is either null or the empty
     string.</p></li>

     <li><p>The <var title="">specified pixels</var> has no pixels.</p></li>

     <li><p>The <var title="">arguments</var> object's <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> member is neither null nor a
     <a href="#supported-interactive-canvas-fallback-element">supported interactive canvas fallback element</a>.</p></li>

     <li><p>The <var title="">parent region</var> is not null but has a <a href="#hit-region's-control" title="hit region's
     control">control</a>.</p></li>

     <li><p>The <var title="">previous region for this ID</var> is the same <a href="#hit-region">hit region</a> as
     the <var title="">parent region</var>.</p></li>

     <li><p>The <var title="">previous region for this ID</var> is an <a href="#ancestor-region">ancestor region</a>
     of the <var title="">parent region</var>.</p></li>

    </ul></li>

   <li><p>If the <code title="dom-HitRegionOptions-parent">parent</code> member is not null but <var title="">parent region</var> is null, then throw a <code><a href="infrastructure.html#notfounderror">NotFoundError</a></code> exception and abort
   these steps.</p></li>

   <li>

    <p>If any of the following conditions are met, throw a <code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code> exception and
    abort these steps.</p>

    <ul class="brief"><li>The <var title="">arguments</var> object's <code title="dom-HitRegionOptions-cursor"><a href="#dom-hitregionoptions-cursor">cursor</a></code> member is not null but is neither an
     <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a> match for the string "<code title="">inherit</code>", nor a
     valid CSS 'cursor' property value. <a href="references.html#refsCSSUI">[CSSUI]</a></li>

     <li>The <var title="">arguments</var> object's <code title="dom-HitRegionOptions-role"><a href="#dom-hitregionoptions-role">role</a></code> member is not null but its value is not an
     <a href="common-microsyntaxes.html#ordered-set-of-unique-space-separated-tokens">ordered set of unique space-separated tokens</a> whose tokens are all
     <a href="infrastructure.html#case-sensitive">case-sensitive</a> matches for names of non-abstract WAI-ARIA roles. <a href="references.html#refsARIA">[ARIA]</a></li>

    </ul></li>

   <li>

    <p>Let <var title="">region</var> be a newly created <a href="#hit-region">hit region</a>, with its
    information configured as follows:</p>

    <dl><dt><a href="#hit-region's-set-of-pixels">Hit region's set of pixels</a>

     </dt><dd><p>The <var title="">specified pixels</var>


     </p></dd><dt><a href="#hit-region's-bounding-circumference">Hit region's bounding circumference</a>

     </dt><dd><p>A user-agent-defined shape that wraps the pixels contained in <var title="">source
     path</var>. (In the simplest case, this can just be the bounding rectangle; this specification
     allows it to be any shape in order to allow other interfaces.)


     </p></dd><dt><a href="#hit-region's-id">Hit region's ID</a>

     </dt><dd><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-id"><a href="#dom-hitregionoptions-id">id</a></code> member is not null: the value of the <code title="dom-HitRegionOptions-id"><a href="#dom-hitregionoptions-id">id</a></code> member. Otherwise, <var title="">region</var> has no
     <a href="#hit-region's-id" title="hit region's id">id</a>.


     </p></dd><dt><a href="#hit-region's-parent">Hit region's parent</a>

     </dt><dd><p>If <var title="">parent region</var> is not null: <var title="">parent region</var>.
     Otherwise, <var title="">region</var> has no <a href="#hit-region's-parent" title="hit region's parent">parent</a>.


     </p></dd><dt><a href="#hit-region's-child-count">Hit region's child count</a>

     </dt><dd><p>Initially zero.


     </p></dd><dt><a href="#hit-region's-cursor-specification">Hit region's cursor specification</a>

     </dt><dd><p>If <var title="">parent region</var> is not null: <var title="">parent region</var>.
     Otherwise, <var title="">region</var> has no <a href="#hit-region's-parent" title="hit region's parent">parent</a>.


     </p></dd><dt><a href="#hit-region's-control">Hit region's control</a>

     </dt><dd><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> member is not null: the value of the <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> member. Otherwise, <var title="">region</var> has no <a href="#hit-region's-control" title="hit region's control">control</a>.


     </p></dd><dt><a href="#hit-region's-label">Hit region's label</a>

     </dt><dd><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-label"><a href="#dom-hitregionoptions-label">label</a></code> member is not null: the value of the <code title="dom-HitRegionOptions-label"><a href="#dom-hitregionoptions-label">label</a></code> member. Otherwise, <var title="">region</var>
     has no <a href="#hit-region's-label" title="hit region's label">label</a>.


     </p></dd><dt><a href="#hit-region's-aria-role">Hit region's ARIA role</a>

     </dt><dd><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-role"><a href="#dom-hitregionoptions-role">role</a></code> member is not null: the value of the <code title="dom-HitRegionOptions-role"><a href="#dom-hitregionoptions-role">role</a></code> member (which might be the empty string).
     Otherwise, if the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-label"><a href="#dom-hitregionoptions-label">label</a></code> member is not null: the empty string.
     Otherwise, <var title="">region</var> has no <a href="#hit-region's-aria-role" title="hit region's ARIA role">ARIA
     role</a>.


    </p></dd></dl></li>

   <li>

    <p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-cursor"><a href="#dom-hitregionoptions-cursor">cursor</a></code> member is not null, then act as if a CSS rule
    for the <code><a href="#the-canvas-element">canvas</a></code> element setting its 'cursor' property had been seen, whose value was
    the <a href="#hit-region's-cursor-specification">hit region's cursor specification</a>.</p>

    <p class="note">For example, if the user agent prefetches cursor values, this would cause that
    to happen in response to an appropriately-formed <code title="dom-context-2d-addHitRegion"><a href="#dom-context-2d-addhitregion">addHitRegion()</a></code> call.</p>

   </li>

   <li><p>If the <var title="">arguments</var> object's <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> member is not null, then let <var title="">previous region for the control</var> be <a href="#the-region-representing-the-control">the region representing the
   control</a> given by the <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> member's
   value for this <a href="#scratch-bitmap">scratch bitmap</a>, if any. If the <code title="dom-HitRegionOptions-control"><a href="#dom-hitregionoptions-control">control</a></code> member is null or no such region currently
   exists, let <var title="">previous region for the control</var> be null.</p></li>

   <!-- the parent region can't have a control, because no region with a control can be a parent -
   we check for that above. Thus, it is safe to remove the previous region for the control without
   worrying that our parent is going to be affected.

   It's also safe to remove the previous region with this ID and all its descendants, as we know
   that our parent isn't part of that subtree. -->

   <li><p>If there is a <var title="">previous region with this control</var>, remove it from the
   <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#hit-region-list">hit region list</a>; then, if it had a <a href="#hit-region's-parent" title="hit
   region's parent">parent</a> region, decrement that <a href="#hit-region's-child-count">hit region's child count</a> by
   one.</p></li> <!-- we garbage collect the regions below -->

   <li><p>If there is a <var title="">previous region with this ID</var>, remove it, and all <a href="#hit-region" title="hit region">hit regions</a> for which it is an <a href="#ancestor-region">ancestor region</a>, from the
   <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#hit-region-list">hit region list</a>; then, if it had a <a href="#hit-region's-parent" title="hit
   region's parent">parent</a> region, decrement that <a href="#hit-region's-child-count">hit region's child count</a> by
   one.</p></li> <!-- we garbage collect the regions below -->

   <li><p>If there is a <var title="">parent region</var>, increment its <a href="#hit-region's-child-count">hit region's child
   count</a> by one.</p></li>

   <li><p><a href="#clear-regions-that-cover-the-pixels">Clear regions that cover the pixels</a> in <var title="">region</var>'s <a href="#hit-region's-set-of-pixels" title="hit region's set of pixels">set of pixels</a> on this <a href="#scratch-bitmap">scratch
   bitmap</a>.</p></li> <!-- this is what garbage collects the earlier regions -->

   <li><p>Add <var title="">region</var> to the <a href="#scratch-bitmap">scratch bitmap</a>'s element's <a href="#hit-region-list">hit
   region list</a>.</p></li>

  </ol><p>When the <dfn id="dom-context-2d-removehitregion" title="dom-context-2d-removeHitRegion"><code>removeHitRegion()</code></dfn>
  method is invoked, the user agent must run the following steps:</p>

  <ol><li>

    <p>Let <var title="">region</var> be <a href="#the-region-identified-by-the-id">the region identified by the ID</a> given by the
    method's argument in the rendering context's <a href="#scratch-bitmap">scratch bitmap</a>. If no such region
    currently exists, abort these steps.</p>

    <p class="note">If the method's argument is the empty string, then no region will match.</p>

   </li>

   <li><p>Remove <var title="">region</var>, and all <a href="#hit-region" title="hit region">hit regions</a> for
   which it is an <a href="#ancestor-region">ancestor region</a>, from the rendering context's <a href="#scratch-bitmap">scratch
   bitmap</a>'s <a href="#hit-region-list">hit region list</a>; then, if it had a <a href="#hit-region's-parent" title="hit region's
   parent">parent</a> region, decrement that <a href="#hit-region's-child-count">hit region's child count</a> by
   one.</p></li> <!-- we garbage collect the regions below -->

   <li><p><a href="#garbage-collect-the-regions">Garbage-collect the regions</a> of the rendering context's <a href="#scratch-bitmap">scratch
   bitmap</a>.</p></li>

  </ol></div>

  <hr><!--CLEANUP--><p>The <code><a href="infrastructure.html#mouseevent">MouseEvent</a></code> interface is extended to support hit
  regions:</p>

  <pre class="idl">partial interface <a href="infrastructure.html#mouseevent" id="MouseEvent-partial">MouseEvent</a> {
  readonly attribute DOMString? <a href="#dom-mouseevent-region" title="dom-MouseEvent-region">region</a>;
};

partial dictionary <a href="infrastructure.html#mouseeventinit">MouseEventInit</a> {
  DOMString? region;
};</pre>

  <dl class="domintro"><dt><var title="">event</var> . <code title="dom-MouseEvent-region"><a href="#dom-mouseevent-region">region</a></code></dt>

   <dd>

<!--CLEANUP-->
    <p>If the mouse was over a <a href="#hit-region">hit region</a>, then this returns the <a href="#hit-region's-id">hit region's ID</a>, if it has one.</p>

    <p>Otherwise, returns null.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-mouseevent-region" title="dom-MouseEvent-region"><code>region</code></dfn> attribute on
  <code><a href="infrastructure.html#mouseevent">MouseEvent</a></code> objects must return the value it was initialized to. When the object is
  created, this attribute must be initialized to null. It represents the <a href="#hit-region's-id">hit region's
  ID</a> if the mouse was over a hit region when the event was fired.</p>

  <p>When a <code><a href="infrastructure.html#mouseevent">MouseEvent</a></code> is to be fired at a <code><a href="#the-canvas-element">canvas</a></code> element by the user
  agent in response to a pointing device action other than a click (e.g. a <code title="event-mousedown"><a href="infrastructure.html#event-mousedown">mousedown</a></code> event or a <code title="event-mousemove"><a href="infrastructure.html#event-mousemove">mousemove</a></code> event), the user agent must run the <a href="#canvas-mouseevent-rerouting-steps">canvas
  <code>MouseEvent</code> rerouting steps</a> immediately prior to dispatching the event<!--
  interaction event spec point -->. This does not affect default actions (so for instance, if the
  event gets rerouted to an element that has a default action for <code title="event-mousemove"><a href="infrastructure.html#event-mousemove">mousemove</a></code> events, this default action doesn't trigger<!-- this
  would be significantly more obvious if there was a real spec defining how mouse events trigger
  that we could actually properly hook into -->).</p>

  <p class="note">Actual clicks are handled by the <a href="editing.html#run-authentic-click-activation-steps">run authentic click activation
  steps</a>, which also invoke these steps.</p>

  <p>The <dfn id="canvas-mouseevent-rerouting-steps">canvas <code>MouseEvent</code> rerouting steps</dfn> are as follows. If these steps
  say to <i>act as normal</i>, that means that the event must be fired as it would have had these
  requirements not been applied.</p>

  <ol><li><p>If the pointing device is not indicating a pixel on the <code><a href="#the-canvas-element">canvas</a></code>, then act as
   normal and abort these steps.</p></li>

   <li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element has no <a href="#hit-region-list">hit region list</a>, then act as normal
   and abort these steps.</p></li>

   <li><p>Let <var title="">pixel</var> be the pixel indicated by the pointing device.</p></li>

   <li><p>Let <var title="">region</var> be the <a href="#hit-region">hit region</a> that is <a href="#the-region-for-a-pixel" title="the
   region for a pixel">the region for the pixel</a> <var title="">pixel</var> on this
   <code><a href="#the-canvas-element">canvas</a></code> element's bitmap, if any.</p></li>

   <li><p>If there is no <var title="">region</var>, then act as normal and abort these
   steps.</p></li>

   <li><p>Let <var title="">id</var> be the <var title="">region</var>'s <a href="#hit-region's-id" title="hit region's
   ID">ID</a>, if any.</p></li>

   <li><p>If there is an <var title="">id</var>, then initialize the event object's <code title="dom-MouseEvent-region"><a href="#dom-mouseevent-region">region</a></code> attribute to <var title="">id</var>.</p></li>

   <li><p>Let <var title="">control</var> be the <a href="#the-control-represented-by-a-region" title="the control represented by a
   region">control represented by</a> <var title="">region</var> for this <code><a href="#the-canvas-element">canvas</a></code>
   element, if any.</p></li>

   <li><p>If there is a <var title="">control</var>, then target the event object at <var title="">control</var> instead of the <code><a href="#the-canvas-element">canvas</a></code> element.</p></li>

   <li><p>Continue dispatching the event, but with the updated event object and target as given in
   the above steps.</p></li>

  </ol><hr></div>

  <p>The <code><a href="infrastructure.html#touch">Touch</a></code> interface is extended to support hit regions also: <a href="references.html#refsTOUCH">[TOUCH]</a></p>

  <pre class="idl">partial interface <a href="infrastructure.html#touch" id="Touch-partial">Touch</a> {
  readonly attribute DOMString? <a href="#dom-touch-region" title="dom-Touch-region">region</a>;
};</pre>

  <dl class="domintro"><dt><var title="">touch</var> . <code title="dom-Touch-region"><a href="#dom-touch-region">region</a></code></dt>

   <dd>

    <p>If the <a href="infrastructure.html#touch-point">touch point</a> was over a <a href="#hit-region">hit region</a> when it was first placed
    on the surface, then this returns the <a href="#hit-region's-id">hit region's ID</a>, if it has one.</p>

    <p>Otherwise, returns null.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-touch-region" title="dom-Touch-region"><code>region</code></dfn> attribute on a <code><a href="infrastructure.html#touch">Touch</a></code>
  object representing a <a href="infrastructure.html#touch-point">touch point</a> <var title="">T</var> must return the value
  obtained by running the following algorithm when <var title="">T</var> was first placed on the
  surface: <a href="references.html#refsTOUCH">[TOUCH]</a></p>

  <ol><li><p>If the <a href="infrastructure.html#touch-point">touch point</a> is not on a pixel on the <code><a href="#the-canvas-element">canvas</a></code>, then return
   null and abort these steps.</p></li>

   <li><p>If the <code><a href="#the-canvas-element">canvas</a></code> element has no <a href="#hit-region-list">hit region list</a>, then return null
   and abort these steps.</p></li>

   <li><p>Let <var title="">pixel</var> be the pixel that the <a href="infrastructure.html#touch-point">touch point</a> is
   on.</p></li>

   <li><p>Let <var title="">region</var> be the <a href="#hit-region">hit region</a> that is <a href="#the-region-for-a-pixel" title="the
   region for a pixel">the region for the pixel</a> <var title="">pixel</var> on this
   <code><a href="#the-canvas-element">canvas</a></code> element's bitmap, if any.</p></li>

   <li><p>If there is no <var title="">region</var>, then return null and abort these
   steps.</p></li>

   <li><p>Let <var title="">id</var> be the <var title="">region</var>'s <a href="#hit-region's-id" title="hit region's
   ID">ID</a>, if any, or else null.</p></li>

   <li><p>Return <var title="">id</var>.</p></li>

  </ol></div>

  <div class="impl">

  <hr><p>When a user's pointing device cursor is positioned over a <code><a href="#the-canvas-element">canvas</a></code> element, user
  agents should render the pointing device cursor according to the cursor specification described by
  <a href="#the-cursor-for-a-hit-region" title="the cursor for a hit region">the cursor for the hit region</a> that is <a href="#the-region-for-a-pixel" title="the region for a pixel">the region for the pixel</a> that the pointing device designates
  on the <code><a href="#the-canvas-element">canvas</a></code> element's bitmap.</p>

  <hr><p>User agents are encouraged to make use of the information present in a <code><a href="#the-canvas-element">canvas</a></code>
  element's <a href="#hit-region-list">hit region list</a> to improve the accessibility of <code><a href="#the-canvas-element">canvas</a></code>
  elements.</p>

  <p>Each <a href="#hit-region">hit region</a> should be handled in a fashion equivalent to a node in a virtual
  DOM tree rooted at the <code><a href="#the-canvas-element">canvas</a></code> element. The hierarchy of this virtual DOM tree must
  match the hierarchy of the <a href="#hit-region" title="hit region">hit regions</a>, as described by the <a href="#hit-region's-parent" title="hit region's parent">parent</a> of each region. Regions without a <a href="#hit-region's-parent" title="hit
  region's parent">parent</a> must be treated as children of the <code><a href="#the-canvas-element">canvas</a></code> element for
  the purpose of this virtual DOM tree. For each node in such a DOM tree, the <a href="#hit-region's-bounding-circumference">hit region's
  bounding circumference</a> gives the region of the screen to use when representing the node (if
  appropriate).</p>

  <p>The semantics of a <a href="#hit-region">hit region</a> for the purposes of this virtual DOM tree are those
  of the <a href="#the-control-represented-by-a-region" title="the control represented by a region">the control represented by the
  region</a>, if it has one, or else of a non-interactive element whose ARIA role, if any, is
  that given by the <a href="#hit-region's-aria-role">hit region's ARIA role</a>, and whose textual representation, if any,
  is given by the <a href="#hit-region's-label">hit region's label</a>.</p>

  <p>For the purposes of accessibility tools, when an element <var title="">C</var> is a descendant
  of a <code><a href="#the-canvas-element">canvas</a></code> element and there is <a href="#the-region-representing-the-control" title="the region representing the control">a
  region representing the control</a> <var title="">C</var> for that <code><a href="#the-canvas-element">canvas</a></code>
  element's bitmap, then the element's position relative to the document should be presented as if
  it was that region in the <code><a href="#the-canvas-element">canvas</a></code> element's virtual DOM tree.</p>

  <p>The semantics of a <a href="#hit-region">hit region</a> for the purposes of this virtual DOM tree are those
  of the <a href="#the-control-represented-by-a-region" title="the control represented by a region">the control represented by the
  region</a>, if it has one, or else of a non-interactive element whose ARIA role, if any, is
  that given by the <a href="#hit-region's-aria-role">hit region's ARIA role</a>, and whose textual representation, if any,
  is given by the <a href="#hit-region's-label">hit region's label</a>.</p>

<!--CLEANUP-->
  <p class="note">Thus, for instance, a user agent on a touch-screen device could provide haptic
  feedback when the user croses over a <a href="#hit-region's-bounding-circumference">hit region's bounding circumference</a>, and then
  read the <a href="#hit-region's-label">hit region's label</a> to the user. Similarly, a desktop user agent with a
  virtual accessibility focus separate from the keyboard input focus could allow the user to
  navigate through the hit regions, using the virtual DOM tree described above to enable
  hierarchical navigation. When an interactive control inside the <code><a href="#the-canvas-element">canvas</a></code> element
  <a href="editing.html#gains-focus">gains focus</a>, if the control has a corresponding region, then that <a href="#hit-region's-bounding-circumference">hit region's bounding
  circumference</a> could be used to determine what area of the display to magnify.</p>

  </div>


  <h6 id="pixel-manipulation"><span class="secno">4.12.4.2.16 </span><dfn>Pixel manipulation</dfn></h6>

  <dl class="domintro"><dt><var title="">imagedata</var> = new <code title="dom-imagedata"><a href="#dom-imagedata">ImageData</a></code>(<var title="">sw</var>, <var title="">sh</var>)</dt>
   <dt><var title="">imagedata</var> = <var title="">context</var> . <code title="dom-context-2d-createImageData"><a href="#dom-context-2d-createimagedata">createImageData</a></code>(<var title="">sw</var>, <var title="">sh</var>)</dt>

   <dd>

    <p>Returns an <code><a href="#imagedata">ImageData</a></code> object with the given dimensions. All the pixels in the
    returned object are transparent black.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the either of the width or height
    arguments are zero.</p>

   </dd>

   <dt><var title="">imagedata</var> = <var title="">context</var> . <code title="dom-context-2d-createImageData"><a href="#dom-context-2d-createimagedata">createImageData</a></code>(<var title="">imagedata</var>)</dt>

   <dd>

    <p>Returns an <code><a href="#imagedata">ImageData</a></code> object with the same dimensions as the argument. All the
    pixels in the returned object are transparent black.</p>

   </dd>

   <dt><var title="">imagedata</var> = new <code title="dom-imagedata"><a href="#dom-imagedata">ImageData</a></code>(<var title="">data</var>, <var title="">sw</var> [, <var title="">sh</var> ] )</dt>

   <dd>

    <p>Returns an <code><a href="#imagedata">ImageData</a></code> object using the data provided in the <code><a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a></code> argument, interpreted using the given dimensions.</p>

    <p>As each pixel in the data is represented by four numbers, the length of the data needs to be
    a multiple of four times the given width. If the height is provided as well, then the length
    needs to be exactly the width times the height times 4.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the given data and dimensions can't be
    interpreted consistently, or if either dimension is zero.</p>

   </dd>

   <dt><var title="">imagedata</var> = <var title="">context</var> . <code title="dom-context-2d-getImageData"><a href="#dom-context-2d-getimagedata">getImageData</a></code>(<var title="">sx</var>, <var title="">sy</var>, <var title="">sw</var>, <var title="">sh</var>)</dt>

   <dd>

    <p>Returns an <code><a href="#imagedata">ImageData</a></code> object containing the image data for the given rectangle of
    the bitmap.</p>

    <p>Throws an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception if the either of the width or height
    arguments are zero.</p>

   </dd>

   <dt><var title="">imagedata</var> . <code title="dom-imagedata-width"><a href="#dom-imagedata-width">width</a></code></dt>
   <dt><var title="">imagedata</var> . <code title="dom-imagedata-height"><a href="#dom-imagedata-height">height</a></code></dt>

   <dd>

    <p>Returns the actual dimensions of the data in the <code><a href="#imagedata">ImageData</a></code> object, in
    pixels.</p>

   </dd>

   <dt><var title="">imagedata</var> . <code title="dom-imagedata-data"><a href="#dom-imagedata-data">data</a></code></dt>

   <dd>

    <p>Returns the one-dimensional array containing the data in RGBA order, as integers in the range
    0 to 255.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-putImageData"><a href="#dom-context-2d-putimagedata">putImageData</a></code>(<var title="">imagedata</var>, <var title="">dx</var>, <var title="">dy</var> [, <var title="">dirtyX</var>, <var title="">dirtyY</var>, <var title="">dirtyWidth</var>, <var title="">dirtyHeight</var> ] )</dt>

   <dd>

    <p>Paints the data from the given <code><a href="#imagedata">ImageData</a></code> object onto the bitmap. If a dirty
    rectangle is provided, only the pixels from that rectangle are painted.</p>

    <p>The <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code> and <code title="dom-context-2d-globalCompositeOperation"><a href="#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code> attributes, as
    well as the shadow attributes, are ignored for the purposes of this method call; pixels in the
    canvas are replaced wholesale, with no composition, alpha blending, no shadows, etc.</p>

    <p>Throws a <code><a href="infrastructure.html#notsupportederror">NotSupportedError</a></code> exception if any of the arguments are not finite.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-imagedata" title="dom-imagedata"><code>ImageData()</code></dfn> constructors and the <dfn id="dom-context-2d-createimagedata" title="dom-context-2d-createImageData"><code>createImageData()</code></dfn> methods are used to
  instantiate new <code><a href="#imagedata">ImageData</a></code> objects.</p>

<!--CLEANUP-->
  <p>When the <code title="dom-imagedata"><a href="#dom-imagedata">ImageData()</a></code> constructor is invoked with two
  numeric arguments <var title="">sw</var> and <var title="">sh</var>, it must return a new
  <code><a href="#imagedata">ImageData</a></code> object representing a transparent black rectangle with a width equal to <var title="">sw</var> and a height equal to <var title="">sh</var>, if both <var title="">sw</var>
  and <var title="">sh</var> are non-zero. If one or both of <var title="">sw</var> and <var title="">sh</var> are zero, then the constructor must throw an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code>
  exception instead.</p>

  <p>When the <code title="dom-imagedata"><a href="#dom-imagedata">ImageData()</a></code> constructor is invoked with its first
  argument being an <code><a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a></code> <var title="">source</var> and its second and
  (optionally) third argument(s) being numeric arguments <var title="">sw</var> and <var title="">sh</var>, it must run the following steps:

  </p><ol><li><p>Let <var title="">length</var> be the number of bytes in <var title="">source</var>.</p></li>

   <li><p>If <var title="">length</var> is not a non-zero integral multiple of four, throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</p></li>

   <li><p>Let <var title="">length</var> be <var title="">length</var> divided by four.</p>

   </li><li>

    <p>If <var title="">length</var> is not an integral multiple of <var title="">sw</var>,
    throw an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception and abort these steps.</p>

    <p class="note">At this step, the length is guaranteed to be greater than zero (otherwise the
    second step above would have aborted the steps), so if <var title="">sw</var> is zero, this
    step will throw the exception and abort these steps.</p>

   </li>

   <li><p>Let <var title="">height</var> be <var title="">length</var> divided by <var title="">sw</var>.</p></li>

   <li><p>If the <var title="">sh</var> argument was not omitted, and its value is not equal to
   <var title="">height</var>, then throw an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception and abort these
   steps.</p></li>

   <li>

    <p>Return a new <code><a href="#imagedata">ImageData</a></code> object whose width is <var title="">sw</var>, whose
    height is <var title="">height</var>, and whose data is <var title="">source</var>.</p>

    <p class="note">The resulting object's data is not a <em>copy</em> of <var title="">source</var>, it's the actual <code><a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a></code> object passed as the
    first argument to the constructor.</p>

   </li>

  </ol><p>When the <code title="dom-context-2d-createImageData"><a href="#dom-context-2d-createimagedata">createImageData()</a></code> method is
  invoked with two numeric arguments <var title="">sw</var> and <var title="">sh</var>, it must
  return a new <code><a href="#imagedata">ImageData</a></code> object representing a transparent black rectangle with a width
  equal to the absolute magnitude of <var title="">sw</var> and a height equal to the absolute
  magnitude of <var title="">sh</var>, if both <var title="">sw</var> and <var title="">sh</var>
  are non-zero. If one or both of <var title="">sw</var> and <var title="">sh</var> are zero, then
  the constructor must throw an <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception instead.</p>

  <p>When the <code title="dom-context-2d-createImageData"><a href="#dom-context-2d-createimagedata">createImageData()</a></code> method is
  invoked with a single <var title="">imagedata</var> argument, it must return a new
  <code><a href="#imagedata">ImageData</a></code> object representing a transparent black rectangle with the same dimensions
  as the <code><a href="#imagedata">ImageData</a></code> object passed as the argument.</p>

  <p>The <dfn id="dom-context-2d-getimagedata" title="dom-context-2d-getImageData"><code>getImageData(<var title="">sx</var>,
  <var title="">sy</var>, <var title="">sw</var>, <var title="">sh</var>)</code></dfn> method must,
  if either the <var title="">sw</var> or <var title="">sh</var> arguments are zero, throw an
  <code><a href="infrastructure.html#indexsizeerror">IndexSizeError</a></code> exception; otherwise,
  <!--ADD-TOPIC:Security-->
  if the <a href="#scratch-bitmap">scratch bitmap</a>'s <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a>
  flag is set to false, it must throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception;
  <!--REMOVE-TOPIC:Security-->
  otherwise, it must return an <code><a href="#imagedata">ImageData</a></code> object with width <var title="">sw</var> and
  height <var title="">sh</var> representing the <a href="#scratch-bitmap">scratch bitmap</a> for the area of that
  bitmap denoted by the rectangle whose corners are the four points (<var title="">sx</var>, <var title="">sy</var>), (<span title=""><var title="">sx</var>+<var title="">sw</var></span>, <var title="">sy</var>), (<span title=""><var title="">sx</var>+<var title="">sw</var></span>,
  <span title=""><var title="">sy</var>+<var title="">sh</var></span>), (<var title="">sx</var>,
  <span title=""><var title="">sy</var>+<var title="">sh</var></span>), in the bitmap's
  coordinate space units. Pixels outside the <a href="#scratch-bitmap">scratch bitmap</a> must be returned as
  transparent black. Pixels must be returned as non-premultiplied alpha values.</p>

  <p>New <code><a href="#imagedata">ImageData</a></code> objects must be initialized so that their <dfn id="dom-imagedata-width" title="dom-imagedata-width"><code>width</code></dfn> attribute is set to the number of pixels per
  row in the image data, their <dfn id="dom-imagedata-height" title="dom-imagedata-height"><code>height</code></dfn>
  attribute is set to the number of rows in the image data, and their <dfn id="dom-imagedata-data" title="dom-imagedata-data"><code>data</code></dfn> attribute, except where an existing array is
  provided, is initialized to a new <code><a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a></code> object. The
  <code><a href="infrastructure.html#uint8clampedarray">Uint8ClampedArray</a></code> object must use a new <a href="#canvas-pixel-arraybuffer">Canvas Pixel
  <code>ArrayBuffer</code></a> for its storage, and must have a zero start offset and a length
  equal to the length of its storage, in bytes. The <a href="#canvas-pixel-arraybuffer">Canvas Pixel
  <code>ArrayBuffer</code></a> must contain the image data. At least one pixel's worth of image
  data must be returned. <a href="references.html#refsECMA262">[ECMA262]</a></p>

  <p>A <dfn id="canvas-pixel-arraybuffer">Canvas Pixel <code>ArrayBuffer</code></dfn> is an <code><a href="infrastructure.html#arraybuffer">ArrayBuffer</a></code> that whose
  data is represented in left-to-right order, row by row top to bottom, starting with the top left,
  with each pixel's red, green, blue, and alpha components being given in that order for each pixel.
  Each component of each pixel represented in this array must be in the range 0..255, representing
  the 8 bit value for that component. The components must be assigned consecutive indices starting
  with 0 for the top left pixel's red component. <a href="references.html#refsECMA262">[ECMA262]</a></p>

  <p>The <dfn id="dom-context-2d-putimagedata" title="dom-context-2d-putImageData"><code>putImageData()</code></dfn> method writes
  data from <code><a href="#imagedata">ImageData</a></code> structures back to the rendering context's <a href="#scratch-bitmap">scratch
  bitmap</a>. Its arguments are: <var title="">imagedata</var>, <var title="">dx</var>, <var title="">dy</var>, <var title="">dirtyX</var>, <var title="">dirtyY</var>, <var title="">dirtyWidth</var>, and <var title="">dirtyHeight</var>.</p>

  <p>When the last four arguments to this method are omitted, they must be assumed to have the
  values 0, 0, the <code title="dom-imagedata-width"><a href="#dom-imagedata-width">width</a></code> member of the <var title="">imagedata</var> structure, and the <code title="dom-imagedata-height"><a href="#dom-imagedata-height">height</a></code>
  member of the <var title="">imagedata</var> structure, respectively.</p>

  <p>When invoked, the method must act as follows:</p>

  <ol><li>

    <p>If <var title="">dirtyWidth</var> is negative, let <var title="">dirtyX</var> be <span title=""><var title="">dirtyX</var>+<var title="">dirtyWidth</var></span>, and let <var title="">dirtyWidth</var> be equal to the absolute magnitude of <var title="">dirtyWidth</var>.</p>

    <p>If <var title="">dirtyHeight</var> is negative, let <var title="">dirtyY</var> be <span title=""><var title="">dirtyY</var>+<var title="">dirtyHeight</var></span>, and let <var title="">dirtyHeight</var> be equal to the absolute magnitude of <var title="">dirtyHeight</var>.</p>

   </li>

   <li>

    <p>If <var title="">dirtyX</var> is negative, let <var title="">dirtyWidth</var> be <span title=""><var title="">dirtyWidth</var>+<var title="">dirtyX</var></span>, and let <var title="">dirtyX</var> be zero.</p>

    <p>If <var title="">dirtyY</var> is negative, let <var title="">dirtyHeight</var> be <span title=""><var title="">dirtyHeight</var>+<var title="">dirtyY</var></span>, and let <var title="">dirtyY</var> be zero.</p>

   </li>

   <li>

    <p>If <span title=""><var title="">dirtyX</var>+<var title="">dirtyWidth</var></span> is greater
    than the <code title="dom-imagedata-width"><a href="#dom-imagedata-width">width</a></code> attribute of the <var title="">imagedata</var> argument, let <var title="">dirtyWidth</var> be the value of that <code title="dom-imagedata-width"><a href="#dom-imagedata-width">width</a></code> attribute, minus the value of <var title="">dirtyX</var>.</p>

    <p>If <span title=""><var title="">dirtyY</var>+<var title="">dirtyHeight</var></span> is
    greater than the <code title="dom-imagedata-height"><a href="#dom-imagedata-height">height</a></code> attribute of the <var title="">imagedata</var> argument, let <var title="">dirtyHeight</var> be the value of that
    <code title="dom-imagedata-height"><a href="#dom-imagedata-height">height</a></code> attribute, minus the value of <var title="">dirtyY</var>.</p>

   </li>

   <li>

    <p>If, after those changes, either <var title="">dirtyWidth</var> or <var title="">dirtyHeight</var> is negative or zero, stop these steps without affecting any
    bitmaps.</p>

   </li>

   <li><p>For all integer values of <var title="">x</var> and <var title="">y</var> where <span title=""><var title="">dirtyX</var> ≤ <var title="">x</var> &lt; <span title=""><var title="">dirtyX</var>+<var title="">dirtyWidth</var></span></span> and <span title=""><var title="">dirtyY</var> ≤ <var title="">y</var> &lt; <span title=""><var title="">dirtyY</var>+<var title="">dirtyHeight</var></span></span>, copy the
   four channels of the pixel with coordinate (<var title="">x</var>, <var title="">y</var>) in
   the <var title="">imagedata</var> data structure to the pixel with coordinate (<span title=""><var title="">dx</var>+<var title="">x</var></span>, <span title=""><var title="">dy</var>+<var title="">y</var></span>) in the rendering context's <a href="#scratch-bitmap">scratch
   bitmap</a>.</p></li>

  </ol><p>The handling of pixel rounding when the specified coordinates are not integers is not defined
  by this specification, except that the following must result in no visible changes to the
  rendering:</p>

  <pre>context.putImageData(context.getImageData(x, y, w, h), p, q);</pre>

  <p>...for any value of <var title="">x</var>, <var title="">y</var>, <var title="">w</var>, and
  <var title="">h</var> and where <var title="">p</var> is the smaller of <var title="">x</var>
  and the sum of <var title="">x</var> and <var title="">w</var>, and <var title="">q</var> is
  the smaller of <var title="">y</var> and the sum of <var title="">y</var> and <var title="">h</var>; and except that the following two calls:</p>

  <pre>context.createImageData(w, h);
context.getImageData(0, 0, w, h);</pre>

  <p>...must return <code><a href="#imagedata">ImageData</a></code> objects with the same dimensions as each other, for any
  value of <var title="">w</var> and <var title="">h</var>. In other words, while user agents may
  round the arguments of these methods, any rounding performed must be performed consistently for
  all of the methods described in this section. (The constructors only work with integer
  values.)</p>

  <p class="note">Due to the lossy nature of converting to and from premultiplied alpha color
  values, pixels that have just been set using <code title="dom-context-2d-putImageData"><a href="#dom-context-2d-putimagedata">putImageData()</a></code> might be returned to an equivalent
  <code title="dom-context-2d-getImageData"><a href="#dom-context-2d-getimagedata">getImageData()</a></code> as different values.</p>

  <p>The current path, <a href="#transformations" title="dom-context-2d-transformation">transformation matrix</a>,
  <a href="#shadows" title="shadows">shadow attributes</a>, <a href="#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global
  alpha</a>, the <a href="#clipping-region">clipping region</a>, and <a href="#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition operator</a> must not
  affect the methods described in this section.</p>

  </div>

  <div class="example">

   <p>In the following example, the script generates an <code><a href="#imagedata">ImageData</a></code> object so that it can
   draw onto it.</p>

   <pre>// canvas is a reference to a &lt;canvas&gt; element
var context = canvas.getContext('2d');

// create a blank slate
var data = context.createImageData(canvas.width, canvas.height);

// create some plasma
FillPlasma(data, 'green'); // green plasma

// add a cloud to the plasma
AddCloud(data, data.width/2, data.height/2); // put a cloud in the middle

// paint the plasma+cloud on the canvas
context.putImageData(data, 0, 0);

// support methods
function FillPlasma(data, color) { ... }
function AddCloud(data, x, y) { ... }</pre>

  </div>

  <div class="example">

   <p>Here is an example of using <code title="dom-context-2d-getImageData"><a href="#dom-context-2d-getimagedata">getImageData()</a></code> and <code title="dom-context-2d-putImageData"><a href="#dom-context-2d-putimagedata">putImageData()</a></code> to implement an edge detection
   filter.</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Edge detection demo&lt;/title&gt;
  &lt;script&gt;
   var image = new Image();
   function init() {
     image.onload = demo;
     image.src = "image.jpeg";
   }
   function demo() {
     var canvas = document.getElementsByTagName('canvas')[0];
     var context = canvas.getContext('2d');

     // draw the image onto the canvas
     context.drawImage(image, 0, 0);

     // get the image data to manipulate
     var input = context.getImageData(0, 0, canvas.width, canvas.height);

     // get an empty slate to put the data into
     var output = context.createImageData(canvas.width, canvas.height);

     // alias some variables for convenience
     // notice that we are using input.width and input.height here
     // as they might not be the same as canvas.width and canvas.height
     // (in particular, they might be different on high-res displays)
     var w = input.width, h = input.height;
     var inputData = input.data;
     var outputData = output.data;

     // edge detection
     for (var y = 1; y &lt; h-1; y += 1) {
       for (var x = 1; x &lt; w-1; x += 1) {
         for (var c = 0; c &lt; 3; c += 1) {
           var i = (y*w + x)*4 + c;
           outputData[i] = 127 + -inputData[i - w*4 - 4] -   inputData[i - w*4] - inputData[i - w*4 + 4] +
                                 -inputData[i - 4]       + 8*inputData[i]       - inputData[i + 4] +
                                 -inputData[i + w*4 - 4] -   inputData[i + w*4] - inputData[i + w*4 + 4];
         }
         outputData[(y*w + x)*4 + 3] = 255; // alpha
       }
     }

     // put the image data back after manipulation
     context.putImageData(output, 0, 0);
   }
  &lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="init()"&gt;
  &lt;canvas&gt;&lt;/canvas&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>




  <h6 id="compositing"><span class="secno">4.12.4.2.17 </span>Compositing</h6>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current alpha value applied to rendering operations.</p>

    <p>Can be set, to change the alpha value. Values outside of the range 0.0 .. 1.0 are
    ignored.</p>

   </dd>


   <dt><var title="">context</var> . <code title="dom-context-2d-globalCompositeOperation"><a href="#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current composition operation, from the values defined in the Compositing and
    Blending specification. <a href="references.html#refsCOMPOSITE">[COMPOSITE]</a>.</p>

    <p>Can be set, to change the composition operation. Unknown values are ignored.</p>

   </dd>

  </dl><div class="impl">

  <p>All drawing operations are affected by the global compositing attributes, <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code> and <code title="dom-context-2d-globalCompositeOperation"><a href="#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>.</p>

  <!-- conformance criteria for painting are described in the "drawing model" section below -->

  <p>The <dfn id="dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha"><code>globalAlpha</code></dfn> attribute gives an
  alpha value that is applied to shapes and images before they are composited onto the <a href="#scratch-bitmap">scratch
  bitmap</a>. The value must be in the range from 0.0 (fully transparent) to 1.0 (no additional
  transparency). If an attempt is made to set the attribute to a value outside this range, including
  Infinity and Not-a-Number (NaN) values, the attribute must retain its previous value. When the
  context is created, the <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code> attribute must
  initially have the value 1.0.</p>

  <p>The <dfn id="dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation"><code>globalCompositeOperation</code></dfn>
  attribute sets the current composition operator, which controls how shapes and images are drawn
  onto the <a href="#scratch-bitmap">scratch bitmap</a>, once they have had <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code> and the current transformation matrix
  applied. The possible values are those defined in the Compositing and Blending specification. <a href="references.html#refsCOMPOSITE">[COMPOSITE]</a></p>

  <p>These values are all case-sensitive — they must be used exactly as defined. User agents
  must not recognize values that are not a <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for one of the values
  given in the Compositing and Blending specification. <a href="references.html#refsCOMPOSITE">[COMPOSITE]</a></p>

  <p>On setting, if the user agent does not recognize the specified value, it must be ignored,
  leaving the value of <code title="dom-context-2d-globalCompositeOperation"><a href="#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code> unaffected.
  Otherwise, the attribute must be set to the given new value.</p>

  <p>When the context is created, the <code title="dom-context-2d-globalCompositeOperation"><a href="#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code> attribute must
  initially have the value <code>source-over</code>.</p>

  </div>



  <h6 id="image-smoothing"><span class="secno">4.12.4.2.18 </span>Image smoothing</h6>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-imageSmoothingEnabled"><a href="#dom-context-2d-imagesmoothingenabled">imageSmoothingEnabled</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns whether pattern fills and the <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage()</a></code> method will attempt to smooth images if
    their pixels don't line up exactly with the display, when scaling images up.</p>

    <p>Can be set, to change whether images are smoothed (true) or not (false).</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-context-2d-imagesmoothingenabled" title="dom-context-2d-imageSmoothingEnabled"><code>imageSmoothingEnabled</code></dfn>
  attribute, on getting, must return the last value it was set to. On setting, it must be set to the
  new value. When the <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is created, the attribute must be
  set to true.</p>

  </div>


  <h6 id="shadows"><span class="secno">4.12.4.2.19 </span><dfn>Shadows</dfn></h6>

  <p>All drawing operations are affected by the four global shadow attributes.</p>

  <dl class="domintro"><dt><var title="">context</var> . <code title="dom-context-2d-shadowColor"><a href="#dom-context-2d-shadowcolor">shadowColor</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current shadow color.</p>

    <p>Can be set, to change the shadow color. Values that cannot be parsed as CSS colors are ignored.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-shadowOffsetX"><a href="#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code> [ = <var title="">value</var> ]</dt>
   <dt><var title="">context</var> . <code title="dom-context-2d-shadowOffsetY"><a href="#dom-context-2d-shadowoffsety">shadowOffsetY</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current shadow offset.</p>

    <p>Can be set, to change the shadow offset. Values that are not finite numbers are ignored.</p>

   </dd>

   <dt><var title="">context</var> . <code title="dom-context-2d-shadowBlur"><a href="#dom-context-2d-shadowblur">shadowBlur</a></code> [ = <var title="">value</var> ]</dt>

   <dd>

    <p>Returns the current level of blur applied to shadows.</p>

    <p>Can be set, to change the blur level. Values that are not finite numbers greater than or
    equal to zero are ignored.</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn id="dom-context-2d-shadowcolor" title="dom-context-2d-shadowColor"><code>shadowColor</code></dfn> attribute sets the
  color of the shadow.</p>

  <p>When the context is created, the <code title="dom-context-2d-shadowColor"><a href="#dom-context-2d-shadowcolor">shadowColor</a></code>
  attribute initially must be fully-transparent black.</p>

  <p>On getting, the <a href="#serialization-of-a-color" title="serialization of a color">serialization of the color</a> must
  be returned.</p>

  <p>On setting, the new value must be <a href="infrastructure.html#parsed-as-a-css-color-value">parsed as a CSS &lt;color&gt; value</a> and the
  color assigned. If the value cannot be parsed as a CSS &lt;color&gt; value then it must be
  ignored, and the attribute must retain its previous value. <a href="references.html#refsCSSCOLOR">[CSSCOLOR]</a></p>

  <p>The <dfn id="dom-context-2d-shadowoffsetx" title="dom-context-2d-shadowOffsetX"><code>shadowOffsetX</code></dfn> and <dfn id="dom-context-2d-shadowoffsety" title="dom-context-2d-shadowOffsetY"><code>shadowOffsetY</code></dfn> attributes specify the
  distance that the shadow will be offset in the positive horizontal and positive vertical distance
  respectively. Their values are in coordinate space units. They are not affected by the current
  transformation matrix.</p>

  <p>When the context is created, the shadow offset attributes must initially have the value
  <code>0</code>.</p>

  <p>On getting, they must return their current value. On setting, the attribute being set must be
  set to the new value, except if the value is infinite or NaN, in which case the new value must be
  ignored.</p>

  <p>The <dfn id="dom-context-2d-shadowblur" title="dom-context-2d-shadowBlur"><code>shadowBlur</code></dfn> attribute specifies
  the level of the blurring effect. (The units do not map to coordinate space units, and are not
  affected by the current transformation matrix.)</p>

  <p>When the context is created, the <code title="dom-context-2d-shadowBlur"><a href="#dom-context-2d-shadowblur">shadowBlur</a></code>
  attribute must initially have the value <code>0</code>.</p>

  <p>On getting, the attribute must return its current value. On setting the attribute must be set
  to the new value, except if the value is negative, infinite or NaN, in which case the new value
  must be ignored.</p>

  <p><dfn id="when-shadows-are-drawn" title="when shadows are drawn">Shadows are only drawn if</dfn> the opacity component of
  the alpha component of the color of <code title="dom-context-2d-shadowColor"><a href="#dom-context-2d-shadowcolor">shadowColor</a></code> is
  non-zero and either the <code title="dom-context-2d-shadowBlur"><a href="#dom-context-2d-shadowblur">shadowBlur</a></code> is non-zero, or
  the <code title="dom-context-2d-shadowOffsetX"><a href="#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code> is non-zero, or the <code title="dom-context-2d-shadowOffsetY"><a href="#dom-context-2d-shadowoffsety">shadowOffsetY</a></code> is non-zero.</p>

  <p class="critical">It is likely that this will change: browser vendors have indicated an interest
  in changing the processing model for shadows such that they only draw when the composition
  operator is "source-over" (the default). <a href="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-May/thread.html#31457">Read
  more...</a></p>

  <p><a href="#when-shadows-are-drawn">When shadows are drawn</a>, they must be rendered as follows:</p>

  <ol><li><p>Let <var title="">A</var> be an infinite transparent black bitmap on which the source
   image for which a shadow is being created has been rendered.</p></li>

   <li><p>Let <var title="">B</var> be an infinite transparent black bitmap, with a coordinate
   space and an origin identical to <var title="">A</var>.</p></li>

   <li><p>Copy the alpha channel of <var title="">A</var> to <var title="">B</var>, offset by <code title="dom-context-2d-shadowOffsetX"><a href="#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code> in the positive <var title="">x</var>
   direction, and <code title="dom-context-2d-shadowOffsetY"><a href="#dom-context-2d-shadowoffsety">shadowOffsetY</a></code> in the positive
   <var title="">y</var> direction.</p></li>

   <li>

    <p>If <code title="dom-context-2d-shadowBlur"><a href="#dom-context-2d-shadowblur">shadowBlur</a></code> is greater than 0:</p>

    <ol><li> <p>Let <var title="">σ</var> be half the value of <code title="dom-context-2d-shadowBlur"><a href="#dom-context-2d-shadowblur">shadowBlur</a></code>.</p></li>

     <li> <p>Perform a 2D Gaussian Blur on <var title="">B</var>, using <var title="">σ</var>
     as the standard deviation.</p> <!-- wish i could find a reference for this --> </li>

    </ol><p>User agents may limit values of <var title="">σ</var> to an implementation-specific
    maximum value to avoid exceeding hardware limitations during the Gaussian blur operation.</p>

   </li>

   <li><p>Set the red, green, and blue components of every pixel in <var title="">B</var> to the
   red, green, and blue components (respectively) of the color of <code title="dom-context-2d-shadowColor"><a href="#dom-context-2d-shadowcolor">shadowColor</a></code>.</p></li>

   <li><p>Multiply the alpha component of every pixel in <var title="">B</var> by the alpha
   component of the color of <code title="dom-context-2d-shadowColor"><a href="#dom-context-2d-shadowcolor">shadowColor</a></code>.</p></li>

   <li><p>The shadow is in the bitmap <var title="">B</var>, and is rendered as part of the
   <a href="#drawing-model">drawing model</a> described below.</p></li>

  </ol></div>

  <p>If the current composition operation is <code title="gcop-copy">copy</code>, shadows
  effectively won't render (since the shape will overwrite the shadow).</p>



  <div class="impl">

  <h6 id="drawing-model"><span class="secno">4.12.4.2.20 </span><dfn>Drawing model</dfn></h6>

  <p>When a shape or image is painted, user agents must follow these steps, in the order given (or
  act as if they do):</p>

  <ol><li><p>Render the shape or image onto an infinite transparent black bitmap, creating image <var title="">A</var>, as described in the previous sections. For shapes, the current fill, stroke,
   and line styles must be honored, and the stroke must itself also be subjected to the current
   transformation matrix.</p></li>

   <li><p><a href="#when-shadows-are-drawn">When shadows are drawn</a>, render the shadow from image <var title="">A</var>,
   using the current shadow styles, creating image <var title="">B</var>.</p></li>

   <li><p><a href="#when-shadows-are-drawn">When shadows are drawn</a>, multiply the alpha component of every pixel in <var title="">B</var> by <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code>.</p></li>

   <li><p><a href="#when-shadows-are-drawn">When shadows are drawn</a>, composite <var title="">B</var> within the
   <a href="#clipping-region">clipping region</a> over the current <a href="#scratch-bitmap">scratch bitmap</a> using the current
   composition operator.</p></li>

   <li><p>Multiply the alpha component of every pixel in <var title="">A</var> by <code title="dom-context-2d-globalAlpha"><a href="#dom-context-2d-globalalpha">globalAlpha</a></code>.</p></li>

   <li><p>Composite <var title="">A</var> within the <a href="#clipping-region">clipping region</a> over the current
   <a href="#scratch-bitmap">scratch bitmap</a> using the current composition operator.</p></li>

  </ol><p>When compositing onto the <a href="#scratch-bitmap">scratch bitmap</a>, pixels that would fall outside of the
  <a href="#scratch-bitmap">scratch bitmap</a> must be discarded.</p>

  </div>




  <h6 id="best-practices"><span class="secno">4.12.4.2.21 </span>Best practices</h6>

  <p><i>This section is non-normative.</i></p>

  <p>When a canvas is interactive, authors should include focusable elements in the element's
  fallback content corresponding to each focusable part of the canvas, as in the <a href="#drawCustomFocusRingExample">example above</a>.</p>

<!--CLEANUP-->
  <p>To expose text and interactive content on a <code><a href="#the-canvas-element">canvas</a></code> to users of accessibility
  tools, authors should use the <code title="dom-context-2d-addHitRegion"><a href="#dom-context-2d-addhitregion">addHitRegion()</a></code>
  API. When rendering focus rings, to ensure that focus rings have the appearance of native focus
  rings, authors should use the <code title="dom-context-2d-drawSystemFocusRing"><a href="#dom-context-2d-drawsystemfocusring">drawSystemFocusRing()</a></code> method, passing it the
  element for which a ring is being drawn. This method only draws the focus ring if the element is
  <a href="editing.html#focused">focused</a>, so that it can simply be called whenever drawing the element, without checking whether
  the element is focused or not first.</p>

  <p id="no-text-editing-in-canvas-please">Authors should avoid implementing text editing controls
  using the <code><a href="#the-canvas-element">canvas</a></code> element. Doing so has a large number of disadvantages:</p>

  <ul><li>Mouse placement of the caret has to be reimplemented.</li>

   <li>Keyboard movement of the caret has to be reimplemented (possibly across lines, for multiline
   text input).</li>

   <li>Scrolling of the text field has to be implemented (horizontally for long lines, vertically
   for multiline input).</li>

   <li>Native features such as copy-and-paste have to be reimplemented.</li>

   <li>Native features such as spell-checking have to be reimplemented.</li>

   <li>Native features such as drag-and-drop have to be reimplemented.</li>

   <li>Native features such as page-wide text search have to be reimplemented.</li>

   <li>Native features specific to the user, for example custom text services, have to be
   reimplemented. This is close to impossible since each user might have different services
   installed, and there is an unbounded set of possible such services.</li>

   <li>Bidirectional text editing has to be reimplemented.</li>

   <li>For multiline text editing, line wrapping has to be implemented for all relevant
   languages.</li>

   <li>Text selection has to be reimplemented.</li>

   <li>Dragging of bidirectional text selections has to be reimplemented.</li>

   <li>Platform-native keyboard shortcuts have to be reimplemented.</li>

   <li>Platform-native input method editors (IMEs) have to be reimplemented.</li>

   <li>Undo and redo functionality has to be reimplemented.</li>

   <li>Accessibility features such as magnification following the caret or selection have to be
   reimplemented.</li>

  </ul><p>This is a huge amount of work, and authors are most strongly encouraged to avoid doing any of
  it by instead using the <code><a href="the-input-element.html#the-input-element">input</a></code> element, the <code><a href="the-button-element.html#the-textarea-element">textarea</a></code> element, or the
  <code title="attr-contenteditable"><a href="editing.html#attr-contenteditable">contenteditable</a></code> attribute.</p>


  <h6 id="examples"><span class="secno">4.12.4.2.22 </span>Examples</h6>

  <p><i>This section is non-normative.</i></p>

  <div class="example">

  <p>Here is an example of a script that uses canvas to draw <a href="data:text/html;charset=utf-8;base64,PCFET0NUWVBFIEhUTUw%2BDQo8aHRtbCBsYW5nPSJlbiI%2BDQogPGhlYWQ%2BDQogIDx0aXRsZT5QcmV0dHkgR2xvd2luZyBMaW5lczwvdGl0bGU%2BDQogPC9oZWFkPg0KIDxib2R5Pg0KPGNhbnZhcyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCI%2BPC9jYW52YXM%2BDQo8c2NyaXB0Pg0KDQogdmFyIGNvbnRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnMmQnKTsNCg0KIHZhciBsYXN0WCA9IGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKTsNCiB2YXIgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KIHZhciBodWUgPSAwOw0KIGZ1bmN0aW9uIGxpbmUoKSB7DQogICBjb250ZXh0LnNhdmUoKTsNCiAgIGNvbnRleHQudHJhbnNsYXRlKGNvbnRleHQuY2FudmFzLndpZHRoLzIsIGNvbnRleHQuY2FudmFzLmhlaWdodC8yKTsNCiAgIGNvbnRleHQuc2NhbGUoMC45LCAwLjkpOw0KICAgY29udGV4dC50cmFuc2xhdGUoLWNvbnRleHQuY2FudmFzLndpZHRoLzIsIC1jb250ZXh0LmNhbnZhcy5oZWlnaHQvMik7DQogICBjb250ZXh0LmJlZ2luUGF0aCgpOw0KICAgY29udGV4dC5saW5lV2lkdGggPSA1ICsgTWF0aC5yYW5kb20oKSAqIDEwOw0KICAgY29udGV4dC5tb3ZlVG8obGFzdFgsIGxhc3RZKTsNCiAgIGxhc3RYID0gY29udGV4dC5jYW52YXMud2lkdGggKiBNYXRoLnJhbmRvbSgpOw0KICAgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KICAgY29udGV4dC5iZXppZXJDdXJ2ZVRvKGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYLCBsYXN0WSk7DQoNCiAgIGh1ZSA9IGh1ZSArIDEwICogTWF0aC5yYW5kb20oKTsNCiAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnaHNsKCcgKyBodWUgKyAnLCA1MCUsIDUwJSknOw0KICAgY29udGV4dC5zaGFkb3dDb2xvciA9ICd3aGl0ZSc7DQogICBjb250ZXh0LnNoYWRvd0JsdXIgPSAxMDsNCiAgIGNvbnRleHQuc3Ryb2tlKCk7DQogICBjb250ZXh0LnJlc3RvcmUoKTsNCiB9DQogc2V0SW50ZXJ2YWwobGluZSwgNTApOw0KDQogZnVuY3Rpb24gYmxhbmsoKSB7DQogICBjb250ZXh0LmZpbGxTdHlsZSA9ICdyZ2JhKDAsMCwwLDAuMSknOw0KICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjb250ZXh0LmNhbnZhcy53aWR0aCwgY29udGV4dC5jYW52YXMuaGVpZ2h0KTsNCiB9DQogc2V0SW50ZXJ2YWwoYmxhbmssIDQwKTsNCg0KPC9zY3JpcHQ%2BDQogPC9ib2R5Pg0KPC9odG1sPg0K">pretty glowing lines</a>.</p>

  <pre>&lt;canvas width="800" height="450"&gt;&lt;/canvas&gt;
&lt;script&gt;

 var context = document.getElementsByTagName('canvas')[0].getContext('2d');

 var lastX = context.canvas.width * Math.random();
 var lastY = context.canvas.height * Math.random();
 var hue = 0;
 function line() {
   context.save();
   context.translate(context.canvas.width/2, context.canvas.height/2);
   context.scale(0.9, 0.9);
   context.translate(-context.canvas.width/2, -context.canvas.height/2);
   context.beginPath();
   context.lineWidth = 5 + Math.random() * 10;
   context.moveTo(lastX, lastY);
   lastX = context.canvas.width * Math.random();
   lastY = context.canvas.height * Math.random();
   context.bezierCurveTo(context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         lastX, lastY);

   hue = hue + 10 * Math.random();
   context.strokeStyle = 'hsl(' + hue + ', 50%, 50%)';
   context.shadowColor = 'white';
   context.shadowBlur = 10;
   context.stroke();
   context.restore();
 }
 setInterval(line, 50);

 function blank() {
   context.fillStyle = 'rgba(0,0,0,0.1)';
   context.fillRect(0, 0, context.canvas.width, context.canvas.height);
 }
 setInterval(blank, 40);

&lt;/script&gt;</pre>

  </div>

  <div class="example">

   <p>The 2D rendering context for <code><a href="#the-canvas-element">canvas</a></code> is often used for sprite-based games. The
   following example demonstrates this:</p>

   <iframe src="/demos/canvas/blue-robot/index-idle.html" width="396" height="216"></iframe>

   <p>Here is the source for this example:</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;title&gt;Blue Robot Demo&lt;/title&gt;
&lt;base href="http://www.whatwg.org/demos/canvas/blue-robot/"&gt;
&lt;style&gt;
  html { overflow: hidden; min-height: 200px; min-width: 380px; }
  body { height: 200px; position: relative; margin: 8px; }
  .buttons { position: absolute; bottom: 0px; left: 0px; margin: 4px; }
&lt;/style&gt;
&lt;canvas width="380" height="200"&gt;&lt;/canvas&gt;
&lt;script&gt;
 var Landscape = function (context, width, height) {
   this.offset = 0;
   this.width = width;
   this.advance = function (dx) {
     this.offset += dx;
   };
   this.horizon = height * 0.7;
   // This creates the sky gradient (from a darker blue to white at the bottom)
   this.sky = context.createLinearGradient(0, 0, 0, this.horizon);
   this.sky.addColorStop(0.0, 'rgb(55,121,179)');
   this.sky.addColorStop(0.7, 'rgb(121,194,245)');
   this.sky.addColorStop(1.0, 'rgb(164,200,214)');
   // this creates the grass gradient (from a darker green to a lighter green)
   this.earth = context.createLinearGradient(0, this.horizon, 0, height);
   this.earth.addColorStop(0.0, 'rgb(81,140,20)');
   this.earth.addColorStop(1.0, 'rgb(123,177,57)');
   this.paintBackground = function (context, width, height) {
     // first, paint the sky and grass rectangles
     context.fillStyle = this.sky;
     context.fillRect(0, 0, width, this.horizon);
     context.fillStyle = this.earth;
     context.fillRect(0, this.horizon, width, height-this.horizon);
     // then, draw the cloudy banner
     // we make it cloudy by having the draw text off the top of the
     // canvas, and just having the blurred shadow shown on the canvas
     context.save();
     context.translate(width-((this.offset+(this.width*3.2)) % (this.width*4.0))+0, 0);
     context.shadowColor = 'white';
     context.shadowOffsetY = 30+this.horizon/3; // offset down on canvas
     context.shadowBlur = '5';
     context.fillStyle = 'white';
     context.textAlign = 'left';
     context.textBaseline = 'top';
     context.font = '20px sans-serif';
     context.fillText('WHATWG ROCKS', 10, -30); // text up above canvas
     context.restore();     
     // then, draw the background tree
     context.save();
     context.translate(width-((this.offset+(this.width*0.2)) % (this.width*1.5))+30, 0);
     context.beginPath();
     context.fillStyle = 'rgb(143,89,2)';
     context.lineStyle = 'rgb(10,10,10)';
     context.lineWidth = 2;
     context.rect(0, this.horizon+5, 10, -50); // trunk
     context.fill();
     context.stroke();
     context.beginPath();
     context.fillStyle = 'rgb(78,154,6)';
     context.arc(5, this.horizon-60, 30, 0, Math.PI*2); // leaves
     context.fill();
     context.stroke();
     context.restore();
   };
   this.paintForeground = function (context, width, height) {
     // draw the box that goes in front
     context.save();
     context.translate(width-((this.offset+(this.width*0.7)) % (this.width*1.1))+0, 0);
     context.beginPath();
     context.rect(0, this.horizon - 5, 25, 25);
     context.fillStyle = 'rgb(220,154,94)';
     context.lineStyle = 'rgb(10,10,10)';
     context.lineWidth = 2;
     context.fill();
     context.stroke();
     context.restore();
   };
 };
&lt;/script&gt;
&lt;script&gt;
 var BlueRobot = function () {
   this.sprites = new Image();
   this.sprites.src = 'blue-robot.png'; // this sprite sheet has 8 cells
   this.targetMode = 'idle';
   this.walk = function () {
     this.targetMode = 'walk';
   };
   this.stop = function () {
     this.targetMode = 'idle';
   };
   this.frameIndex = {
     'idle': [0], // first cell is the idle frame
     'walk': [1,2,3,4,5,6], // the walking animation is cells 1-6
     'stop': [7], // last cell is the stopping animation
   };
   this.mode = 'idle';
   this.frame = 0; // index into frameIndex
   this.tick = function () {
     // this advances the frame and the robot
     // the return value is how many pixels the robot has moved
     this.frame += 1;
     if (this.frame &gt;= this.frameIndex[this.mode].length) {
       // we've reached the end of this animation cycle
       this.frame = 0;
       if (this.mode != this.targetMode) {
         // switch to next cycle
         if (this.mode == 'walk') {
           // we need to stop walking before we decide what to do next
           this.mode = 'stop';
         } else if (this.mode == 'stop') {
           if (this.targetMode == 'walk')
             this.mode = 'walk';
           else
             this.mode = 'idle';
         } else if (this.mode == 'idle') {
           if (this.targetMode == 'walk')
             this.mode = 'walk';
         }
       }
     }
     if (this.mode == 'walk')
       return 8;
     return 0;
   },
   this.paint = function (context, x, y) {
     if (!this.sprites.complete) return;
     // draw the right frame out of the sprite sheet onto the canvas
     // we assume each frame is as high as the sprite sheet
     // the x,y coordinates give the position of the bottom center of the sprite
     context.drawImage(this.sprites,
                       this.frameIndex[this.mode][this.frame] * this.sprites.height, 0, this.sprites.height, this.sprites.height,
                       x-this.sprites.height/2, y-this.sprites.height, this.sprites.height, this.sprites.height);
   };
 };
&lt;/script&gt;
&lt;script&gt;
 var canvas = document.getElementsByTagName('canvas')[0];
 var context = canvas.getContext('2d');
 var landscape = new Landscape(context, canvas.width, canvas.height);
 var blueRobot = new BlueRobot();
 // paint when the browser wants us to, using requestAnimationFrame()
 function paint() {
   context.clearRect(0, 0, canvas.width, canvas.height);
   landscape.paintBackground(context, canvas.width, canvas.height);
   blueRobot.paint(context, canvas.width/2, landscape.horizon*1.1);
   landscape.paintForeground(context, canvas.width, canvas.height);
   requestAnimationFrame(paint);
 }
 paint();
 // but tick every 150ms, so that we don't slow down when we don't paint
 setInterval(function () {
   var dx = blueRobot.tick();
   landscape.advance(dx);
 }, 100);
&lt;/script&gt;
&lt;p class="buttons"&gt;
 &lt;input type=button value="Walk" onclick="blueRobot.walk()"&gt;
 &lt;input type=button value="Stop" onclick="blueRobot.stop()"&gt;
&lt;footer&gt;
 &lt;small&gt; Blue Robot Player Sprite by &lt;a href="http://johncolburn.deviantart.com/"&gt;JohnColburn&lt;/a&gt;.
 Licensed under the terms of the Creative Commons Attribution Share-Alike 3.0 Unported license.&lt;/small&gt;
 &lt;small&gt; This work is itself licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"&gt;Creative
 Commons Attribution-ShareAlike 3.0 Unported License&lt;/a&gt;.&lt;/small&gt;
&lt;/footer&gt;
</pre>

  </div>



  



  <div class="impl">

  <h5 id="color-spaces-and-color-correction"><span class="secno">4.12.4.3 </span>Color spaces and color correction</h5>

  <p>The <code><a href="#the-canvas-element">canvas</a></code> APIs must perform color correction at only two points: when rendering
  images with their own gamma correction and color space information onto a bitmap, to convert the
  image to the color space used by the bitmaps (e.g. using the 2D Context's <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage()</a></code> method with an <code><a href="edits.html#htmlimageelement">HTMLImageElement</a></code>
  object), and when rendering the actual canvas bitmap to the output device.</p>

  <p class="note">Thus, in the 2D context, colors used to draw shapes onto the canvas will exactly
  match colors obtained through the <code title="dom-context-2d-getImageData"><a href="#dom-context-2d-getimagedata">getImageData()</a></code> method.</p>

  <p>The <code title="dom-canvas-toDataURL"><a href="#dom-canvas-todataurl">toDataURL()</a></code> method must not include color space
  information in the resources they return. Where the output format allows it, the color of pixels
  in resources created by <code title="dom-canvas-toDataURL"><a href="#dom-canvas-todataurl">toDataURL()</a></code> must match those
  returned by the <code title="dom-context-2d-getImageData"><a href="#dom-context-2d-getimagedata">getImageData()</a></code> method.</p>

  <p>In user agents that support CSS, the color space used by a <code><a href="#the-canvas-element">canvas</a></code> element must
  match the color space used for processing any colors for that element in CSS.</p>

  <p>The gamma correction and color space information of images must be handled in such a way that
  an image rendered directly using an <code><a href="edits.html#the-img-element">img</a></code> element would use the same colors as one
  painted on a <code><a href="#the-canvas-element">canvas</a></code> element that is then itself rendered. Furthermore, the rendering
  of images that have no color correction information (such as those returned by the <code title="dom-canvas-toDataURL"><a href="#dom-canvas-todataurl">toDataURL()</a></code> method) must be rendered with no color
  correction.</p>

  <p class="note">Thus, in the 2D context, calling the <code title="dom-context-2d-drawImage"><a href="#dom-context-2d-drawimage">drawImage()</a></code> method to render the output of the <code title="dom-canvas-toDataURL"><a href="#dom-canvas-todataurl">toDataURL()</a></code> method to the canvas, given the appropriate
  dimensions, has no visible effect.</p>

  </div>



  <h5 id="serializing-bitmaps-to-a-file"><span class="secno">4.12.4.4 </span>Serializing bitmaps to a file</h5>

  <div class="impl">

  <p>When a user agent is to create <dfn id="a-serialization-of-the-bitmap-as-a-file">a serialization of the bitmap as a file</dfn>, optionally
  with some given <var title="">arguments</var>, and optionally with a <var title="">native</var>
  flag set, it must create an image file in the format given by the first value of <var title="">arguments</var>, or, if there are no <var title="">arguments</var>, in the PNG format. <a href="references.html#refsPNG">[PNG]</a></p>

  <p>If the <var title="">native</var> flag is set, or if the bitmap has one pixel per coordinate
  space unit, then the image file must have the same pixel data (before compression, if applicable)
  as the bitmap, and if the file format used supports encoding resolution metadata, the resolution
  of that bitmap (device pixels per coordinate space units being interpreted as image pixels per CSS
  pixel) must be given as well.</p>

  <p>Otherwise, the image file's pixel data must be the bitmap's pixel data scaled to one image
  pixel per coordinate space unit, and if the file format used supports encoding resolution
  metadata, the resolution must be given as 96dpi (one image pixel per CSS pixel).</p>

  <p>If <var title="">arguments</var> is not empty, the first value must be interpreted as a <a href="infrastructure.html#mime-type" title="MIME type">MIME type</a> giving the format to use. If the type has any parameters, it
  must be treated as not supported.</p>

  <p class="example">For example, the value "<code>image/png</code>" would mean to generate a PNG
  image, the value "<code>image/jpeg</code>" would mean to generate a JPEG image, and the value
  "<code>image/svg+xml</code>" would mean to generate an SVG image (which would require that the
  user agent track how the bitmap was generated, an unlikely, though potentially awesome,
  feature).</p>

  <p>User agents must support PNG ("<code>image/png</code>"). User agents may support other types.
  If the user agent does not support the requested type, it must create the file using the PNG
  format. <a href="references.html#refsPNG">[PNG]</a></p>

  <p>User agents must <a href="infrastructure.html#converted-to-ascii-lowercase" title="converted to ASCII lowercase">convert the provided type to ASCII
  lowercase</a> before establishing if they support that type.</p>

  <p>For image types that do not support an alpha channel, the serialized image must be the bitmap
  image composited onto a solid black background using the source-over operator.</p>

  <p>If the first argument in <var title="">arguments</var> gives a type corresponding to one of the
  types given in the first column of the following table, and the user agent supports that type,
  then the subsequent arguments, if any, must be treated as described in the second cell of that
  row.</p>

  </div>

  <table id="canvas-serialization-arguments"><caption>Arguments for serialization methods</caption>
   <thead><tr><th> Type </th><th> Other arguments </th><th> Reference
   </th></tr></thead><tbody><tr><td> <code>image/jpeg</code>
     </td><td> The second argument<span class="impl">, if it</span> is a number in the range 0.0 to 1.0
     inclusive<span class="impl">, must be</span> treated as the desired quality level. <span class="impl">If it is not a number or is outside that range, the user agent must use its
     default value, as if the argument had been omitted.</span>
     </td><td> <a href="references.html#refsJPEG">[JPEG]</a>
  </td></tr></tbody></table><div class="impl">

  <p>For the purposes of these rules, an argument is considered to be a number if it is converted to
  an IDL double value by the rules for handling arguments of type <code title="">any</code> in the
  Web IDL specification. <a href="references.html#refsWEBIDL">[WEBIDL]</a></p>

  <p>Other arguments must be ignored and must not cause the user agent to throw an exception. A
  future version of this specification will probably define other parameters to be passed to these
  methods to allow authors to more carefully control compression settings, image metadata, etc.</p>

  </div>


<!--ADD-TOPIC:Security-->
  <div class="impl">

  <h5 id="security-with-canvas-elements"><span class="secno">4.12.4.5 </span>Security with <code><a href="#the-canvas-element">canvas</a></code> elements</h5>

  <p><i>This section is non-normative.</i></p>

  <p><strong>Information leakage</strong> can occur if scripts from one <a href="origin-0.html#origin">origin</a> can
  access information (e.g. read pixels) from images from another origin (one that isn't the <a href="origin-0.html#same-origin" title="same origin">same</a>).</p>

  <p>To mitigate this, bitmaps used with <code><a href="#the-canvas-element">canvas</a></code> elements are defined to have a flag
  indicating whether they are <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a>. All
  bitmaps start with their <a href="#concept-canvas-origin-clean" title="concept-canvas-origin-clean">origin-clean</a> set to
  true. The flag is set to false when cross-origin images or fonts are used.</p>

  <p>The <code title="dom-canvas-toDataURL"><a href="#dom-canvas-todataurl">toDataURL()</a></code>, <code title="dom-canvas-toBlob"><a href="#dom-canvas-toblob">toBlob()</a></code>, and <code title="dom-context-2d-getImageData"><a href="#dom-context-2d-getimagedata">getImageData()</a></code> methods check the flag and will
  throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception rather than leak cross-origin data.</p>

  <p>The flag can be reset in certain situations; for example, when a
  <code><a href="#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> is bound to a new <code><a href="#the-canvas-element">canvas</a></code>, the bitmap is cleared
  and its flag reset.</p>

  </div>
<!--REMOVE-TOPIC:Security-->


<!--TOPIC:HTML-->
  </body></html>